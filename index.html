<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"
    />
    <title>Cyber Detective</title>
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%230a0a12' width='100' height='100' rx='20'/><circle cx='40' cy='40' r='20' fill='none' stroke='%2300ffff' stroke-width='6'/><line x1='55' y1='55' x2='75' y2='75' stroke='%2300ffff' stroke-width='6' stroke-linecap='round'/><circle cx='70' cy='30' r='8' fill='%23ff3366'/><path d='M65 30 h10 M70 25 v10' stroke='white' stroke-width='2'/></svg>"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700&family=Rajdhani:wght@400;600&display=swap");
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        background: #000;
        overflow: hidden;
        font-family: "Rajdhani", "Segoe UI", sans-serif;
      }
      /* ZAAWANSOWANY LOADER */
      #loader,
      #suspended {
        position: fixed;
        inset: 0;
        background: linear-gradient(
          135deg,
          #050510 0%,
          #0a1020 50%,
          #0a0a15 100%
        );
        z-index: 3000;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
        text-align: center;
      }
      #loader::before {
        content: "";
        position: absolute;
        inset: 0;
        background: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%' height='100%' filter='url(%23n)'/%3E%3C/svg%3E");
        opacity: 0.03;
      }
      #loader-logo {
        width: 150px;
        height: 150px;
        margin-bottom: 30px;
        animation: pulse-logo 2s ease-in-out infinite,
          rotate-glow 10s linear infinite;
        filter: drop-shadow(0 0 30px #0ff);
      }
      @keyframes pulse-logo {
        0%,
        100% {
          transform: scale(1);
          filter: drop-shadow(0 0 20px #0ff);
        }
        50% {
          transform: scale(1.05);
          filter: drop-shadow(0 0 50px #0ff);
        }
      }
      @keyframes rotate-glow {
        0% {
          filter: drop-shadow(0 0 20px #0ff) hue-rotate(0deg);
        }
        100% {
          filter: drop-shadow(0 0 20px #0ff) hue-rotate(360deg);
        }
      }
      #loader h1 {
        font-family: "Orbitron";
        font-size: clamp(24px, 6vw, 40px);
        background: linear-gradient(90deg, #0ff, #0f8, #ff0, #0ff);
        background-size: 300% 100%;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: gradient-shift 3s ease infinite;
        text-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
        margin-bottom: 30px;
      }
      @keyframes gradient-shift {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }
      #loader-bar-container {
        width: 80%;
        max-width: 400px;
        height: 25px;
        background: linear-gradient(180deg, #0a0a15, #1a1a2e);
        border: 2px solid #0ff;
        border-radius: 15px;
        overflow: hidden;
        margin-bottom: 15px;
        box-shadow: 0 0 20px rgba(0, 255, 255, 0.3),
          inset 0 2px 10px rgba(0, 0, 0, 0.5);
      }
      #loader-bar {
        width: 0%;
        height: 100%;
        background: linear-gradient(90deg, #0ff, #0f8, #0ff);
        background-size: 200% 100%;
        border-radius: 12px;
        transition: width 0.3s ease;
        animation: bar-glow 1s ease infinite;
        box-shadow: 0 0 20px #0ff;
      }
      @keyframes bar-glow {
        0%,
        100% {
          box-shadow: 0 0 10px #0ff;
        }
        50% {
          box-shadow: 0 0 25px #0ff, 0 0 40px #0f8;
        }
      }
      #loader-percent {
        font-family: "Orbitron";
        font-size: 28px;
        color: #0ff;
        margin-bottom: 10px;
        text-shadow: 0 0 20px #0ff;
      }
      #loader-text {
        font-family: "Share Tech Mono";
        font-size: 14px;
        color: #0f8;
        animation: blink-text 0.5s ease infinite;
      }
      @keyframes blink-text {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }
      /* SUSPENDED */
      #suspended h1 {
        font-family: "Orbitron";
        color: #f36;
        font-size: 32px;
        margin-bottom: 20px;
        text-shadow: 0 0 30px #f36;
        animation: shake 0.5s ease infinite;
      }
      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-5px);
        }
        75% {
          transform: translateX(5px);
        }
      }
      #suspended p {
        color: #aaa;
        margin-bottom: 10px;
      }
      #suspended .time {
        font-family: "Orbitron";
        color: #fc0;
        font-size: 42px;
        margin: 20px 0;
        text-shadow: 0 0 30px #fc0;
      }
      /* INTRO */
      #intro {
        position: fixed;
        inset: 0;
        background: linear-gradient(135deg, #050510, #0a1a2a, #0a0a15);
        z-index: 2000;
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        padding: 20px;
        text-align: center;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
      }
      #intro::before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(
            circle at 30% 30%,
            rgba(0, 255, 255, 0.1) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 70% 70%,
            rgba(255, 0, 255, 0.1) 0%,
            transparent 50%
          );
        pointer-events: none;
      }
      #intro > * {
        position: relative;
        z-index: 1;
      }
      .rules-box {
        width: 90%;
        max-width: 550px;
        max-height: 50vh;
        overflow-y: auto !important;
        -webkit-overflow-scrolling: touch;
        background: #111;
        color: #ccc;
        border: 2px solid #0ff;
        border-radius: 10px;
        padding: 15px;
        font-size: 13px;
        line-height: 1.6;
        font-family: Arial, sans-serif;
        text-align: left;
        margin-bottom: 20px;
      }
      #intro h1 {
        font-family: "Orbitron";
        font-size: clamp(32px, 10vw, 60px);
        background: linear-gradient(135deg, #0ff, #0f8);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 0 0 60px rgba(0, 255, 255, 0.8);
        margin-bottom: 15px;
        animation: title-glow 2s ease infinite;
      }
      @keyframes title-glow {
        0%,
        100% {
          filter: drop-shadow(0 0 20px #0ff);
        }
        50% {
          filter: drop-shadow(0 0 40px #0ff);
        }
      }
      #intro p {
        color: #888;
        margin-bottom: 40px;
        font-size: 18px;
      }
      #intro button {
        background: linear-gradient(
          135deg,
          transparent,
          rgba(0, 255, 255, 0.1)
        );
        border: 2px solid #0ff;
        color: #0ff;
        padding: 18px 60px;
        font-family: "Orbitron";
        font-size: 18px;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }
      #intro button::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(0, 255, 255, 0.3),
          transparent
        );
        transform: translateX(-100%);
        transition: transform 0.5s ease;
      }
      #intro button:hover {
        background: rgba(0, 255, 255, 0.2);
        box-shadow: 0 0 30px #0ff, inset 0 0 30px rgba(0, 255, 255, 0.2);
        transform: scale(1.05);
      }
      #intro button:hover::before {
        transform: translateX(100%);
      }
      /* CANVAS & CROSSHAIR */
      canvas {
        display: block;
      }
      #crosshair {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 30px;
        height: 30px;
        pointer-events: none;
        z-index: 100;
      }
      #crosshair::before,
      #crosshair::after {
        content: "";
        position: absolute;
        background: #0ff;
        box-shadow: 0 0 10px #0ff;
      }
      #crosshair::before {
        width: 2px;
        height: 100%;
        left: 50%;
        transform: translateX(-50%);
      }
      #crosshair::after {
        width: 100%;
        height: 2px;
        top: 50%;
        transform: translateY(-50%);
      }
      #prompt {
        position: fixed;
        bottom: 20%;
        left: 50%;
        transform: translateX(-50%);
        color: #0ff;
        font-family: "Share Tech Mono";
        background: linear-gradient(
          135deg,
          rgba(0, 20, 30, 0.95),
          rgba(0, 10, 20, 0.95)
        );
        padding: 15px 30px;
        border: 2px solid #0ff;
        border-radius: 12px;
        opacity: 0;
        z-index: 100;
        box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
      }
      #touch-btn {
        display: none;
        position: fixed;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(135deg, #0ff, #0f8);
        color: #000;
        font-family: "Orbitron", sans-serif;
        font-weight: bold;
        padding: 20px 50px;
        border-radius: 35px;
        font-size: 18px;
        z-index: 100;
        cursor: pointer;
        box-shadow: 0 5px 30px rgba(0, 255, 255, 0.5);
        transition: all 0.3s ease;
      }
      #touch-btn:active {
        transform: translateX(-50%) scale(0.95);
        box-shadow: 0 2px 15px rgba(0, 255, 255, 0.5);
      }
      /* HUD */
      #hud {
        position: fixed;
        top: 10px;
        left: 10px;
        color: #0ff;
        font-family: "Share Tech Mono";
        font-size: 14px;
        z-index: 100;
      }
      #hud div {
        margin-bottom: 6px;
        padding: 8px 15px;
        background: linear-gradient(
          90deg,
          rgba(0, 255, 255, 0.15),
          transparent
        );
        border-left: 3px solid #0ff;
        backdrop-filter: blur(5px);
        transition: all 0.3s ease;
      }
      #hud div:hover {
        background: linear-gradient(
          90deg,
          rgba(0, 255, 255, 0.25),
          transparent
        );
        padding-left: 20px;
      }
      /* Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #0a0a15;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb {
        background: linear-gradient(180deg, #0ff, #0f8);
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(180deg, #0f8, #0ff);
      }
      #computer {
        position: fixed;
        inset: 0;
        background: #0a0a12;
        z-index: 500;
        display: none;
        flex-direction: column;
      }
      #computer-bar {
        height: 45px;
        background: #1a1a2e;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 12px;
        border-bottom: 1px solid #333;
      }
      #computer-bar span {
        font-family: "Orbitron";
        color: #0ff;
      }
      #computer-bar button {
        background: #f36;
        color: #fff;
        border: none;
        padding: 8px 16px;
        cursor: pointer;
        border-radius: 5px;
      }
      #computer-main {
        flex: 1;
        display: flex;
        overflow: hidden;
      }
      #sidebar {
        width: 60px;
        background: #0f0f1a;
        border-right: 1px solid #1a1a2e;
        padding: 8px;
      }
      .nav-item {
        padding: 14px 8px;
        margin-bottom: 4px;
        background: rgba(0, 255, 255, 0.05);
        color: #888;
        font-size: 20px;
        cursor: pointer;
        border-left: 3px solid transparent;
        text-align: center;
        border-radius: 0 5px 5px 0;
      }
      .nav-item:hover,
      .nav-item.active {
        background: rgba(0, 255, 255, 0.15);
        color: #0ff;
        border-color: #0ff;
      }
      .nav-item.notify {
        background: rgba(255, 51, 102, 0.2);
        border-color: #f36;
      }
      #content {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
      }
      .panel {
        background: #0f0f1a;
        border: 1px solid #1a1a2e;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
      }
      .panel h2 {
        font-family: "Orbitron";
        color: #0ff;
        margin-bottom: 12px;
        font-size: 16px;
      }
      .case-card {
        background: #1a1a2e;
        border: 2px solid #2a2a4e;
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 10px;
        cursor: pointer;
      }
      .case-card:hover,
      .case-card.active {
        border-color: #0ff;
      }
      .case-card h4 {
        color: #fff;
        font-size: 14px;
      }
      .case-card p {
        color: #888;
        font-size: 12px;
      }
      .evidence-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 10px;
      }
      .evidence-card {
        background: #1a1a2e;
        border: 2px solid #2a2a4e;
        border-radius: 8px;
        padding: 10px;
        cursor: pointer;
      }
      .evidence-card:hover {
        border-color: #0ff;
      }
      .evidence-img {
        height: 80px;
        background: #0a0a12;
        border-radius: 5px;
        margin-bottom: 8px;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .evidence-img img {
        max-width: 100%;
        max-height: 100%;
      }
      .badge {
        font-size: 10px;
        padding: 3px 8px;
        border-radius: 4px;
      }
      .badge-pending {
        background: rgba(255, 153, 0, 0.3);
        color: #f90;
      }
      .badge-ok {
        background: rgba(0, 255, 136, 0.3);
        color: #0f8;
      }
      .badge-fake {
        background: rgba(255, 51, 102, 0.3);
        color: #f36;
      }
      .recipient-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
        margin: 10px 0;
      }
      .recipient-opt {
        background: #1a1a2e;
        border: 2px solid #2a2a4e;
        padding: 12px;
        text-align: center;
        border-radius: 8px;
        cursor: pointer;
      }
      .recipient-opt:hover,
      .recipient-opt.selected {
        border-color: #0ff;
        background: rgba(0, 255, 255, 0.1);
      }
      .recipient-opt .icon {
        font-size: 24px;
      }
      .recipient-opt .name {
        color: #fff;
        font-size: 11px;
      }
      .send-btn {
        width: 100%;
        background: linear-gradient(135deg, #0f8, #0ff);
        color: #000;
        border: none;
        padding: 14px;
        font-family: "Orbitron";
        cursor: pointer;
        border-radius: 8px;
        margin-top: 10px;
      }
      .send-btn:disabled {
        background: #333;
        color: #666;
      }
      #analysis {
        position: fixed;
        inset: 0;
        background: #000;
        z-index: 600;
        display: none;
        flex-direction: column;
      }
      #analysis-header {
        background: #1a1a2e;
        padding: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      #analysis-header h2 {
        font-family: "Orbitron";
        color: #0ff;
        font-size: 14px;
      }
      #analysis-header button {
        background: #f36;
        border: none;
        color: #fff;
        padding: 8px 15px;
        cursor: pointer;
        border-radius: 5px;
      }
      #analysis-body {
        flex: 1;
        display: flex;
        flex-direction: column;
      }
      #img-viewer {
        flex: 1;
        background: #050508;
        display: flex;
        flex-direction: row;
        overflow: auto;
      }
      #img-viewer img {
        max-width: 100%;
        transition: transform 0.3s;
        cursor: zoom-in;
      }
      #tools-panel {
        background: #0a0a12;
        padding: 10px;
        overflow-y: auto;
        max-height: 40vh;
      }
      .tool-btn {
        width: 100%;
        padding: 10px;
        margin-bottom: 5px;
        background: #1a1a2e;
        border: 2px solid #2a2a4e;
        color: #888;
        font-size: 12px;
        cursor: pointer;
        text-align: left;
        border-radius: 5px;
      }
      .tool-btn:hover {
        border-color: #0ff;
        color: #0ff;
      }
      .tool-btn.locked {
        opacity: 0.4;
      }
      .tool-btn.blocked {
        opacity: 0.3;
        background: #333 !important;
        cursor: not-allowed;
      }
      .tool-btn.active {
        border-color: #0f8;
        color: #0f8;
      }
      #results-box {
        background: #1a1a2e;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
        max-height: 100px;
        overflow-y: auto;
      }
      .result-row {
        display: flex;
        justify-content: space-between;
        padding: 4px 0;
        font-size: 11px;
      }
      .result-val.sus {
        color: #f90;
      }
      .result-val.ok {
        color: #0f8;
      }
      #verdict-btns {
        display: flex;
        gap: 10px;
      }
      .verdict-btn {
        flex: 1;
        padding: 12px;
        border: 2px solid;
        background: transparent;
        font-family: "Orbitron";
        font-size: 12px;
        cursor: pointer;
        border-radius: 8px;
      }
      .v-ok {
        border-color: #0f8;
        color: #0f8;
      }
      .v-fake {
        border-color: #f36;
        color: #f36;
      }
      #visitor {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.95);
        z-index: 400;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 15px;
      }
      #visitor-box {
        background: #1a1a2e;
        border: 2px solid #0ff;
        border-radius: 15px;
        padding: 20px;
        max-width: 400px;
        width: 100%;
      }
      .visitor-head {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 15px;
      }
      .visitor-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: #0ff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
      }
      #visitor-complaint {
        color: #ddd;
        margin-bottom: 15px;
        padding: 12px;
        background: #0a0a12;
        border-radius: 8px;
        border-left: 3px solid #f90;
        max-height: 200px;
        overflow-y: auto;
        font-size: 13px;
        line-height: 1.5;
      }
      .visitor-btns {
        display: flex;
        gap: 10px;
      }
      .visitor-btns button {
        flex: 1;
        padding: 12px;
        font-family: "Orbitron";
        border-radius: 8px;
        cursor: pointer;
      }
      #btn-accept {
        background: #0ff;
        color: #000;
        border: none;
      }
      #btn-reject {
        background: transparent;
        border: 2px solid #f36;
        color: #f36;
      }
      #result {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.95);
        z-index: 700;
        display: none;
        align-items: center;
        justify-content: center;
      }
      #result-box {
        text-align: center;
      }
      #result-icon {
        font-size: 60px;
      }
      #result-title {
        font-family: "Orbitron";
        font-size: 24px;
        margin: 10px 0;
      }
      #result-msg {
        color: #aaa;
        margin-bottom: 15px;
      }
      #result-reward {
        font-family: "Orbitron";
        font-size: 20px;
        margin-bottom: 20px;
      }
      #result button {
        background: #0ff;
        color: #000;
        border: none;
        padding: 12px 30px;
        font-family: "Orbitron";
        cursor: pointer;
        border-radius: 8px;
      }
      #notif {
        position: fixed;
        top: 60px;
        right: 10px;
        background: #1a1a2e;
        border: 2px solid #0ff;
        border-radius: 10px;
        padding: 12px;
        z-index: 1000;
        display: none;
        max-width: 200px;
      }
      #notif h4 {
        color: #0ff;
        font-size: 11px;
      }
      #notif p {
        color: #aaa;
        font-size: 11px;
      }
      .shop-item {
        background: #1a1a2e;
        border: 2px solid #2a2a4e;
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .shop-btn {
        background: #fc0;
        color: #000;
        border: none;
        padding: 8px 15px;
        cursor: pointer;
        border-radius: 5px;
      }
      .shop-btn:disabled {
        background: #333;
        color: #666;
      }
      .mail-item {
        background: #1a1a2e;
        border: 2px solid #2a2a4e;
        border-radius: 8px;
        padding: 10px;
        margin-bottom: 8px;
        cursor: pointer;
      }
      .mail-item.unread {
        border-left: 4px solid #0ff;
      }
      #scene-overlay {
        position: fixed;
        inset: 0;
        background: #000;
        z-index: 800;
        display: none;
        flex-direction: column;
      }
      #scene-canvas {
        width: 100%;
        height: 40vh;
      }
      #scene-ui {
        padding: 15px;
        overflow-y: auto;
        flex: 1;
        background: linear-gradient(transparent, rgba(0, 0, 0, 0.9));
      }
      #scene-dialogue {
        background: #1a1a2e;
        border: 2px solid #0ff;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 10px;
      }
      .scene-speaker {
        font-family: "Orbitron";
        font-size: 14px;
        margin-bottom: 8px;
      }
      .scene-speaker.judge {
        color: #fc0;
      }
      .scene-speaker.police {
        color: #36f;
      }
      .scene-speaker.defense {
        color: #f36;
      }
      .scene-speaker.you {
        color: #0f8;
      }
      #scene-text {
        color: #ddd;
        line-height: 1.5;
        font-size: 13px;
        min-height: 40px;
      }
      #scene-input {
        display: none;
        margin-top: 10px;
      }
      #scene-input textarea {
        width: 100%;
        background: #0a0a12;
        border: 2px solid #0ff;
        color: #fff;
        padding: 10px;
        border-radius: 8px;
        font-size: 13px;
        min-height: 60px;
        resize: none;
      }
      #scene-input button {
        width: 100%;
        background: linear-gradient(135deg, #0ff, #0f8);
        color: #000;
        border: none;
        padding: 12px;
        font-family: "Orbitron";
        cursor: pointer;
        border-radius: 8px;
        margin-top: 8px;
      }
      #scene-options {
        display: none;
        margin-top: 10px;
      }
      .scene-option {
        background: #1a1a2e;
        border: 2px solid #2a2a4e;
        color: #aaa;
        padding: 10px;
        margin-bottom: 5px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 12px;
      }
      .scene-option:hover {
        border-color: #0ff;
        color: #0ff;
      }
      #scene-result {
        display: none;
        text-align: center;
        padding: 20px;
      }
      #scene-result h2 {
        font-family: "Orbitron";
        font-size: 24px;
        margin-bottom: 15px;
      }
      #scene-result p {
        color: #aaa;
        margin-bottom: 20px;
      }
      #scene-result button {
        background: linear-gradient(135deg, #0ff, #0f8);
        color: #000;
        border: none;
        padding: 12px 30px;
        font-family: "Orbitron";
        cursor: pointer;
        border-radius: 8px;
      }
      #client-chat {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.95);
        z-index: 650;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 15px;
      }
      #chat-box {
        background: #1a1a2e;
        border: 2px solid #0ff;
        border-radius: 15px;
        padding: 20px;
        max-width: 500px;
        width: 100%;
        max-height: 80vh;
        display: flex;
        flex-direction: column;
      }
      #chat-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }
      #chat-header h3 {
        color: #0ff;
        font-family: "Orbitron";
      }
      #chat-close {
        background: #f36;
        color: #fff;
        border: none;
        padding: 8px 15px;
        cursor: pointer;
        border-radius: 5px;
      }
      #chat-messages {
        flex: 1;
        overflow-y: auto;
        margin-bottom: 15px;
        max-height: 300px;
      }
      .chat-msg {
        padding: 10px;
        margin-bottom: 8px;
        border-radius: 8px;
        font-size: 13px;
      }
      .chat-msg.client {
        background: #2a2a4e;
        color: #fff;
        margin-right: 40px;
      }
      .chat-msg.you {
        background: #0a3a3a;
        color: #0ff;
        margin-left: 40px;
        text-align: right;
      }
      #chat-input {
        display: flex;
        gap: 10px;
      }
      #chat-input textarea {
        flex: 1;
        background: #0a0a12;
        border: 2px solid #0ff;
        color: #fff;
        padding: 10px;
        border-radius: 8px;
        resize: none;
        min-height: 50px;
      }
      #chat-input button {
        background: #0ff;
        color: #000;
        border: none;
        padding: 10px 20px;
        cursor: pointer;
        border-radius: 8px;
        font-family: "Orbitron";
      }
    </style>
  </head>
  <body>
    <div id="suspended" style="display: none">
      <h1>‚õî ZAWIESZONY</h1>
      <p>Twoja licencja detektywa zosta≈Ça zawieszona za b≈Çƒôdne wnioski.</p>
      <p>Mo≈ºesz wr√≥ciƒá za:</p>
      <div class="time" id="suspend-time">00:00:00</div>
      <p style="color: #666; font-size: 12px">Zamknij stronƒô i wr√≥ƒá p√≥≈∫niej.</p>
    </div>
    <div id="loader">
      <svg
        id="loader-logo"
        viewBox="0 0 120 120"
        xmlns="http://www.w3.org/2000/svg"
      >
        <defs>
          <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color: #0ff" />
            <stop offset="100%" style="stop-color: #0f8" />
          </linearGradient>
        </defs>
        <rect fill="#0a0a12" width="120" height="120" rx="15" />
        <circle
          cx="45"
          cy="50"
          r="28"
          fill="none"
          stroke="url(#grad1)"
          stroke-width="5"
        />
        <line
          x1="66"
          y1="71"
          x2="95"
          y2="100"
          stroke="url(#grad1)"
          stroke-width="6"
          stroke-linecap="round"
        />
        <circle cx="85" cy="30" r="12" fill="#f36" />
        <text
          x="85"
          y="35"
          text-anchor="middle"
          fill="white"
          font-size="16"
          font-weight="bold"
        >
          !
        </text>
      </svg>
      <h1>CYBER DETECTIVE</h1>
      <div id="loader-percent">0%</div>
      <div id="loader-bar-container"><div id="loader-bar"></div></div>
      <div id="loader-text">Inicjalizacja...</div>
    </div>
    <div id="intro">
      <h1>CYBER DETECTIVE</h1>
      <p>≈öledczy ds. Cyberprzestƒôpczo≈õci</p>
      <div class="rules-box">
        <div
          style="
            color: #0ff;
            font-weight: bold;
            font-size: 15px;
            margin-bottom: 10px;
          "
        >
          üìã INSTRUKCJA GRY
        </div>

        <div style="color: #fc0; font-weight: bold; margin-bottom: 5px">
          üéØ CEL GRY:
        </div>
        <div style="margin-bottom: 15px">
          Jeste≈õ detektywem cyfrowym. Analizujesz dowody cyberprzestƒôpstw i
          przedstawiasz sprawy w sƒÖdzie lub na policji. Zarabiasz pieniƒÖdze za
          poprawne wnioski, tracisz za b≈Çƒôdy!
        </div>

        <div style="color: #0f8; font-weight: bold; margin-bottom: 5px">
          üè¢ LOKALIZACJE W BIURZE:
        </div>
        <div style="margin-bottom: 15px">
          ‚Ä¢ üö™ DRZWI - przyjmowanie nowych klient√≥w<br />
          ‚Ä¢ üíª KOMPUTER - analiza dowod√≥w i wysy≈Çanie spraw<br />
          ‚Ä¢ üõí SKLEP - kupowanie narzƒôdzi forensycznych
        </div>

        <div style="color: #0ff; font-weight: bold; margin-bottom: 5px">
          üî¨ ANALIZA DOWOD√ìW (przy komputerze):
        </div>
        <div style="margin-bottom: 15px">
          1. Wejd≈∫ w zak≈Çadkƒô üìã SPRAWY<br />
          2. Wybierz sprawƒô i kliknij üîç ANALIZUJ<br />
          3. U≈ºyj narzƒôdzi do zbadania dowodu:<br />
          ‚Ä¢ üîç Lupa - powiƒôkszenie 2.5x (darmowa)<br />
          ‚Ä¢ üìä Meta - metadane pliku (800üí∞)<br />
          ‚Ä¢ ‚ö° ELA - analiza poziomu b≈Çƒôd√≥w (1500üí∞)<br />
          ‚Ä¢ üî§ Font - wykrywanie font√≥w (1000üí∞)<br />
          ‚Ä¢ üïê Czas - analiza daty (1200üí∞)<br />
          ‚Ä¢ ü§ñ AI - wykrywanie AI (3000üí∞)<br />
          4. Oce≈Ñ dow√≥d: ‚úì PRAWDZIWY lub ‚úó FA≈ÅSZYWY
        </div>

        <div style="color: #fc0; font-weight: bold; margin-bottom: 5px">
          üì§ WYSY≈ÅANIE SPRAW:
        </div>
        <div style="margin-bottom: 15px">
          üöî POLICJA - gro≈∫by, stalking, hacking, oszustwa<br />
          ‚öñÔ∏è SƒÑD - znies≈Çawienie, podszywanie siƒô<br />
          üìã PROKURATURA - szanta≈º, wy≈Çudzenia
        </div>

        <div style="color: #f36; font-weight: bold; margin-bottom: 5px">
          ‚öñÔ∏è ROZPRAWA/PRZES≈ÅUCHANIE:
        </div>
        <div style="margin-bottom: 15px">
          Odpowiadaj na pytania sƒôdziego lub policji! Twoje zeznania MUSZƒÑ byƒá
          sp√≥jne z tym jak oceni≈Çe≈õ dowody. U≈ºywaj s≈Ç√≥w kluczowych zwiƒÖzanych ze
          sprawƒÖ.
        </div>

        <div style="color: #f90; font-weight: bold; margin-bottom: 5px">
          ‚ö†Ô∏è UWAGA - KLIENT MO≈ªE K≈ÅAMAƒÜ!
        </div>
        <div style="margin-bottom: 15px">
          Niekt√≥rzy klienci sami fa≈ÇszujƒÖ dowody! Je≈õli odkryjesz ≈ºe to KLIENT
          sfabrykowa≈Ç dowody - mo≈ºesz oskar≈ºyƒá JEGO zamiast rzekomego sprawcy!
        </div>

        <div style="color: #0f8; font-weight: bold; margin-bottom: 5px">
          üí∞ SYSTEM PODATK√ìW:
        </div>
        <div style="margin-bottom: 15px">
          Ka≈ºde zakupione narzƒôdzie pobiera % od wyp≈Çat:<br />
          Meta 5%, ELA 10%, Font 6%, Czas 8%, AI 15%<br />
          Wszystkie razem = 44% podatku!<br />
          Mo≈ºesz sprzedaƒá narzƒôdzia w sklepie za 5% ceny.
        </div>

        <div style="color: #0ff; font-weight: bold; margin-bottom: 5px">
          üí¨ ROZMOWY Z KLIENTAMI:
        </div>
        <div style="margin-bottom: 15px">
          Mo≈ºesz rozmawiaƒá z klientami przez czat! Popro≈õ o dodatkowe screeny -
          ale pamiƒôtaj: je≈õli pierwszy dow√≥d by≈Ç fa≈Çszywy, kolejne te≈º bƒôdƒÖ
          fa≈Çszywe!
        </div>

        <div style="color: #fc0; font-weight: bold; margin-bottom: 5px">
          üí° WSKAZ√ìWKI:
        </div>
        <div>
          ‚Ä¢ Czytaj uwa≈ºnie historiƒô klienta<br />
          ‚Ä¢ Sprawd≈∫ wszystkie narzƒôdzia<br />
          ‚Ä¢ Pamiƒôtaj co zaznaczy≈Çe≈õ (prawdziwe/fa≈Çszywe)<br />
          ‚Ä¢ Nie spiesz siƒô z ocenƒÖ!<br />
          ‚Ä¢ Negocjuj cenƒô z klientami
        </div>
      </div>
      <button id="start-btn">‚ñ∂ ROZPOCZNIJ GRƒò</button>
    </div>
    <canvas id="canvas"></canvas>
    <div id="crosshair"></div>
    <div id="prompt"></div>
    <div id="touch-btn">üëÜ WEJD≈π</div>
    <div id="hud">
      <div>üí∞ <span id="hud-credits">500</span></div>
      <div>üìã <span id="hud-cases">0</span></div>
      <div>üìÖ Dzie≈Ñ <span id="hud-day">1</span></div>
      <div style="color: #f90">üìâ <span id="hud-tax">0%</span></div>
    </div>
    <div id="computer">
      <div id="computer-bar">
        <span>üñ•Ô∏è TERMINAL</span><button id="exit-btn">‚úï</button>
      </div>
      <div id="computer-main">
        <div id="sidebar">
          <div class="nav-item active" data-panel="case">üìã</div>
          <div class="nav-item" data-panel="send">üì§</div>
          <div class="nav-item" data-panel="inbox">üì¨</div>
          <div class="nav-item" data-panel="shop">üõí</div>
          <div class="nav-item" data-panel="archive">üìÅ</div>
        </div>
        <div id="content"></div>
      </div>
    </div>
    <div id="analysis">
      <div id="analysis-header">
        <h2>üî¨ ANALIZA</h2>
        <button id="close-analysis">‚úï</button>
      </div>
      <div id="analysis-body">
        <div id="img-viewer">
          <div
            id="evidence-side"
            style="
              flex: 1;
              display: flex;
              align-items: center;
              justify-content: center;
              overflow: auto;
              padding: 10px;
            "
          >
            <img
              id="analysis-img"
              src=""
              style="display: block; max-width: 100%; max-height: 100%"
            />
          </div>
          <div
            id="compare-panel"
            style="
              display: none;
              width: 45%;
              background: #0a0a15;
              border-left: 2px solid #0ff;
              padding: 10px;
              overflow: auto;
            "
          >
            <h4 style="color: #0ff; font-size: 11px; margin-bottom: 5px">
              üìã ORYGINA≈Å (do por√≥wnania)
            </h4>
            <img
              id="compare-img"
              src=""
              style="width: 100%; border-radius: 5px; cursor: zoom-in"
            />
          </div>
        </div>
        <div id="tools-panel"></div>
      </div>
    </div>
    <div id="visitor">
      <div id="visitor-box">
        <div class="visitor-head">
          <div class="visitor-avatar" id="v-avatar">üë§</div>
          <div>
            <h3 id="v-name" style="color: #fff">Klient</h3>
            <p style="color: #0f8">
              Bazowa op≈Çata: <span id="v-fee">100</span>üí∞
            </p>
          </div>
        </div>
        <div id="visitor-complaint"></div>
        <p style="color: #f90; font-size: 12px">
          ‚è∞ Termin: <span id="v-deadline">3</span> dni | Kara:
          <span id="v-penalty">200</span>üí∞ (sta≈Ça)
        </p>
        <div
          style="
            margin: 15px 0;
            padding: 10px;
            background: #1a1a2e;
            border-radius: 8px;
          "
        >
          <p style="color: #0ff; font-size: 12px; margin-bottom: 8px">
            üí∞ NEGOCJUJ CENƒò:
          </p>
          <div style="display: flex; gap: 10px; align-items: center">
            <input
              type="number"
              id="price-input"
              style="
                flex: 1;
                padding: 10px;
                background: #0a0a12;
                border: 1px solid #0ff;
                color: #fff;
                border-radius: 5px;
                font-size: 16px;
              "
              placeholder="Wpisz kwotƒô..."
            /><span style="color: #fff">üí∞</span>
          </div>
          <p
            id="price-response"
            style="
              color: #888;
              font-size: 11px;
              margin-top: 8px;
              font-style: italic;
            "
          ></p>
        </div>
        <div class="visitor-btns" style="margin-top: 15px">
          <button id="btn-accept">
            ‚úì PRZYJMIJ ZA <span id="agreed-price">100</span>üí∞</button
          ><button id="btn-reject">‚úï ODRZUƒÜ</button>
        </div>
      </div>
    </div>
    <div
      id="wrong-place"
      style="
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.9);
        z-index: 800;
        align-items: center;
        justify-content: center;
      "
    >
      <div
        style="
          background: #1a1a2e;
          border: 3px solid #f36;
          border-radius: 15px;
          padding: 30px;
          text-align: center;
          max-width: 400px;
        "
      >
        <div style="font-size: 50px; margin-bottom: 15px">‚ùå</div>
        <h2 style="color: #f36; margin-bottom: 15px">Z≈ÅEY ADRESAT!</h2>
        <p
          id="wrong-place-msg"
          style="color: #fff; font-size: 14px; margin-bottom: 15px"
        ></p>
        <p style="color: #f90; font-size: 16px; margin-bottom: 20px">
          Kara: -50üí∞
        </p>
        <p style="color: #888; font-size: 12px; margin-bottom: 20px">
          Sprawa nie zosta≈Ça usuniƒôta - wy≈õlij jƒÖ we w≈Ça≈õciwe miejsce.
        </p>
        <button
          onclick="document.getElementById('wrong-place').style.display='none'"
          style="
            background: #0ff;
            color: #000;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-family: Orbitron;
            cursor: pointer;
            font-size: 14px;
          "
        >
          ROZUMIEM
        </button>
      </div>
    </div>
    <div id="result">
      <div id="result-box">
        <div id="result-icon">‚úì</div>
        <h2 id="result-title">SUKCES!</h2>
        <p id="result-msg"></p>
        <p id="result-reward">+300üí∞</p>
        <button id="continue-btn">DALEJ ‚Üí</button>
      </div>
    </div>
    <div id="notif">
      <h4 id="notif-title">Info</h4>
      <p id="notif-msg">Msg</p>
    </div>
    <div
      id="client-chat"
      style="
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.95);
        z-index: 650;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 15px;
      "
    >
      <div
        style="
          background: #1a1a2e;
          border: 2px solid #0ff;
          border-radius: 15px;
          padding: 20px;
          max-width: 500px;
          width: 100%;
          max-height: 80vh;
          overflow-y: auto;
        "
      >
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
          "
        >
          <h3 style="color: #0ff; font-family: Orbitron" id="chat-client-name">
            üí¨ Klient
          </h3>
          <button
            id="close-chat"
            style="
              background: #f36;
              color: #fff;
              border: none;
              padding: 5px 12px;
              border-radius: 5px;
              cursor: pointer;
            "
          >
            ‚úï
          </button>
        </div>
        <div
          id="chat-messages"
          style="
            background: #0a0a12;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
            min-height: 150px;
            max-height: 300px;
            overflow-y: auto;
          "
        ></div>
        <textarea
          id="chat-input"
          placeholder="Napisz do klienta..."
          style="
            width: 100%;
            background: #0a0a12;
            border: 2px solid #2a2a4e;
            color: #fff;
            padding: 10px;
            border-radius: 8px;
            min-height: 60px;
            resize: none;
            margin-bottom: 10px;
          "
        ></textarea>
        <button
          id="chat-send"
          style="
            width: 100%;
            background: linear-gradient(135deg, #0ff, #0f8);
            color: #000;
            border: none;
            padding: 12px;
            font-family: Orbitron;
            cursor: pointer;
            border-radius: 8px;
          "
        >
          üì§ WY≈öLIJ
        </button>
      </div>
    </div>
    <div
      id="mediator-chat"
      style="
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.95);
        z-index: 650;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 15px;
      "
    >
      <div
        style="
          background: #1a1a2e;
          border: 2px solid #fc0;
          border-radius: 15px;
          padding: 20px;
          max-width: 500px;
          width: 100%;
          max-height: 80vh;
          overflow-y: auto;
        "
      >
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
          "
        >
          <h3 style="color: #fc0; font-family: Orbitron">ü§µ PO≈öREDNIK</h3>
          <button
            id="close-mediator"
            style="
              background: #f36;
              color: #fff;
              border: none;
              padding: 5px 12px;
              border-radius: 5px;
              cursor: pointer;
            "
          >
            ‚úï
          </button>
        </div>
        <p style="color: #888; font-size: 12px; margin-bottom: 10px">
          Rozmowa za darmo | Porada: <span style="color: #fc0">50üí∞</span>
        </p>
        <div
          id="mediator-messages"
          style="
            background: #0a0a12;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
            min-height: 150px;
            max-height: 300px;
            overflow-y: auto;
          "
        ></div>
        <textarea
          id="mediator-input"
          placeholder="Opisz sprawƒô po≈õrednikowi..."
          style="
            width: 100%;
            background: #0a0a12;
            border: 2px solid #2a2a4e;
            color: #fff;
            padding: 10px;
            border-radius: 8px;
            min-height: 60px;
            resize: none;
            margin-bottom: 10px;
          "
        ></textarea>
        <button
          id="mediator-send"
          style="
            width: 100%;
            background: linear-gradient(135deg, #fc0, #f90);
            color: #000;
            border: none;
            padding: 12px;
            font-family: Orbitron;
            cursor: pointer;
            border-radius: 8px;
          "
        >
          üì§ WY≈öLIJ
        </button>
      </div>
    </div>
    <div id="scene-overlay">
      <canvas id="scene-canvas"></canvas>
      <div id="scene-ui">
        <div id="scene-dialogue">
          <div class="scene-speaker" id="scene-speaker">‚öñÔ∏è SƒòDZIA</div>
          <div id="scene-text">...</div>
        </div>
        <div id="scene-input">
          <textarea
            id="scene-textarea"
            placeholder="Twoja odpowied≈∫..."
          ></textarea>
          <button id="scene-submit">üì¢ ODPOWIEDZ</button>
        </div>
        <div id="scene-options"></div>
        <div id="scene-result">
          <h2 id="scene-verdict-title">WYROK</h2>
          <p id="scene-verdict-text"></p>
          <button id="scene-exit">ZAKO≈ÉCZ</button>
        </div>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
      var G = {
        credits: 500,
        day: 1,
        activeCases: [],
        selectedCase: null,
        inPC: false,
        tools: {
          zoom: true,
          meta: false,
          ela: false,
          font: false,
          time: false,
          ai: false,
        },
        results: {},
        completed: [],
        inbox: [],
        suspendedUntil: 0,
      };
      var sceneData = { type: null, caseData: null, correct: false, phase: 0 };
      var sceneScene,
        sceneCamera,
        sceneRenderer,
        sceneRotY = 0,
        sceneRotX = 0;
      var TOOLS = {
        zoom: { n: "üîç Lupa", p: 0, tax: 0 },
        meta: { n: "üìä Meta", p: 800, tax: 5 },
        ela: { n: "‚ö° ELA", p: 1500, tax: 10 },
        font: { n: "üî§ Font", p: 1000, tax: 6 },
        time: { n: "üïê Czas", p: 1200, tax: 8 },
        ai: { n: "ü§ñ AI", p: 3000, tax: 15 },
      };
      function getTotalTax() {
        var t = 0;
        for (var k in TOOLS) {
          if (G.tools[k] && TOOLS[k].tax) t += TOOLS[k].tax;
        }
        return t;
      }
      function sellTool(k) {
        if (!G.tools[k] || k == "zoom") return;
        var refund = Math.floor(TOOLS[k].p * 0.05);
        G.credits += refund;
        G.tools[k] = false;
        saveGame();
        updateHUD();
        notify("Sprzedano!", TOOLS[k].n + " +" + refund + "üí∞");
      }
      var CASES = [
        {
          id: 1,
          name: "Anna Nowak",
          avatar: "üë©",
          fee: 100,
          days: 3,
          pen: 200,
          rew: 400,
          fine: 200,
          type: "ZNIES≈ÅAWIENIE",
          complaint: "Fa≈Çszywe screeny Messenger",
          clientLies: false,
          fullStory:
            "Prowadzƒô sklep internetowy od 5 lat. Tydzie≈Ñ temu na Facebooku pojawi≈Çy siƒô screeny z Messengera gdzie niby przyznajƒô siƒô do oszukiwania klient√≥w na wadze produkt√≥w. Problem w tym ≈ºe NIGDY czego≈õ takiego nie napisa≈Çam! Straci≈Çam ju≈º 15 klient√≥w, ludzie piszƒÖ ≈ºe jestem oszustkƒÖ. Mam podejrzenia kto to zrobi≈Ç - moja by≈Ça pracownica Kasia, kt√≥rƒÖ zwolni≈Çam miesiƒÖc temu. Proszƒô o pomoc, to rujnuje m√≥j biznes!",
          keywords: [
            "sklep",
            "kasia",
            "pracownic",
            "zwolni",
            "messenger",
            "waga",
            "klient",
            "oszuk",
            "facebook",
            "screen",
          ],
          suspect: "Kasia - by≈Ça pracownica",
          evidence: [
            {
              id: "e1",
              tp: "MESSENGER",
              fake: true,
              txt: "Tak haha oszukujemy klient√≥w na wadze üòÇ Nikt siƒô nie kapnie!",
              ind: {
                meta: { s: 1, i: "Photoshop CC 2024 - plik edytowany" },
                ela: { s: 1, i: "Widoczne ≈õlady manipulacji przy tek≈õcie" },
                font: { s: 1, i: "Czcionka nie pasuje do Messengera" },
                time: { s: 1, i: "03:47 - klientka spa≈Ça o tej porze" },
                ai: { s: 1, i: "94% prawdopodobie≈Ñstwo manipulacji" },
              },
            },
          ],
        },
        {
          id: 2,
          name: "Marek Wi≈õniewski",
          avatar: "üë®‚Äçüíº",
          fee: 150,
          days: 4,
          pen: 300,
          rew: 500,
          fine: 250,
          type: "GRO≈πBY",
          complaint: "Gro≈∫by od by≈Çego wsp√≥lnika",
          clientLies: false,
          fullStory:
            'By≈Çem wsp√≥lnikiem w firmie IT z Tomkiem K. Rozstali≈õmy siƒô w z≈Çych stosunkach - oskar≈ºa≈Ç mnie o kradzie≈º kodu. Od 2 tygodni dostajƒô maile z gro≈∫bami. Pisze ≈ºe "zniszczy mnie i mojƒÖ rodzinƒô", "wie gdzie mieszkam", "po≈ºa≈Çujƒô". Bojƒô siƒô o ≈ºonƒô i dzieci. Zg≈Çosi≈Çem ju≈º na policjƒô ale powiedzieli ≈ºe potrzebujƒÖ dowod√≥w ≈ºe to on. Maile przychodzƒÖ z anonimowego adresu ale styl pisania to NA PEWNO Tomek.',
          keywords: [
            "tomek",
            "wsp√≥lnik",
            "firma",
            "it",
            "kod",
            "mail",
            "gro≈∫b",
            "rodzin",
            "≈ºon",
            "dzieci",
            "anonimow",
          ],
          suspect: "Tomek K. - by≈Çy wsp√≥lnik",
          evidence: [
            {
              id: "e2",
              tp: "EMAIL",
              fake: false,
              txt: "Zniszczƒô ciƒô i twojƒÖ rodzinƒô. Wiem gdzie mieszkasz. Wiem gdzie chodzi tw√≥j syn do szko≈Çy. Po≈ºa≈Çujesz ≈ºe siƒô ze mnƒÖ zadziera≈Çe≈õ.",
              ind: {
                meta: { s: 0, i: "Nag≈Ç√≥wek email oryginalny - serwer Gmail" },
                ela: { s: 0, i: "Brak ≈õlad√≥w edycji" },
                font: { s: 0, i: "Standardowa czcionka email" },
                time: { s: 0, i: "Znaczniki czasowe sp√≥jne" },
                ai: { s: 0, i: "6% - wiadomo≈õƒá autentyczna" },
              },
            },
          ],
        },
        {
          id: 3,
          name: "Katarzyna D.",
          avatar: "üë©‚Äçü¶∞",
          fee: 80,
          days: 2,
          pen: 150,
          rew: 350,
          fine: 175,
          type: "STALKING",
          complaint: "By≈Çy partner mnie ≈õledzi",
          clientLies: false,
          fullStory:
            'Rozsta≈Çam siƒô z Micha≈Çem 3 miesiƒÖce temu. Od tamtej pory non stop dostaje wiadomo≈õci ≈ºe mnie widzia≈Ç - w kawiarni, w pracy, w sklepie. Pisze dok≈Çadnie w co by≈Çam ubrana, z kim rozmawia≈Çam. Wczoraj napisa≈Ç ≈ºe "≈Çadnie mi w tej niebieskiej sukience" - a by≈Çam w niej tylko 2 godziny! Bojƒô siƒô wychodziƒá z domu. Mam screeny z WhatsApp. Proszƒô o pomoc, czujƒô siƒô obserwowana 24/7.',
          keywords: [
            "micha≈Ç",
            "partner",
            "whatsapp",
            "≈õledzi",
            "obserwu",
            "sukienk",
            "kawiarni",
            "ubran",
            "wiadomo",
            "boi",
          ],
          suspect: "Micha≈Ç - by≈Çy partner",
          evidence: [
            {
              id: "e3",
              tp: "WHATSAPP",
              fake: false,
              txt: "Widzia≈Çem ciƒô dzi≈õ w Starbucks o 14:30. ≈Åadna ta niebieska sukienka. Kawa z kole≈ºankƒÖ? Ta blondynka to Ania z pracy?",
              ind: {
                meta: { s: 0, i: "Oryginalny backup WhatsApp - iPhone" },
                ela: { s: 0, i: "Zrzut niemodyfikowany" },
                font: { s: 0, i: "Czcionka WhatsApp prawid≈Çowa" },
                time: { s: 0, i: "Znaczniki sp√≥jne z datƒÖ" },
                ai: { s: 0, i: "4% - wiadomo≈õƒá autentyczna" },
              },
            },
          ],
        },
        {
          id: 4,
          name: "Piotr Lewandowski",
          avatar: "üë®‚Äçüíª",
          fee: 120,
          days: 3,
          pen: 250,
          rew: 450,
          fine: 225,
          type: "PODSZYWANIE",
          complaint: "Fa≈Çszywe konto z rasizmem",
          clientLies: false,
          fullStory:
            "Jestem programistƒÖ, aktywnym na Twitterze/X. Kto≈õ stworzy≈Ç konto @PiotrLew_PRAWDA i publikuje rasistowskie i antysemickie tre≈õci. U≈ºywa mojego zdjƒôcia i nazwiska! Moi klienci my≈õlƒÖ ≈ºe to ja. Straci≈Çem ju≈º 2 kontrakty. Twitter nie reaguje na zg≈Çoszenia. Mam screeny tych post√≥w. Podejrzewam konkurencjƒô - firmƒô DataSoft, z kt√≥rƒÖ walczy≈Çem o du≈ºy kontrakt.",
          keywords: [
            "programist",
            "twitter",
            "datasoft",
            "konkurencj",
            "konto",
            "rasist",
            "zdjƒôci",
            "kontrakt",
            "podszywa",
            "fa≈Çszyw",
          ],
          suspect: "Firma DataSoft - konkurencja",
          evidence: [
            {
              id: "e4",
              tp: "TWITTER",
              fake: true,
              txt: "Imigranci won z Polski! Polska dla prawdziwych Polak√≥w! üáµüá± #wyp****ol",
              ind: {
                meta: { s: 1, i: "Zrzut edytowany - Photoshop" },
                ela: { s: 1, i: "Avatar wklejony z innego ≈∫r√≥d≈Ça" },
                font: { s: 1, i: "Czcionka nie pasuje do X/Twitter" },
                time: { s: 0, i: "Data publikacji mo≈ºliwa" },
                ai: { s: 1, i: "91% - profil sfabrykowany" },
              },
            },
          ],
        },
        {
          id: 5,
          name: "Ewa Kami≈Ñska",
          avatar: "üë©‚Äçüíº",
          fee: 200,
          days: 3,
          pen: 400,
          rew: 600,
          fine: 300,
          type: "OSZUSTWO",
          complaint: "Wy≈Çudzenie na fa≈ÇszywƒÖ zbi√≥rkƒô",
          clientLies: false,
          fullStory:
            'Wp≈Çaci≈Çam 5000 z≈Ç na zbi√≥rkƒô "Pomoc dla chorego Jasia" na Facebooku. Zbi√≥rka wyglƒÖda≈Ça wiarygodnie - zdjƒôcia dziecka w szpitalu, dokumenty. Po wp≈Çacie profil zniknƒÖ≈Ç! Napisa≈Çam do szpitala kt√≥ry by≈Ç podany - powiedzieli ≈ºe nie majƒÖ takiego pacjenta. Mam screeny zbi√≥rki i potwierdzenie przelewu. Proszƒô o pomoc w znalezieniu oszusta!',
          keywords: [
            "zbi√≥rk",
            "5000",
            "jasio",
            "szpital",
            "facebook",
            "przelew",
            "profil",
            "zniknƒÖ≈Ç",
            "oszust",
            "chory",
          ],
          suspect: "Nieznany - fa≈Çszywa zbi√≥rka",
          evidence: [
            {
              id: "e5",
              tp: "FACEBOOK",
              fake: false,
              txt: "Zbi√≥rka: Pomoc dla chorego Jasia ‚ù§Ô∏è Cel: 50000 z≈Ç. Jasio ma 5 lat i walczy z bia≈ÇaczkƒÖ...",
              ind: {
                meta: { s: 0, i: "Zrzut oryginalny - Chrome" },
                ela: { s: 0, i: "Bez edycji" },
                font: { s: 0, i: "Czcionka FB prawid≈Çowa" },
                time: { s: 0, i: "Data sp√≥jna" },
                ai: {
                  s: 0,
                  i: "3% - zrzut autentyczny (ale zbi√≥rka fa≈Çszywa)",
                },
              },
            },
          ],
        },
        {
          id: 6,
          name: "Tomasz Kowalczyk",
          avatar: "üë®",
          fee: 90,
          days: 2,
          pen: 180,
          rew: 380,
          fine: 190,
          type: "GRO≈πBY",
          complaint: "Gro≈∫by przez SMS",
          clientLies: false,
          fullStory:
            "Od tygodnia dostajƒô SMS-y z nieznanego numeru. Gro≈ºƒÖ ≈ºe mnie zabijƒÖ, ≈ºe wiedzƒÖ gdzie pracujƒô. Podejrzewam ≈ºe to przez konflikt z sƒÖsiadem - pok≈Ç√≥cili≈õmy siƒô o miejsce parkingowe. On to typ agresywny, ju≈º raz mia≈Ç sprawƒô o pobicie. Numer jest na kartƒô wiƒôc nie wiem jak udowodniƒá ≈ºe to on.",
          keywords: [
            "sms",
            "sƒÖsiad",
            "parking",
            "pobici",
            "numer",
            "karta",
            "gro≈∫b",
            "zabij",
            "praca",
            "konflikt",
          ],
          suspect: "SƒÖsiad - konflikt o parking",
          evidence: [
            {
              id: "e6",
              tp: "SMS",
              fake: false,
              txt: "Zabijƒô ciƒô i ca≈ÇƒÖ twojƒÖ rodzinƒô s********u. Wiem gdzie pracujesz. Uwa≈ºaj jak wychodzisz z roboty.",
              ind: {
                meta: { s: 0, i: "Zrzut Samsung - oryginalny" },
                ela: { s: 0, i: "Brak modyfikacji" },
                font: { s: 0, i: "Systemowa czcionka SMS" },
                time: { s: 0, i: "Daty wiadomo≈õci sp√≥jne" },
                ai: { s: 0, i: "5% - wiadomo≈õci autentyczne" },
              },
            },
          ],
        },
        {
          id: 7,
          name: "Magdalena Zieli≈Ñska",
          avatar: "üë©‚Äçüî¨",
          fee: 180,
          days: 4,
          pen: 350,
          rew: 550,
          fine: 275,
          type: "ZNIES≈ÅAWIENIE",
          complaint: "Fa≈Çszywy post o plagiacie",
          clientLies: false,
          fullStory:
            'Jestem doktorantkƒÖ na Politechnice. Na forum naukowym pojawi≈Ç siƒô post gdzie rzekomo przyznajƒô siƒô do plagiatu w pracy doktorskiej. Screenshot z Messengera gdzie piszƒô "skopiowa≈Çam 70% pracy, system antyplagiatowy tego nie wykry≈Ç". To NIEPRAWDA! Moja promotorka ju≈º ma wƒÖtpliwo≈õci. Podejrzewam zazdrosnƒÖ kole≈ºankƒô Anetƒô kt√≥ra te≈º pisze doktorat z tego tematu.',
          keywords: [
            "doktorant",
            "politechnik",
            "plagiat",
            "aneta",
            "kole≈ºank",
            "forum",
            "70%",
            "promotor",
            "praca",
            "screenshot",
          ],
          suspect: "Aneta - zazdrosna kole≈ºanka",
          evidence: [
            {
              id: "e7",
              tp: "FORUM POST",
              fake: true,
              txt: 'Screenshot rozmowy dr Zieli≈Ñskiej: "Tak, skopiowa≈Çam 70% pracy doktorskiej lol. System tego nie wykry≈Ç üòÇ"',
              ind: {
                meta: { s: 1, i: "Obraz edytowany - Canva" },
                ela: { s: 1, i: "Tekst wstawiony cyfrowo" },
                font: { s: 1, i: "Font nie pasuje do Messengera" },
                time: { s: 1, i: "Konto na forum za≈Ço≈ºone dzie≈Ñ przed postem" },
                ai: { s: 1, i: "89% - screenshot sfabrykowany" },
              },
            },
          ],
        },
        {
          id: 8,
          name: "Robert Adamski",
          avatar: "üë®‚Äçü¶≤",
          fee: 250,
          days: 5,
          pen: 500,
          rew: 700,
          fine: 350,
          type: "HACKING",
          complaint: "W≈Çamanie na konto bankowe",
          clientLies: false,
          fullStory:
            'W zesz≈Çym tygodniu kto≈õ w≈Çama≈Ç siƒô na moje konto w banku i przela≈Ç 12000 z≈Ç na zagraniczne konto. Bank m√≥wi ≈ºe logowanie by≈Ço z mojego urzƒÖdzenia ale to niemo≈ºliwe - by≈Çem w pracy! Podejrzewam phishing - tydzie≈Ñ wcze≈õniej dosta≈Çem dziwny mail "z banku". G≈Çupio kliknƒÖ≈Çem w link i wpisa≈Çem dane. Mam ten mail zapisany.',
          keywords: [
            "bank",
            "12000",
            "phishing",
            "mail",
            "link",
            "w≈Çaman",
            "przelew",
            "zagranic",
            "dane",
            "konto",
          ],
          suspect: "Nieznany haker - phishing",
          evidence: [
            {
              id: "e8",
              tp: "EMAIL PHISHING",
              fake: false,
              txt: "Szanowny Kliencie! Wykryli≈õmy podejrzanƒÖ aktywno≈õƒá. Kliknij aby zweryfikowaƒá: bank-weryfikacja.tk/login",
              ind: {
                meta: { s: 0, i: "Mail prawdziwy - nag≈Ç√≥wki potwierdzone" },
                ela: { s: 0, i: "Oryginalny mail phishingowy" },
                font: { s: 0, i: "Pr√≥ba imitacji banku" },
                time: { s: 0, i: "Wys≈Çany z serwera w Rosji" },
                ai: { s: 0, i: "2% - autentyczny mail phishingowy" },
              },
            },
          ],
        },
        {
          id: 9,
          name: "Alicja Pawlak",
          avatar: "üëß",
          fee: 60,
          days: 2,
          pen: 120,
          rew: 300,
          fine: 150,
          type: "GRO≈πBY",
          complaint: "Cyberprzemoc w szkole",
          clientLies: false,
          fullStory:
            'Moja c√≥rka Zuzia (13 lat) wraca ze szko≈Çy z p≈Çaczem. Na Snapchacie grupa "Zuzia to ofiara" gdzie kole≈ºanki z klasy piszƒÖ okropne rzeczy - ≈ºe jest brzydka, ≈ºe nikt jej nie lubi, ≈ºe powinna "zniknƒÖƒá". Wczoraj by≈Ço "jutro dostaniesz w twarz". Zuzia nie chce i≈õƒá do szko≈Çy. Dyrekcja m√≥wi ≈ºe "nie mogƒÖ nic zrobiƒá bo to poza szko≈ÇƒÖ". Mam screeny z jej telefonu.',
          keywords: [
            "zuzia",
            "c√≥rka",
            "szko≈Ça",
            "snapchat",
            "grupa",
            "kole≈ºank",
            "brzydka",
            "przemoc",
            "13 lat",
            "dyrekcj",
          ],
          suspect: "Kole≈ºanki z klasy",
          evidence: [
            {
              id: "e9",
              tp: "SNAPCHAT",
              fake: false,
              txt: 'Grupa "Zuzia to ofiara": "Jeste≈õ taka brzydka ü§Æ Nikt ciƒô nie lubi. Jutro dostaniesz w twarz loserko!!!"',
              ind: {
                meta: { s: 0, i: "Screenshot Snapchat - oryginalny" },
                ela: { s: 0, i: "Bez edycji" },
                font: { s: 0, i: "Czcionka Snapchat OK" },
                time: { s: 0, i: "Data sp√≥jna" },
                ai: { s: 0, i: "3% - wiadomo≈õci autentyczne" },
              },
            },
          ],
        },
        {
          id: 10,
          name: "Krzysztof Nowicki",
          avatar: "üë®‚Äçüíº",
          fee: 300,
          days: 5,
          pen: 600,
          rew: 800,
          fine: 400,
          type: "SZANTA≈ª",
          complaint: "Szanta≈º intymnymi zdjƒôciami",
          clientLies: false,
          fullStory:
            "Pozna≈Çem kogo≈õ na Tinderze, wymienili≈õmy kilka zdjƒôƒá... w tym intymne. Teraz ta osoba grozi ≈ºe wy≈õle je do mojej ≈ºony i do pracy je≈õli nie zap≈Çacƒô 10000 z≈Ç. Mam rodzinƒô, dobrƒÖ pracƒô w korporacji - to by mnie zniszczy≈Ço. Wiem ≈ºe to moja g≈Çupota ale proszƒô o pomoc. Osoba pisze z anonimowego maila przez Protonmail.",
          keywords: [
            "tinder",
            "zdjƒôci",
            "intymn",
            "≈ºona",
            "praca",
            "10000",
            "szanta≈º",
            "protonmail",
            "anonimow",
            "bitcoin",
            "btc",
          ],
          suspect: "Nieznany - szanta≈ºysta z Tindera",
          evidence: [
            {
              id: "e10",
              tp: "EMAIL",
              fake: false,
              txt: "Mam twoje zdjƒôcia. Wiem gdzie pracujesz - [nazwa firmy]. Mam FB twojej ≈ºony. 10000 z≈Ç na BTC albo wszyscy zobaczƒÖ.",
              ind: {
                meta: { s: 0, i: "Email przez Protonmail - anonimowy" },
                ela: { s: 0, i: "Oryginalny email" },
                font: { s: 0, i: "Standardowy format" },
                time: { s: 0, i: "Wys≈Çany przez sieƒá TOR" },
                ai: { s: 0, i: "4% - prawdziwy szanta≈º" },
              },
            },
          ],
        },
        {
          id: 11,
          name: "Damian Krawczyk",
          avatar: "üë®‚Äçü¶±",
          fee: 180,
          days: 3,
          pen: 350,
          rew: 500,
          fine: 400,
          type: "ZNIES≈ÅAWIENIE",
          complaint: "By≈Çy pracodawca mnie oczernia",
          clientLies: true,
          fullStory:
            "M√≥j by≈Çy szef Janusz z firmy BudMal pisze o mnie k≈Çamstwa na forach budowlanych! Twierdzi ≈ºe krad≈Çem materia≈Çy i oszukiwa≈Çem klient√≥w. To NIEPRAWDA! Przez niego nie mogƒô znale≈∫ƒá pracy w bran≈ºy. Mam screeny jego post√≥w. Chcƒô go pozwaƒá!",
          keywords: [
            "janusz",
            "budmal",
            "szef",
            "forum",
            "krad≈Ç",
            "materia≈Ç",
            "praca",
            "bran≈º",
            "post",
          ],
          suspect: "Janusz - by≈Çy szef",
          evidence: [
            {
              id: "e11",
              tp: "FORUM",
              fake: true,
              txt: "UWAGA na Damiana K.! Pracowa≈Ç u mnie i krad≈Ç materia≈Çy budowlane. Oszukiwa≈Ç te≈º klient√≥w na metra≈ºu. Nie zatrudniajcie!",
              ind: {
                meta: { s: 1, i: "Screenshot edytowany - Paint.NET" },
                ela: { s: 1, i: "Tekst wklejony cyfrowo" },
                font: { s: 1, i: "Font nie pasuje do forum" },
                time: {
                  s: 1,
                  i: "Post datowany na dzie≈Ñ wolny - forum zamkniƒôte",
                },
                ai: { s: 1, i: "92% - screenshot sfabrykowany przez KLIENTA" },
              },
            },
          ],
        },
        {
          id: 12,
          name: "Natalia Wo≈∫niak",
          avatar: "üë©‚Äçüé§",
          fee: 150,
          days: 3,
          pen: 300,
          rew: 450,
          fine: 350,
          type: "GRO≈πBY",
          complaint: "Stalker grozi mi ≈õmierciƒÖ",
          clientLies: true,
          fullStory:
            "Jestem influencerkƒÖ na Instagramie. Od miesiƒÖca dostajƒô wiadomo≈õci od stalkera kt√≥ry grozi ≈ºe mnie zabije! Pisze z anonimowego konta. Bojƒô siƒô wychodziƒá z domu. Mam screeny tych wiadomo≈õci. Proszƒô o pomoc!",
          keywords: [
            "instagram",
            "stalker",
            "grozi",
            "anonimow",
            "wiadomo",
            "influencer",
            "zabij",
            "konto",
            "dm",
          ],
          suspect: "Anonimowy stalker",
          evidence: [
            {
              id: "e12",
              tp: "INSTAGRAM DM",
              fake: true,
              txt: "Wiem gdzie mieszkasz s**o. Obserwujƒô ciƒô codziennie. Nied≈Çugo ciƒô dorwƒô i zabijƒô!!! üî™",
              ind: {
                meta: { s: 1, i: "Screenshot utworzony w Photoshop" },
                ela: { s: 1, i: "Interfejs IG niezgodny z wersjƒÖ" },
                font: { s: 1, i: "Czcionka nie pasuje do Instagram" },
                time: { s: 1, i: "Timestamp niemo≈ºliwy - format b≈Çƒôdny" },
                ai: { s: 1, i: "96% - KLIENTKA sama stworzy≈Ça te screeny" },
              },
            },
          ],
        },
        {
          id: 13,
          name: "Bartosz Maj",
          avatar: "üë®‚Äçüíª",
          fee: 200,
          days: 4,
          pen: 400,
          rew: 550,
          fine: 450,
          type: "HACKING",
          complaint: "Kto≈õ w≈Çama≈Ç siƒô na moje konto",
          clientLies: true,
          fullStory:
            "Kto≈õ w≈Çama≈Ç siƒô na moje konto bankowe i zrobi≈Ç przelew na 8000 z≈Ç! Bank nie chce oddaƒá pieniƒôdzy bo m√≥wiƒÖ ≈ºe logowanie by≈Ço z mojego IP. Ale ja nie robi≈Çem tego przelewu! Mam potwierdzenie z banku. To musia≈Ç byƒá haker!",
          keywords: [
            "bank",
            "8000",
            "przelew",
            "ip",
            "w≈Çaman",
            "haker",
            "konto",
            "logowani",
            "pieniƒÖd",
          ],
          suspect: "Nieznany haker",
          evidence: [
            {
              id: "e13",
              tp: "POTWIERDZENIE PRZELEWU",
              fake: false,
              txt: 'Przelew: 8000 z≈Ç | Odbiorca: Konto Bartosza M. (drugie konto) | Tytu≈Ç: "zwrot"',
              ind: {
                meta: { s: 0, i: "Dokument oryginalny z banku" },
                ela: { s: 0, i: "Brak edycji" },
                font: { s: 0, i: "Oficjalny format bankowy" },
                time: { s: 0, i: "Data i godzina sp√≥jne" },
                ai: {
                  s: 0,
                  i: "2% - KLIENT sam przela≈Ç na swoje drugie konto!",
                },
              },
            },
          ],
        },
      ];
      function speak(text, voice) {
        if (!("speechSynthesis" in window)) return;
        var u = new SpeechSynthesisUtterance(text);
        u.lang = "pl-PL";
        u.rate = 0.9;
        if (voice == "judge") {
          u.pitch = 0.8;
          u.rate = 0.85;
        } else if (voice == "defense") {
          u.pitch = 1.1;
          u.rate = 1.0;
        } else if (voice == "police") {
          u.pitch = 0.9;
          u.rate = 0.95;
        }
        speechSynthesis.speak(u);
      }
      function genImg(e) {
        var c = document.createElement("canvas");
        c.width = 400;
        c.height = 300;
        var x = c.getContext("2d");
        var appType = e.tp.split(" ")[0].split("#")[0].trim();
        // DOK≈ÅADNE STYLE PLATFORM - kolory, czcionki, gradienty 1:1
        var apps = {
          MESSENGER: {
            bg1: "#0084ff",
            bg2: "#00a6ff",
            headerH: 54,
            headerBg: "#fff",
            headerColor: "#000",
            msgBg: "#f0f0f0",
            msgColor: "#000",
            bubbleBg: "#0084ff",
            bubbleColor: "#fff",
            font: '"Segoe UI", Helvetica, Arial, sans-serif',
            icon: "üí¨",
            statusBar: "#fff",
            statusColor: "#000",
            inputBg: "#f0f0f0",
            inputColor: "#65676b",
            avatarBg: "#0084ff",
            sendIcon: "üëç",
            cameraIcon: "üì∑",
            micIcon: "üé§",
            extraIcons: true,
          },
          WHATSAPP: {
            bg1: "#075e54",
            bg2: "#128c7e",
            headerH: 56,
            headerBg: "#075e54",
            headerColor: "#fff",
            msgBg: "#e7ffdb",
            msgColor: "#000",
            bubbleBg: "#dcf8c6",
            bubbleColor: "#303030",
            font: '"Segoe UI", Helvetica, sans-serif',
            icon: "üì±",
            statusBar: "#075e54",
            statusColor: "#fff",
            inputBg: "#fff",
            inputColor: "#667781",
            avatarBg: "#25d366",
            sendIcon: "üé§",
            cameraIcon: "üì∑",
            extraIcons: false,
            wallpaper: "#e5ddd5",
          },
          SMS: {
            bg1: "#2c2c2e",
            bg2: "#1c1c1e",
            headerH: 44,
            headerBg: "#1c1c1e",
            headerColor: "#fff",
            msgBg: "#e5e5ea",
            msgColor: "#000",
            bubbleBg: "#007aff",
            bubbleColor: "#fff",
            font: '"SF Pro Text", -apple-system, sans-serif',
            icon: "üí¨",
            statusBar: "#000",
            statusColor: "#fff",
            inputBg: "#1c1c1e",
            inputColor: "#8e8e93",
            avatarBg: "#8e8e93",
            sendIcon: "‚¨ÜÔ∏è",
            extraIcons: false,
            isIOS: true,
          },
          TWITTER: {
            bg1: "#1da1f2",
            bg2: "#1a8cd8",
            headerH: 50,
            headerBg: "#15202b",
            headerColor: "#fff",
            msgBg: "#1e2732",
            msgColor: "#fff",
            bubbleBg: "#1d9bf0",
            bubbleColor: "#fff",
            font: 'Arial, "Helvetica Neue", sans-serif',
            icon: "ùïè",
            statusBar: "#15202b",
            statusColor: "#fff",
            inputBg: "#273340",
            inputColor: "#8899a6",
            avatarBg: "#1d9bf0",
            sendIcon: "üì§",
            extraIcons: false,
            isDark: true,
          },
          INSTAGRAM: {
            bg1: "#833ab4",
            bg2: "#fd1d1d",
            headerH: 50,
            headerBg: "#fff",
            headerColor: "#262626",
            msgBg: "#efefef",
            msgColor: "#262626",
            bubbleBg: "#3797f0",
            bubbleColor: "#fff",
            font: '"Segoe UI", Roboto, sans-serif',
            icon: "üì∑",
            statusBar: "#fff",
            statusColor: "#262626",
            inputBg: "#efefef",
            inputColor: "#8e8e8e",
            avatarBg:
              "linear-gradient(45deg,#f09433,#e6683c,#dc2743,#cc2366,#bc1888)",
            sendIcon: "‚ù§Ô∏è",
            heartIcon: "‚ù§Ô∏è",
            extraIcons: true,
            hasGradient: true,
          },
          EMAIL: {
            bg1: "#c5221f",
            bg2: "#ea4335",
            headerH: 56,
            headerBg: "#fff",
            headerColor: "#202124",
            msgBg: "#fff",
            msgColor: "#202124",
            bubbleBg: "#f1f3f4",
            bubbleColor: "#202124",
            font: "Arial, sans-serif",
            icon: "‚úâÔ∏è",
            statusBar: "#fff",
            statusColor: "#5f6368",
            inputBg: "#f1f3f4",
            inputColor: "#5f6368",
            avatarBg: "#ea4335",
            isEmail: true,
            gmailRed: "#ea4335",
          },
          FACEBOOK: {
            bg1: "#1877f2",
            bg2: "#166fe5",
            headerH: 52,
            headerBg: "#fff",
            headerColor: "#050505",
            msgBg: "#e4e6eb",
            msgColor: "#050505",
            bubbleBg: "#0084ff",
            bubbleColor: "#fff",
            font: '"Segoe UI", Helvetica, sans-serif',
            icon: "üë§",
            statusBar: "#fff",
            statusColor: "#050505",
            inputBg: "#f0f2f5",
            inputColor: "#65676b",
            avatarBg: "#1877f2",
            sendIcon: "üëç",
            extraIcons: true,
          },
          SNAPCHAT: {
            bg1: "#fffc00",
            bg2: "#ffeb3b",
            headerH: 48,
            headerBg: "#fffc00",
            headerColor: "#000",
            msgBg: "#fff",
            msgColor: "#000",
            bubbleBg: "#e1e1e1",
            bubbleColor: "#000",
            font: '"Avenir Next", "Segoe UI", sans-serif',
            icon: "üëª",
            statusBar: "#fffc00",
            statusColor: "#000",
            inputBg: "#f1f1f1",
            inputColor: "#a0a0a0",
            avatarBg: "#fffc00",
            sendIcon: "‚û§",
            extraIcons: false,
            isSnap: true,
          },
          FORUM: {
            bg1: "#2d3748",
            bg2: "#1a202c",
            headerH: 48,
            headerBg: "#2d3748",
            headerColor: "#e2e8f0",
            msgBg: "#1a202c",
            msgColor: "#e2e8f0",
            bubbleBg: "#4a5568",
            bubbleColor: "#e2e8f0",
            font: "Verdana, Geneva, sans-serif",
            icon: "üíª",
            statusBar: "#1a202c",
            statusColor: "#a0aec0",
            inputBg: "#2d3748",
            inputColor: "#a0aec0",
            avatarBg: "#4299e1",
            sendIcon: "üì§",
            isForum: true,
          },
          POTWIERDZENIE: {
            bg1: "#0052cc",
            bg2: "#003d99",
            headerH: 60,
            headerBg: "#fff",
            headerColor: "#172b4d",
            msgBg: "#fff",
            msgColor: "#172b4d",
            bubbleBg: "#deebff",
            bubbleColor: "#172b4d",
            font: "Arial, sans-serif",
            icon: "üè¶",
            statusBar: "#0052cc",
            statusColor: "#fff",
            isBank: true,
            bankGreen: "#00875a",
          },
        };
        var app = apps[appType] || apps["SMS"];
        // Status bar
        x.fillStyle = app.statusBar;
        x.fillRect(0, 0, 400, 24);
        x.fillStyle = app.statusColor;
        x.font = "bold 12px " + app.font;
        if (app.isIOS) {
          x.fillText("9:41", 185, 16);
        } else {
          x.fillText("üì∂", 15, 16);
          x.fillText("9:41", 180, 16);
          x.fillText("üîã", 355, 16);
        }
        // Header z gradientem lub solid
        var chatY = 24;
        if (app.hasGradient) {
          var hgrad = x.createLinearGradient(0, chatY, 400, chatY);
          hgrad.addColorStop(0, "#833ab4");
          hgrad.addColorStop(0.5, "#fd1d1d");
          hgrad.addColorStop(1, "#fcb045");
          x.fillStyle = hgrad;
          x.fillRect(0, chatY, 400, app.headerH);
        } else {
          x.fillStyle = app.headerBg;
          x.fillRect(0, chatY, 400, app.headerH);
        }
        // Header content
        x.fillStyle = app.headerColor;
        x.font = "bold 15px " + app.font;
        var headerTxt = app.icon + " " + appType;
        if (app.isEmail)
          headerTxt = "Gmail - " + e.tp.replace("EMAIL", "").trim();
        if (app.isBank) headerTxt = "üè¶ Bank - Potwierdzenie";
        x.fillText(headerTxt, 50, chatY + app.headerH / 2 + 5);
        // Avatar circle
        x.beginPath();
        x.arc(28, chatY + app.headerH / 2, 16, 0, Math.PI * 2);
        x.fillStyle = app.avatarBg;
        x.fill();
        x.fillStyle = "#fff";
        x.font = "14px Arial";
        x.fillText("üë§", 21, chatY + app.headerH / 2 + 5);
        // Online status
        x.fillStyle =
          app.headerColor == "#fff"
            ? "rgba(255,255,255,0.7)"
            : "rgba(0,0,0,0.5)";
        x.font = "11px " + app.font;
        if (!app.isEmail && !app.isBank)
          x.fillText("online", 50, chatY + app.headerH / 2 + 18);
        // Back arrow
        x.fillStyle = app.headerColor;
        x.font = "18px Arial";
        x.fillText("‚Üê", 370, chatY + app.headerH / 2 + 5);
        // Chat area
        chatY += app.headerH;
        x.fillStyle = app.wallpaper || "#0a0a12";
        x.fillRect(0, chatY, 400, 300 - chatY - 55);
        // WhatsApp wallpaper pattern
        if (app.wallpaper) {
          x.globalAlpha = 0.03;
          for (var i = 0; i < 20; i++) {
            x.fillStyle = "#000";
            x.fillText("üí¨", Math.random() * 400, chatY + Math.random() * 150);
          }
          x.globalAlpha = 1;
        }
        // Message bubble
        var bubbleY = chatY + 15;
        x.shadowColor = "rgba(0,0,0,0.15)";
        x.shadowBlur = 10;
        x.shadowOffsetY = 2;
        x.fillStyle = app.bubbleBg;
        x.beginPath();
        x.roundRect(15, bubbleY, 330, 110, 16);
        x.fill();
        x.shadowBlur = 0;
        // Message text - PRAWID≈ÅOWA CZCIONKA
        x.fillStyle = app.bubbleColor;
        x.font = "14px " + app.font;
        var words = e.txt.split(" "),
          line = "",
          y = bubbleY + 25;
        for (var i = 0; i < words.length; i++) {
          if ((line + words[i]).length > 40) {
            x.fillText(line.trim(), 28, y);
            y += 20;
            line = "";
          }
          line += words[i] + " ";
        }
        x.fillText(line.trim(), 28, y);
        // Timestamp
        x.fillStyle =
          app.bubbleColor == "#fff"
            ? "rgba(255,255,255,0.6)"
            : "rgba(0,0,0,0.5)";
        x.font = "10px " + app.font;
        var h = ["08", "09", "10", "11", "14", "15", "16", "19", "20", "21"];
        var m = ["00", "12", "23", "34", "45", "52"];
        x.fillText(
          h[Math.floor(Math.random() * h.length)] +
            ":" +
            m[Math.floor(Math.random() * m.length)],
          295,
          bubbleY + 98
        );
        if (appType == "WHATSAPP") x.fillText("‚úì‚úì", 320, bubbleY + 98);
        // Evidence indicator
        x.fillStyle = e.fake ? "#ff3b30" : "#34c759";
        x.font = "bold 11px Arial";
        x.fillText(
          e.fake ? "‚ö†Ô∏è PODEJRZANY DOW√ìD" : "üìé DOW√ìD #" + e.id.replace("e", ""),
          15,
          chatY + 145
        );
        // Input bar
        var inputY = 245;
        x.fillStyle = app.inputBg;
        x.fillRect(0, inputY, 400, 55);
        x.fillStyle = "#3a3a4a";
        x.beginPath();
        x.roundRect(15, inputY + 12, app.extraIcons ? 290 : 340, 32, 16);
        x.fill();
        x.fillStyle = app.inputColor;
        x.font = "13px " + app.font;
        x.fillText("Aa  Napisz wiadomo≈õƒá...", 30, inputY + 33);
        if (app.extraIcons) {
          x.font = "18px Arial";
          x.fillText("üì∑", 320, inputY + 33);
          x.fillText(app.sendIcon || "üì§", 360, inputY + 33);
        }
        // Noise
        var imgD = x.getImageData(0, 0, 400, 300);
        for (var i = 0; i < imgD.data.length; i += 4) {
          var n = (Math.random() - 0.5) * 6;
          imgD.data[i] += n;
          imgD.data[i + 1] += n;
          imgD.data[i + 2] += n;
        }
        x.putImageData(imgD, 0, 0);
        return c.toDataURL();
      }

      function genCompareImg(appType) {
        var c = document.createElement("canvas");
        c.width = 400;
        c.height = 300;
        var x = c.getContext("2d");
        // TE SAME STYLE CO W genImg - dla por√≥wnania
        var apps = {
          MESSENGER: {
            bg1: "#0084ff",
            bg2: "#00a6ff",
            headerH: 54,
            headerBg: "#fff",
            headerColor: "#000",
            bubbleBg: "#0084ff",
            bubbleColor: "#fff",
            font: '"Segoe UI", Helvetica, Arial, sans-serif',
            icon: "üí¨",
            statusBar: "#fff",
            statusColor: "#000",
          },
          WHATSAPP: {
            bg1: "#075e54",
            bg2: "#128c7e",
            headerH: 56,
            headerBg: "#075e54",
            headerColor: "#fff",
            bubbleBg: "#dcf8c6",
            bubbleColor: "#303030",
            font: '"Segoe UI", Helvetica, sans-serif',
            icon: "üì±",
            statusBar: "#075e54",
            statusColor: "#fff",
            wallpaper: "#e5ddd5",
          },
          SMS: {
            bg1: "#2c2c2e",
            bg2: "#1c1c1e",
            headerH: 44,
            headerBg: "#1c1c1e",
            headerColor: "#fff",
            bubbleBg: "#007aff",
            bubbleColor: "#fff",
            font: '"SF Pro Text", -apple-system, sans-serif',
            icon: "üí¨",
            statusBar: "#000",
            statusColor: "#fff",
          },
          TWITTER: {
            bg1: "#1da1f2",
            bg2: "#1a8cd8",
            headerH: 50,
            headerBg: "#15202b",
            headerColor: "#fff",
            bubbleBg: "#1d9bf0",
            bubbleColor: "#fff",
            font: 'Arial, "Helvetica Neue", sans-serif',
            icon: "ùïè",
            statusBar: "#15202b",
            statusColor: "#fff",
          },
          INSTAGRAM: {
            bg1: "#833ab4",
            bg2: "#fd1d1d",
            headerH: 50,
            headerBg: "#fff",
            headerColor: "#262626",
            bubbleBg: "#3797f0",
            bubbleColor: "#fff",
            font: '"Segoe UI", Roboto, sans-serif',
            icon: "üì∑",
            statusBar: "#fff",
            statusColor: "#262626",
            hasGradient: true,
          },
          EMAIL: {
            bg1: "#c5221f",
            bg2: "#ea4335",
            headerH: 56,
            headerBg: "#fff",
            headerColor: "#202124",
            bubbleBg: "#f1f3f4",
            bubbleColor: "#202124",
            font: "Arial, sans-serif",
            icon: "‚úâÔ∏è",
            statusBar: "#fff",
            statusColor: "#5f6368",
          },
          FACEBOOK: {
            bg1: "#1877f2",
            bg2: "#166fe5",
            headerH: 52,
            headerBg: "#fff",
            headerColor: "#050505",
            bubbleBg: "#0084ff",
            bubbleColor: "#fff",
            font: '"Segoe UI", Helvetica, sans-serif',
            icon: "üë§",
            statusBar: "#fff",
            statusColor: "#050505",
          },
          SNAPCHAT: {
            bg1: "#fffc00",
            bg2: "#ffeb3b",
            headerH: 48,
            headerBg: "#fffc00",
            headerColor: "#000",
            bubbleBg: "#e1e1e1",
            bubbleColor: "#000",
            font: '"Avenir Next", "Segoe UI", sans-serif',
            icon: "üëª",
            statusBar: "#fffc00",
            statusColor: "#000",
          },
          FORUM: {
            bg1: "#2d3748",
            bg2: "#1a202c",
            headerH: 48,
            headerBg: "#2d3748",
            headerColor: "#e2e8f0",
            bubbleBg: "#4a5568",
            bubbleColor: "#e2e8f0",
            font: "Verdana, Geneva, sans-serif",
            icon: "üíª",
            statusBar: "#1a202c",
            statusColor: "#a0aec0",
          },
          POTWIERDZENIE: {
            bg1: "#0052cc",
            bg2: "#003d99",
            headerH: 60,
            headerBg: "#fff",
            headerColor: "#172b4d",
            bubbleBg: "#deebff",
            bubbleColor: "#172b4d",
            font: "Arial, sans-serif",
            icon: "üè¶",
            statusBar: "#0052cc",
            statusColor: "#fff",
          },
        };
        var app = apps[appType] || apps["SMS"];
        // Status bar
        x.fillStyle = app.statusBar;
        x.fillRect(0, 0, 400, 24);
        x.fillStyle = app.statusColor;
        x.font = "bold 12px Arial";
        x.fillText("üì∂", 15, 16);
        x.fillText("9:41", 180, 16);
        x.fillText("üîã", 355, 16);
        // Header
        var chatY = 24;
        if (app.hasGradient) {
          var hgrad = x.createLinearGradient(0, chatY, 400, chatY);
          hgrad.addColorStop(0, "#833ab4");
          hgrad.addColorStop(0.5, "#fd1d1d");
          hgrad.addColorStop(1, "#fcb045");
          x.fillStyle = hgrad;
        } else {
          x.fillStyle = app.headerBg;
        }
        x.fillRect(0, chatY, 400, app.headerH);
        x.fillStyle = app.headerColor;
        x.font = "bold 15px " + app.font;
        x.fillText(
          app.icon + " " + appType + " - WZORZEC",
          15,
          chatY + app.headerH / 2 + 5
        );
        // Chat area
        chatY += app.headerH;
        x.fillStyle = app.wallpaper || "#0a0a12";
        x.fillRect(0, chatY, 400, 300 - chatY);
        // Example bubble - DOK≈ÅADNIE TE SAME KOLORY
        x.shadowColor = "rgba(0,0,0,0.15)";
        x.shadowBlur = 8;
        x.fillStyle = app.bubbleBg;
        x.beginPath();
        x.roundRect(15, chatY + 20, 300, 70, 16);
        x.fill();
        x.shadowBlur = 0;
        x.fillStyle = app.bubbleColor;
        x.font = "14px " + app.font;
        x.fillText("To jest PRAWDZIWA wiadomo≈õƒá", 28, chatY + 50);
        x.fillText("z aplikacji " + appType, 28, chatY + 70);
        // Info panel
        x.fillStyle = "rgba(0,255,255,0.08)";
        x.fillRect(15, chatY + 110, 370, 100);
        x.strokeStyle = "#0ff";
        x.lineWidth = 2;
        x.strokeRect(15, chatY + 110, 370, 100);
        x.fillStyle = "#0ff";
        x.font = "bold 13px Arial";
        x.fillText("üîç POR√ìWNAJ Z DOWODEM:", 25, chatY + 135);
        x.fillStyle = "#fff";
        x.font = "12px Arial";
        x.fillText(
          "‚úì Czcionka: " + app.font.split(",")[0].replace(/"/g, ""),
          25,
          chatY + 158
        );
        x.fillText("‚úì Kolor bƒÖbelka: " + app.bubbleBg, 25, chatY + 178);
        x.fillText("‚úì Kolor nag≈Ç√≥wka: " + app.headerBg, 25, chatY + 198);
        return c.toDataURL();
      }
      function saveGame() {
        try {
          localStorage.setItem(
            "cyberdetective",
            JSON.stringify({
              credits: G.credits,
              day: G.day,
              tools: G.tools,
              completed: G.completed,
              inbox: G.inbox,
              suspendedUntil: G.suspendedUntil,
              activeCases: G.activeCases,
              selectedCase: G.selectedCase,
              results: G.results,
            })
          );
        } catch (e) {
          console.log("Save error", e);
        }
      }
      function loadGame() {
        try {
          var s = localStorage.getItem("cyberdetective");
          if (s) {
            var d = JSON.parse(s);
            G.credits = d.credits !== undefined ? d.credits : 500;
            G.day = d.day || 1;
            G.tools = d.tools || {
              zoom: true,
              meta: false,
              ela: false,
              font: false,
              time: false,
              ai: false,
            };
            G.completed = d.completed || [];
            G.inbox = d.inbox || [];
            G.suspendedUntil = d.suspendedUntil || 0;
            G.activeCases = d.activeCases || [];
            G.selectedCase =
              d.selectedCase !== undefined ? d.selectedCase : null;
            G.results = d.results || {};
            for (var i = 0; i < G.activeCases.length; i++) {
              for (var j = 0; j < G.activeCases[i].evidence.length; j++) {
                G.activeCases[i].evidence[j].img = genImg(
                  G.activeCases[i].evidence[j]
                );
              }
            }
            return true;
          }
        } catch (e) {
          console.log("Load error", e);
        }
        return false;
      }
      function checkSuspension() {
        if (G.suspendedUntil > Date.now()) {
          document.getElementById("loader").style.display = "none";
          document.getElementById("suspended").style.display = "flex";
          updateSuspendTimer();
          return true;
        }
        return false;
      }
      function updateSuspendTimer() {
        var left = G.suspendedUntil - Date.now();
        if (left <= 0) {
          G.suspendedUntil = 0;
          saveGame();
          location.reload();
          return;
        }
        var h = Math.floor(left / 3600000);
        var m = Math.floor((left % 3600000) / 60000);
        var s = Math.floor((left % 60000) / 1000);
        document.getElementById("suspend-time").textContent =
          (h < 10 ? "0" : "") +
          h +
          ":" +
          (m < 10 ? "0" : "") +
          m +
          ":" +
          (s < 10 ? "0" : "") +
          s;
        setTimeout(updateSuspendTimer, 1000);
      }
      function suspendPlayer(hours) {
        G.suspendedUntil = Date.now() + hours * 3600000;
        saveGame();
        document.getElementById("scene-overlay").style.display = "none";
        document.getElementById("suspended").style.display = "flex";
        updateSuspendTimer();
      }
      loadGame();
      var loadSteps = [
        "Inicjalizacja...",
        "≈Åadowanie interfejsu...",
        "Wczytywanie spraw...",
        "Konfiguracja narzƒôdzi...",
        "Weryfikacja...",
        "System gotowy!",
      ];
      function runLoader() {
        if (checkSuspension()) return;
        var bar = document.getElementById("loader-bar"),
          pct = document.getElementById("loader-percent"),
          txt = document.getElementById("loader-text"),
          prog = 0;
        var iv = setInterval(function () {
          prog += Math.random() * 20 + 5;
          if (prog > 100) prog = 100;
          bar.style.width = prog + "%";
          pct.textContent = Math.floor(prog) + "%";
          txt.textContent = loadSteps[Math.min(Math.floor(prog / 20), 5)];
          if (prog >= 100) {
            clearInterval(iv);
            setTimeout(function () {
              document.getElementById("loader").style.display = "none";
              document.getElementById("intro").style.display = "flex";
            }, 400);
          }
        }, 200);
      }
      window.onload = runLoader;
      var scene,
        camera,
        renderer,
        objs = [],
        rotY = 0,
        rotX = 0,
        lookAt = null;
      function init3D() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x050510);
        scene.fog = new THREE.Fog(0x050510, 3, 15);
        camera = new THREE.PerspectiveCamera(
          70,
          innerWidth / innerHeight,
          0.1,
          100
        );
        camera.position.set(0, 1.6, 0);
        renderer = new THREE.WebGLRenderer({
          canvas: document.getElementById("canvas"),
          antialias: true,
        });
        renderer.setSize(innerWidth, innerHeight);
        renderer.shadowMap.enabled = true;
        // O≈õwietlenie
        scene.add(new THREE.AmbientLight(0x1a2a4a, 0.3));
        var mainLight = new THREE.PointLight(0x4080ff, 1, 20);
        mainLight.position.set(0, 3, 0);
        mainLight.castShadow = true;
        scene.add(mainLight);
        var neonLight1 = new THREE.PointLight(0x00ffff, 0.5, 8);
        neonLight1.position.set(-3, 2.5, 0);
        scene.add(neonLight1);
        var neonLight2 = new THREE.PointLight(0xff00ff, 0.3, 8);
        neonLight2.position.set(3, 2.5, -2);
        scene.add(neonLight2);
        var spotLight = new THREE.SpotLight(
          0xffffff,
          0.8,
          15,
          Math.PI / 6,
          0.5
        );
        spotLight.position.set(0, 4, -3);
        spotLight.target.position.set(0, 1, -3);
        scene.add(spotLight);
        scene.add(spotLight.target);
        // Pod≈Çoga - parkiet
        var floorMat = new THREE.MeshStandardMaterial({
          color: 0x2a1810,
          roughness: 0.7,
          metalness: 0.1,
        });
        var fl = new THREE.Mesh(new THREE.PlaneGeometry(12, 12), floorMat);
        fl.rotation.x = -Math.PI / 2;
        fl.receiveShadow = true;
        scene.add(fl);
        // Linie na pod≈Çodze (parkiet)
        for (var i = -5; i < 6; i++) {
          var line = new THREE.Mesh(
            new THREE.PlaneGeometry(0.02, 12),
            new THREE.MeshBasicMaterial({ color: 0x1a0a05 })
          );
          line.rotation.x = -Math.PI / 2;
          line.position.set(i, 0.001, 0);
          scene.add(line);
        }
        // ≈öciany
        var wallMat = new THREE.MeshStandardMaterial({
          color: 0x0a0a1a,
          roughness: 0.9,
        });
        var backWall = new THREE.Mesh(new THREE.PlaneGeometry(12, 5), wallMat);
        backWall.position.set(0, 2.5, -5);
        scene.add(backWall);
        var leftWall = new THREE.Mesh(new THREE.PlaneGeometry(12, 5), wallMat);
        leftWall.position.set(-6, 2.5, 0);
        leftWall.rotation.y = Math.PI / 2;
        scene.add(leftWall);
        var rightWall = new THREE.Mesh(new THREE.PlaneGeometry(12, 5), wallMat);
        rightWall.position.set(6, 2.5, 0);
        rightWall.rotation.y = -Math.PI / 2;
        scene.add(rightWall);
        // Sufit
        var ceiling = new THREE.Mesh(
          new THREE.PlaneGeometry(12, 12),
          new THREE.MeshStandardMaterial({ color: 0x0a0a15 })
        );
        ceiling.position.set(0, 4.5, 0);
        ceiling.rotation.x = Math.PI / 2;
        scene.add(ceiling);
        // DRZWI - szczeg√≥≈Çowe
        var doorFrame = new THREE.Mesh(
          new THREE.BoxGeometry(2.4, 3.2, 0.3),
          new THREE.MeshStandardMaterial({ color: 0x2a1505, roughness: 0.5 })
        );
        doorFrame.position.set(0, 1.6, 5.85);
        scene.add(doorFrame);
        var dr = new THREE.Mesh(
          new THREE.BoxGeometry(2, 2.9, 0.15),
          new THREE.MeshStandardMaterial({ color: 0x4a3020, roughness: 0.4 })
        );
        dr.position.set(0, 1.45, 5.7);
        dr.castShadow = true;
        dr.userData = { type: "door" };
        objs.push(dr);
        scene.add(dr);
        // Klamka
        var handle = new THREE.Mesh(
          new THREE.CylinderGeometry(0.05, 0.05, 0.3),
          new THREE.MeshStandardMaterial({
            color: 0xccaa00,
            metalness: 0.9,
            roughness: 0.2,
          })
        );
        handle.position.set(0.7, 1.2, 5.6);
        handle.rotation.z = Math.PI / 2;
        scene.add(handle);
        // Tabliczka na drzwiach
        var sign = new THREE.Mesh(
          new THREE.PlaneGeometry(0.8, 0.3),
          new THREE.MeshBasicMaterial({ color: 0x003355 })
        );
        sign.position.set(0, 2.3, 5.65);
        scene.add(sign);
        // Szyba w drzwiach
        // Neon CYBER DETECTIVE
        var neonBack = new THREE.Mesh(
          new THREE.PlaneGeometry(3.5, 0.8),
          new THREE.MeshBasicMaterial({ color: 0x001020 })
        );
        neonBack.position.set(0, 3.5, -4.95);
        scene.add(neonBack);
        var neonGlow = new THREE.PointLight(0x00ffff, 1, 4);
        neonGlow.position.set(0, 3.5, -4.5);
        scene.add(neonGlow);
        // KOMPUTER - szczeg√≥≈Çowy
        var deskMat = new THREE.MeshStandardMaterial({
          color: 0x1a1a2a,
          roughness: 0.5,
          metalness: 0.2,
        });
        var desk = new THREE.Mesh(
          new THREE.BoxGeometry(2.5, 0.1, 1.2),
          deskMat
        );
        desk.position.set(0, 0.9, -3.5);
        desk.castShadow = true;
        scene.add(desk);
        // Nogi biurka
        for (var i = 0; i < 4; i++) {
          var leg = new THREE.Mesh(
            new THREE.BoxGeometry(0.1, 0.9, 0.1),
            new THREE.MeshStandardMaterial({ color: 0x333344, metalness: 0.5 })
          );
          leg.position.set(
            -1 + Math.floor(i / 2) * 2,
            0.45,
            -3.1 - (i % 2) * 0.8
          );
          scene.add(leg);
        }
        // Monitor g≈Ç√≥wny
        var monitorStand = new THREE.Mesh(
          new THREE.CylinderGeometry(0.15, 0.2, 0.3),
          new THREE.MeshStandardMaterial({ color: 0x222233, metalness: 0.7 })
        );
        monitorStand.position.set(0, 1.1, -3.8);
        scene.add(monitorStand);
        var monitorArm = new THREE.Mesh(
          new THREE.BoxGeometry(0.08, 0.4, 0.08),
          new THREE.MeshStandardMaterial({ color: 0x333344, metalness: 0.8 })
        );
        monitorArm.position.set(0, 1.35, -3.8);
        scene.add(monitorArm);
        var mn = new THREE.Mesh(
          new THREE.BoxGeometry(1.6, 1, 0.08),
          new THREE.MeshStandardMaterial({ color: 0x111122, roughness: 0.3 })
        );
        mn.position.set(0, 1.75, -3.9);
        mn.castShadow = true;
        mn.userData = { type: "pc" };
        objs.push(mn);
        scene.add(mn);
        // Ekran monitora (≈õwiecƒÖcy)
        var screenMat = new THREE.MeshBasicMaterial({ color: 0x003355 });
        var screen = new THREE.Mesh(
          new THREE.PlaneGeometry(1.5, 0.9),
          screenMat
        );
        screen.position.set(0, 1.75, -3.85);
        scene.add(screen);
        // Monitor boczny
        var mn2 = new THREE.Mesh(
          new THREE.BoxGeometry(1, 0.7, 0.06),
          new THREE.MeshStandardMaterial({ color: 0x111122 })
        );
        mn2.position.set(-1.5, 1.55, -3.7);
        mn2.rotation.y = 0.3;
        scene.add(mn2);
        var screen2 = new THREE.Mesh(
          new THREE.PlaneGeometry(0.9, 0.6),
          new THREE.MeshBasicMaterial({ color: 0x002244 })
        );
        screen2.position.set(-1.5, 1.55, -3.65);
        screen2.rotation.y = 0.3;
        scene.add(screen2);
        // Klawiatura
        var keyboard = new THREE.Mesh(
          new THREE.BoxGeometry(0.6, 0.03, 0.2),
          new THREE.MeshStandardMaterial({ color: 0x222233 })
        );
        keyboard.position.set(0, 0.96, -3.2);
        scene.add(keyboard);
        // Mysz
        var mouse = new THREE.Mesh(
          new THREE.BoxGeometry(0.1, 0.03, 0.15),
          new THREE.MeshStandardMaterial({ color: 0x333344 })
        );
        mouse.position.set(0.5, 0.96, -3.2);
        scene.add(mouse);
        // Podk≈Çadka pod mysz (≈õwiecƒÖca RGB)
        var mousepad = new THREE.Mesh(
          new THREE.PlaneGeometry(0.4, 0.35),
          new THREE.MeshBasicMaterial({ color: 0x00ffff })
        );
        mousepad.position.set(0.5, 0.95, -3.2);
        mousepad.rotation.x = -Math.PI / 2;
        scene.add(mousepad);
        // Kubek z kawƒÖ
        var mug = new THREE.Mesh(
          new THREE.CylinderGeometry(0.05, 0.04, 0.1),
          new THREE.MeshStandardMaterial({ color: 0x4444aa })
        );
        mug.position.set(1, 0.98, -3.3);
        scene.add(mug);
        // KsiƒÖ≈ºki/akta na biurku
        var books = new THREE.Mesh(
          new THREE.BoxGeometry(0.3, 0.15, 0.2),
          new THREE.MeshStandardMaterial({ color: 0x8b4513 })
        );
        books.position.set(-0.8, 1.02, -3.3);
        scene.add(books);
        // Lampka LED na biurku
        var lampBase = new THREE.Mesh(
          new THREE.CylinderGeometry(0.08, 0.1, 0.05),
          new THREE.MeshStandardMaterial({ color: 0x333344 })
        );
        lampBase.position.set(1.1, 0.95, -3.6);
        scene.add(lampBase);
        var lampArm = new THREE.Mesh(
          new THREE.CylinderGeometry(0.02, 0.02, 0.5),
          new THREE.MeshStandardMaterial({ color: 0x444455 })
        );
        lampArm.position.set(1.1, 1.2, -3.6);
        scene.add(lampArm);
        var lampHead = new THREE.Mesh(
          new THREE.SphereGeometry(0.08),
          new THREE.MeshBasicMaterial({ color: 0x00ff88 })
        );
        lampHead.position.set(1.1, 1.5, -3.6);
        scene.add(lampHead);
        var deskLight = new THREE.PointLight(0x00ff88, 0.5, 2);
        deskLight.position.set(1.1, 1.4, -3.6);
        scene.add(deskLight);
        // REGA≈Å Z KSIƒÑ≈ªKAMI
        var shelfMat = new THREE.MeshStandardMaterial({
          color: 0x2a1a0a,
          roughness: 0.6,
        });
        var shelf = new THREE.Mesh(new THREE.BoxGeometry(2, 3, 0.4), shelfMat);
        shelf.position.set(-4, 1.5, -4);
        scene.add(shelf);
        // P√≥≈Çki
        for (var i = 0; i < 4; i++) {
          var shelfBoard = new THREE.Mesh(
            new THREE.BoxGeometry(1.8, 0.05, 0.35),
            new THREE.MeshStandardMaterial({ color: 0x3a2a1a })
          );
          shelfBoard.position.set(-4, 0.5 + i * 0.8, -4);
          scene.add(shelfBoard);
        }
        // KsiƒÖ≈ºki na p√≥≈Çkach
        var bookColors = [
          0x8b0000, 0x006400, 0x00008b, 0x8b008b, 0x8b4513, 0xffd700, 0x4169e1,
        ];
        for (var i = 0; i < 20; i++) {
          var bookH = 0.2 + Math.random() * 0.15;
          var book = new THREE.Mesh(
            new THREE.BoxGeometry(0.08, bookH, 0.25),
            new THREE.MeshStandardMaterial({
              color: bookColors[Math.floor(Math.random() * bookColors.length)],
            })
          );
          book.position.set(
            -4.7 + i * 0.09,
            0.5 + Math.floor(i / 7) * 0.8 + bookH / 2,
            -4
          );
          scene.add(book);
        }
        // SKLEP - Witryna
        // Ro≈õlina w doniczce
        var pot = new THREE.Mesh(
          new THREE.CylinderGeometry(0.15, 0.1, 0.25),
          new THREE.MeshStandardMaterial({ color: 0x8b4513 })
        );
        pot.position.set(3, 0.12, 2);
        scene.add(pot);
        var plant = new THREE.Mesh(
          new THREE.ConeGeometry(0.25, 0.6, 8),
          new THREE.MeshStandardMaterial({ color: 0x228b22 })
        );
        plant.position.set(3, 0.55, 2);
        scene.add(plant);
        // Fotel gracza przy biurku
        var chairBase = new THREE.Mesh(
          new THREE.CylinderGeometry(0.3, 0.35, 0.1),
          new THREE.MeshStandardMaterial({ color: 0x111111, metalness: 0.8 })
        );
        chairBase.position.set(0, 0.15, -2);
        scene.add(chairBase);
        var chairPole = new THREE.Mesh(
          new THREE.CylinderGeometry(0.05, 0.05, 0.5),
          new THREE.MeshStandardMaterial({ color: 0x333333, metalness: 0.9 })
        );
        chairPole.position.set(0, 0.4, -2);
        scene.add(chairPole);
        var chairSeat = new THREE.Mesh(
          new THREE.BoxGeometry(0.6, 0.1, 0.6),
          new THREE.MeshStandardMaterial({ color: 0x1a1a2a })
        );
        chairSeat.position.set(0, 0.7, -2);
        scene.add(chairSeat);
        var chairBack = new THREE.Mesh(
          new THREE.BoxGeometry(0.6, 0.8, 0.1),
          new THREE.MeshStandardMaterial({ color: 0x1a1a2a })
        );
        chairBack.position.set(0, 1.1, -2.3);
        scene.add(chairBack);
        // Ramka z certyfikatem na ≈õcianie
        var frame = new THREE.Mesh(
          new THREE.BoxGeometry(0.8, 0.6, 0.05),
          new THREE.MeshStandardMaterial({ color: 0x8b4513 })
        );
        frame.position.set(3, 2.5, -4.95);
        scene.add(frame);
        var cert = new THREE.Mesh(
          new THREE.PlaneGeometry(0.7, 0.5),
          new THREE.MeshBasicMaterial({ color: 0xfffff0 })
        );
        cert.position.set(3, 2.5, -4.92);
        scene.add(cert);
        // Zegar cyfrowy
        var clock = new THREE.Mesh(
          new THREE.BoxGeometry(0.5, 0.2, 0.05),
          new THREE.MeshBasicMaterial({ color: 0x001100 })
        );
        clock.position.set(-3, 3, -4.95);
        scene.add(clock);
        var clockGlow = new THREE.PointLight(0x00ff00, 0.2, 1);
        clockGlow.position.set(-3, 3, -4.8);
        scene.add(clockGlow);
        animate();
      }
      function animate() {
        requestAnimationFrame(animate);
        camera.rotation.order = "YXZ";
        camera.rotation.y = rotY;
        camera.rotation.x = rotX;
        var ray = new THREE.Raycaster();
        ray.setFromCamera({ x: 0, y: 0 }, camera);
        var hits = ray.intersectObjects(objs);
        var pr = document.getElementById("prompt"),
          tb = document.getElementById("touch-btn");
        if (hits.length && hits[0].distance < 6) {
          lookAt = hits[0].object;
          var t = lookAt.userData.type == "pc" ? "KOMPUTER" : "DRZWI";
          pr.textContent = "üëÜ " + t;
          pr.style.opacity = "1";
          if (!G.inPC) {
            tb.style.display = "block";
            tb.textContent = "üëÜ " + t;
          }
        } else {
          lookAt = null;
          pr.style.opacity = "0";
          tb.style.display = "none";
        }
        renderer.render(scene, camera);
      }
      var md = false;
      document.onmousedown = function (e) {
        md = true;
        if (e.button == 0 && lookAt && !G.inPC) interact(lookAt);
      };
      document.onmouseup = function () {
        md = false;
      };
      document.onmousemove = function (e) {
        if (md && !G.inPC) {
          rotY -= e.movementX * 0.003;
          rotX = Math.max(-1, Math.min(1, rotX - e.movementY * 0.003));
        }
      };
      var tx = 0,
        ty = 0,
        tt = false,
        tm = false;
      document.ontouchstart = function (e) {
        if (
          G.inPC ||
          e.target.closest(
            "#computer,#visitor,#analysis,#result,#intro,#scene-overlay"
          )
        )
          return;
        tt = true;
        tm = false;
        tx = e.touches[0].clientX;
        ty = e.touches[0].clientY;
      };
      document.ontouchmove = function (e) {
        if (!tt || G.inPC) return;
        var dx = e.touches[0].clientX - tx,
          dy = e.touches[0].clientY - ty;
        if (Math.abs(dx) > 5 || Math.abs(dy) > 5) tm = true;
        rotY -= dx * 0.006;
        rotX = Math.max(-1, Math.min(1, rotX - dy * 0.006));
        tx = e.touches[0].clientX;
        ty = e.touches[0].clientY;
      };
      document.ontouchend = function () {
        if (!tt) return;
        tt = false;
        if (!tm && lookAt && !G.inPC) interact(lookAt);
      };
      function interact(o) {
        if (o.userData.type == "pc") enterPC();
        else spawnVisitor();
      }
      function enterPC() {
        G.inPC = true;
        document.getElementById("computer").style.display = "flex";
        document.getElementById("crosshair").style.display = "none";
        document.getElementById("prompt").style.opacity = "0";
        document.getElementById("touch-btn").style.display = "none";
        initNav();
        renderPanel("case");
      }
      function exitPC() {
        G.inPC = false;
        document.getElementById("computer").style.display = "none";
        document.getElementById("crosshair").style.display = "block";
      }
      document.getElementById("exit-btn").onclick = exitPC;
      function initNav() {
        var items = document.querySelectorAll(".nav-item");
        for (var i = 0; i < items.length; i++) {
          items[i].onclick = items[i].ontouchend = function (e) {
            e.preventDefault();
            for (var j = 0; j < items.length; j++)
              items[j].classList.remove("active");
            this.classList.add("active");
            renderPanel(this.dataset.panel);
          };
        }
      }
      function updateHUD() {
        document.getElementById("hud-credits").textContent = G.credits;
        document.getElementById("hud-cases").textContent = G.activeCases.length;
        document.getElementById("hud-day").textContent = G.day;
        var tax = getTotalTax();
        var taxEl = document.getElementById("hud-tax");
        if (taxEl) taxEl.textContent = tax + "%";
      }
      function notify(t, m) {
        document.getElementById("notif-title").textContent = t;
        document.getElementById("notif-msg").textContent = m;
        document.getElementById("notif").style.display = "block";
        setTimeout(function () {
          document.getElementById("notif").style.display = "none";
        }, 2500);
      }
      function renderPanel(p) {
        var c = document.getElementById("content");
        if (p == "case") c.innerHTML = renderCase();
        else if (p == "send") c.innerHTML = renderSend();
        else if (p == "inbox") c.innerHTML = renderInbox();
        else if (p == "shop") c.innerHTML = renderShop();
        else if (p == "archive") c.innerHTML = renderArchive();
        bindEvents(p);
      }
      function renderCase() {
        if (!G.activeCases.length)
          return '<div class="panel"><h2>üìã Brak Spraw</h2><p style="color:#888">Idz do DRZWI aby przyjac klienta.</p></div>';
        var h =
          '<div class="panel"><h2>üìã Aktywne Sprawy (' +
          G.activeCases.length +
          ")</h2>";
        for (var i = 0; i < G.activeCases.length; i++) {
          var c = G.activeCases[i],
            left = c.days - (G.day - c.startDay);
          var done = 0;
          for (var j = 0; j < c.evidence.length; j++) {
            if (c.evidence[j].verified) done++;
          }
          var ready = done == c.evidence.length;
          h +=
            '<div class="case-card' +
            (G.selectedCase == i ? " active" : "") +
            '" data-idx="' +
            i +
            '"><h4>' +
            c.avatar +
            " " +
            c.name +
            "</h4><p>" +
            c.type +
            " | ‚è∞" +
            left +
            " dni | " +
            (ready ? "‚úÖ Gotowe" : "üîç " + done + "/" + c.evidence.length) +
            "</p></div>";
        }
        h += "</div>";
        if (G.selectedCase !== null && G.activeCases[G.selectedCase]) {
          var c = G.activeCases[G.selectedCase];
          h +=
            '<div class="panel"><h3 style="color:#fff;margin-bottom:10px">' +
            c.avatar +
            " " +
            c.name +
            " - " +
            c.type +
            '</h3><p style="color:#888;font-size:12px;margin-bottom:10px;line-height:1.5">' +
            c.fullStory +
            '</p><button class="chat-client-btn" data-cidx="' +
            G.selectedCase +
            '" style="background:#0ff;color:#000;border:none;padding:8px 15px;border-radius:5px;cursor:pointer;margin-bottom:15px">üí¨ Napisz do klienta (popros o wiecej screenow!)</button><h4 style="color:#0ff;margin-bottom:10px">üìé Dowody (' +
            c.evidence.length +
            '/4 max):</h4><div class="evidence-grid">';
          for (var j = 0; j < c.evidence.length; j++) {
            var e = c.evidence[j];
            h +=
              '<div class="evidence-card" data-eid="' +
              e.id +
              '"><div class="evidence-img"><img src="' +
              e.img +
              '"></div><span class="badge ' +
              (e.verified
                ? e.verdict
                  ? "badge-fake"
                  : "badge-ok"
                : "badge-pending") +
              '">' +
              (e.verified
                ? e.verdict
                  ? "‚ö†Ô∏è FALSZ"
                  : "‚úÖ OK"
                : "‚ùì Analizuj") +
              "</span></div>";
          }
          h += "</div></div>";
        }
        return h;
      }
      function renderSend() {
        var ready = G.activeCases.filter(function (c) {
          for (var i = 0; i < c.evidence.length; i++) {
            if (!c.evidence[i].verified) return false;
          }
          return true;
        });
        var partial = G.activeCases.filter(function (c) {
          var done = 0;
          for (var i = 0; i < c.evidence.length; i++) {
            if (c.evidence[i].verified) done++;
          }
          return done > 0 && done < c.evidence.length;
        });
        if (!ready.length) {
          var msg = "Przeanalizuj dowody!";
          if (partial.length)
            msg =
              "Przeanalizuj WSZYSTKIE dowody! (" +
              partial[0].name +
              ": " +
              partial[0].evidence.filter(function (e) {
                return e.verified;
              }).length +
              "/" +
              partial[0].evidence.length +
              ")";
          return (
            '<div class="panel"><h2>üì§ Wyslij</h2><p style="color:#f90">' +
            msg +
            "</p></div>"
          );
        }
        var h =
          '<div class="panel"><h2>üì§ Wyslij</h2><select id="case-sel" style="width:100%;padding:10px;background:#1a1a2e;border:1px solid #2a2a4e;color:#fff;border-radius:5px;margin-bottom:10px">';
        for (var i = 0; i < ready.length; i++) {
          var idx = G.activeCases.indexOf(ready[i]);
          h +=
            '<option value="' +
            idx +
            '">' +
            ready[i].name +
            " (" +
            ready[i].type +
            ") - " +
            ready[i].evidence.length +
            " dowodow</option>";
        }
        h +=
          '</select><p style="color:#f90;font-size:11px;margin-bottom:5px">‚ö†Ô∏è Bledne wnioski = GRZYWNA lub ZAWIESZENIE!</p><button id="mediator-btn" style="width:100%;background:linear-gradient(135deg,#fc0,#f90);color:#000;border:none;padding:10px;font-family:Orbitron;cursor:pointer;border-radius:8px;margin-bottom:15px;font-size:12px">ü§µ ZAPYTAJ POSREDNIKA</button><div class="recipient-grid"><div class="recipient-opt" data-r="Policja"><div class="icon">üöî</div><div class="name">Policja</div></div><div class="recipient-opt" data-r="Sad"><div class="icon">‚öñÔ∏è</div><div class="name">Sad</div></div></div><button class="send-btn" id="send-btn" disabled>üì§ WYSLIJ</button></div>';
        return h;
      }
      function renderInbox() {
        if (!G.inbox.length)
          return '<div class="panel"><h2>üì¨ Poczta</h2><p style="color:#888">Brak.</p></div>';
        var h = '<div class="panel"><h2>üì¨ Poczta</h2>';
        for (var i = 0; i < G.inbox.length; i++) {
          var m = G.inbox[i];
          h +=
            '<div class="mail-item' +
            (m.read ? "" : " unread") +
            '" data-idx="' +
            i +
            '"><strong>' +
            m.from +
            '</strong><p style="color:#888;font-size:11px">' +
            m.body.substring(0, 40) +
            "...</p></div>";
        }
        return h + "</div>";
      }
      function renderShop() {
        var tax = getTotalTax();
        var h =
          '<div class="panel"><h2>üõí Sklep</h2><p style="color:#f90;font-size:11px;margin-bottom:10px">‚ö†Ô∏è Op≈Çata za narzƒôdzia: <strong>' +
          tax +
          "%</strong> z ka≈ºdej wyp≈Çaty</p>";
        for (var k in TOOLS) {
          if (k == "zoom") continue;
          var t = TOOLS[k];
          var owned = G.tools[k];
          var sellPrice = Math.floor(t.p * 0.05);
          h +=
            '<div class="shop-item" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px"><span style="color:#fff">' +
            t.n +
            ' <span style="color:#f90;font-size:10px">(' +
            t.tax +
            "%)</span></span>";
          if (owned) {
            h +=
              '<button class="sell-btn" data-tool="' +
              k +
              '" style="background:#f36;color:#fff;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:11px">Sprzedaj ' +
              sellPrice +
              "üí∞</button>";
          } else {
            h +=
              '<button class="shop-btn" data-tool="' +
              k +
              '" ' +
              (G.credits < t.p ? "disabled" : "") +
              ' style="background:#0ff;color:#000;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:11px">' +
              t.p +
              "üí∞</button>";
          }
          h += "</div>";
        }
        return (
          h +
          '</div><div class="panel"><h2>‚öôÔ∏è</h2><button id="reset-btn" style="background:#f36;color:#fff;border:none;padding:10px;border-radius:5px;cursor:pointer">üóëÔ∏è RESET</button></div>'
        );
      }
      function renderArchive() {
        var h = '<div class="panel"><h2>üìÅ Archiwum</h2>';
        if (!G.completed.length) h += '<p style="color:#888">Brak.</p>';
        for (var i = 0; i < G.completed.length; i++) {
          var c = G.completed[i];
          h +=
            '<div class="shop-item"><span>' +
            c.name +
            '</span><span style="color:' +
            (c.rew >= 0 ? "#0f8" : "#f36") +
            '">' +
            (c.rew >= 0 ? "+" : "") +
            c.rew +
            "üí∞</span></div>";
        }
        return h + "</div>";
      }
      function bindEvents(p) {
        if (p == "case") {
          var cards = document.querySelectorAll(".case-card");
          for (var i = 0; i < cards.length; i++) {
            cards[i].onclick = cards[i].ontouchend = function (e) {
              e.preventDefault();
              G.selectedCase = parseInt(this.dataset.idx);
              saveGame();
              renderPanel("case");
            };
          }
          var evs = document.querySelectorAll(".evidence-card");
          for (var i = 0; i < evs.length; i++) {
            evs[i].onclick = evs[i].ontouchend = function (e) {
              e.preventDefault();
              openAnalysis(this.dataset.eid);
            };
          }
          var chatBtn = document.querySelector(".chat-client-btn");
          if (chatBtn) {
            chatBtn.onclick = chatBtn.ontouchend = function (e) {
              e.preventDefault();
              openClientChat(parseInt(this.dataset.cidx));
            };
          }
        }
        if (p == "send") {
          var sel = null;
          var opts = document.querySelectorAll(".recipient-opt");
          for (var i = 0; i < opts.length; i++) {
            opts[i].onclick = opts[i].ontouchend = function (e) {
              e.preventDefault();
              for (var j = 0; j < opts.length; j++)
                opts[j].classList.remove("selected");
              this.classList.add("selected");
              sel = this.dataset.r;
              document.getElementById("send-btn").disabled = false;
            };
          }
          document.getElementById("send-btn").onclick = document.getElementById(
            "send-btn"
          ).ontouchend = function (e) {
            e.preventDefault();
            if (sel) {
              var idx = parseInt(document.getElementById("case-sel").value);
              finishCase(idx, sel);
            }
          };
          var mb = document.getElementById("mediator-btn");
          if (mb) {
            mb.onclick = mb.ontouchend = function (e) {
              e.preventDefault();
              openMediatorChat();
            };
          }
        }
        if (p == "inbox") {
          var items = document.querySelectorAll(".mail-item");
          for (var i = 0; i < items.length; i++) {
            items[i].onclick = items[i].ontouchend = function (e) {
              e.preventDefault();
              var m = G.inbox[this.dataset.idx];
              m.read = true;
              saveGame();
              alert(m.from + "\n\n" + m.body);
              renderPanel("inbox");
            };
          }
        }
        if (p == "shop") {
          var btns = document.querySelectorAll(".shop-btn");
          for (var i = 0; i < btns.length; i++) {
            btns[i].onclick = btns[i].ontouchend = function (e) {
              e.preventDefault();
              var t = this.dataset.tool;
              if (!G.tools[t] && G.credits >= TOOLS[t].p) {
                G.credits -= TOOLS[t].p;
                G.tools[t] = true;
                updateHUD();
                saveGame();
                renderPanel("shop");
                notify(
                  "Kupiono!",
                  TOOLS[t].n + " (-" + TOOLS[t].tax + "% z wyp≈Çat)"
                );
              }
            };
          }
          var sellBtns = document.querySelectorAll(".sell-btn");
          for (var i = 0; i < sellBtns.length; i++) {
            sellBtns[i].onclick = sellBtns[i].ontouchend = function (e) {
              e.preventDefault();
              var t = this.dataset.tool;
              if (G.tools[t]) {
                sellTool(t);
                renderPanel("shop");
              }
            };
          }
          var rb = document.getElementById("reset-btn");
          if (rb)
            rb.onclick = function () {
              if (confirm("Reset?")) {
                localStorage.clear();
                location.reload();
              }
            };
        }
      }
      var curEv = null,
        curCase = null;
      function openAnalysis(eid) {
        if (G.selectedCase === null) return;
        curCase = G.activeCases[G.selectedCase];
        curEv = null;
        for (var i = 0; i < curCase.evidence.length; i++) {
          if (curCase.evidence[i].id == eid) curEv = curCase.evidence[i];
        }
        if (!curEv) return;
        document.getElementById("analysis-img").src = curEv.img;
        document.getElementById("analysis").style.display = "flex";
        if (!G.results[curCase.id]) G.results[curCase.id] = {};
        if (!G.results[curCase.id][eid]) G.results[curCase.id][eid] = {};
        saveGame();
        renderTools();
      }
      document.getElementById("close-analysis").onclick = function () {
        document.getElementById("analysis").style.display = "none";
      };
      function renderTools() {
        var res = G.results[curCase.id][curEv.id] || {};
        var usedCount = 0;
        for (var k in res) {
          if (res[k] && k != "zoom") usedCount++;
        }
        var toolUsedThisRound = usedCount > 0;
        var h =
          '<div style="padding:5px"><h4 style="color:#0ff;margin-bottom:5px">NARZƒòDZIA</h4>';
        if (toolUsedThisRound)
          h +=
            '<p style="color:#f90;font-size:9px;margin-bottom:5px">‚ö†Ô∏è U≈ºyto narzƒôdzia - oce≈Ñ dow√≥d!</p>';
        for (var k in TOOLS) {
          var t = TOOLS[k],
            have = G.tools[k],
            used = res[k];
          var blocked = toolUsedThisRound && !used && k != "zoom";
          h +=
            '<button class="tool-btn' +
            (have ? "" : " locked") +
            (used ? " active" : "") +
            (blocked ? " blocked" : "") +
            '" data-t="' +
            k +
            '" ' +
            (blocked ? "disabled" : "") +
            ">" +
            t.n +
            " " +
            (have ? (used ? "‚úì" : "") : t.p + "üí∞") +
            "</button>";
        }
        h += '</div><div id="results-box"><h5 style="color:#0ff">üìä</h5>';
        for (var k in res) {
          if (!res[k]) continue;
          h +=
            '<div class="result-row"><span>' +
            TOOLS[k].n +
            '</span><span class="result-val ' +
            (res[k].s ? "sus" : "ok") +
            '">' +
            (res[k].s ? "‚ö†Ô∏è" : "‚úì") +
            '</span></div><p style="color:#888;font-size:10px">' +
            res[k].i +
            "</p>";
        }
        h +=
          '</div><div id="verdict-btns"><button class="verdict-btn v-ok" id="v-ok">‚úì PRAWDZIWY</button><button class="verdict-btn v-fake" id="v-fake">‚úó FA≈ÅSZYWY</button></div>';
        document.getElementById("tools-panel").innerHTML = h;
        var btns = document.querySelectorAll(".tool-btn");
        for (var i = 0; i < btns.length; i++) {
          btns[i].onclick = btns[i].ontouchend = function (e) {
            e.preventDefault();
            var t = this.dataset.t;
            if (!G.tools[t]) {
              notify("Brak!", "Kup w sklepie");
              return;
            }
            if (this.classList.contains("blocked")) {
              notify("Zablokowane!", "1 narzƒôdzie na dow√≥d");
              return;
            }
            if (t == "zoom") {
              var img = document.getElementById("analysis-img");
              var compare = document.getElementById("compare-panel");
              var compareImg = document.getElementById("compare-img");
              if (!img.dataset.zoomed || img.dataset.zoomed == "false") {
                img.style.transform = "scale(1.8)";
                img.style.transformOrigin = "top left";
                img.style.cursor = "zoom-out";
                img.dataset.zoomed = "true";
                document.getElementById("evidence-side").style.alignItems =
                  "flex-start";
                document.getElementById("evidence-side").style.justifyContent =
                  "flex-start";
                document.getElementById("evidence-side").style.overflow =
                  "auto";
                compare.style.display = "block";
                var appType = curEv.tp.split(" ")[0].split("#")[0].trim();
                compareImg.src = genCompareImg(appType);
                compareImg.style.cursor = "zoom-in";
                compareImg.onclick = function () {
                  if (this.style.transform == "scale(2)") {
                    this.style.transform = "scale(1)";
                    this.style.cursor = "zoom-in";
                  } else {
                    this.style.transform = "scale(2)";
                    this.style.cursor = "zoom-out";
                  }
                };
                G.results[curCase.id][curEv.id]["zoom"] = {
                  s: 0,
                  i: "Por√≥wnaj czcionkƒô i uk≈Çad z orygina≈Çem ‚Üí",
                };
                notify("üîç Lupa+Por√≥wnanie", "Orygina≈Ç po prawej!");
              } else {
                img.style.transform = "scale(1)";
                img.style.transformOrigin = "center";
                img.style.cursor = "zoom-in";
                img.dataset.zoomed = "false";
                compare.style.display = "none";
                document.getElementById("evidence-side").style.alignItems =
                  "center";
                document.getElementById("evidence-side").style.justifyContent =
                  "center";
              }
              renderTools();
              return;
            }
            var resObj = G.results[curCase.id][curEv.id];
            var alreadyUsed = false;
            for (var kk in resObj) {
              if (resObj[kk] && kk != "zoom") alreadyUsed = true;
            }
            if (alreadyUsed) {
              notify("Limit!", "1 narzƒôdzie na dow√≥d");
              return;
            }
            if (!curEv.ind || !curEv.ind[t]) return;
            if (G.results[curCase.id][curEv.id][t]) return;
            G.results[curCase.id][curEv.id][t] = curEv.ind[t];
            renderTools();
            saveGame();
            notify(TOOLS[t].n, curEv.ind[t].s ? "‚ö†Ô∏è PODEJRZANE!" : "‚úì OK");
          };
        }
        var vok = document.getElementById("v-ok");
        var vfake = document.getElementById("v-fake");
        if (vok) {
          vok.onclick = vok.ontouchend = function (e) {
            e.preventDefault();
            verdict(false);
          };
        }
        if (vfake) {
          vfake.onclick = vfake.ontouchend = function (e) {
            e.preventDefault();
            verdict(true);
          };
        }
      }
      function verdict(isFake) {
        curEv.verified = true;
        curEv.verdict = isFake;
        document.getElementById("analysis").style.display = "none";
        saveGame();
        renderPanel("case");
        if (curCase.evidence[0].verified) {
          notify("Gotowe!", "Wy≈õlij");
          document.querySelector('[data-panel="send"]').classList.add("notify");
        }
      }
      var chatCaseIdx = null;
      function openClientChat(idx) {
        chatCaseIdx = idx;
        var c = G.activeCases[idx];
        if (!c.chatHistory) c.chatHistory = [];
        document.getElementById("chat-client-name").textContent =
          "üí¨ " + c.avatar + " " + c.name;
        renderChatMessages(c);
        document.getElementById("client-chat").style.display = "flex";
      }
      function renderChatMessages(c) {
        var h =
          '<div class="chat-msg client">' +
          c.avatar +
          ": Dzien dobry! Dziekuje ze sie Pan/Pani zajmuje moja sprawa. Jesli potrzeba wiecej screenow - prosze pisac!</div>";
        if (c.chatHistory) {
          for (var i = 0; i < c.chatHistory.length; i++) {
            var m = c.chatHistory[i];
            var txt = m.text;
            var imgHtml = "";
            if (txt.indexOf("__IMG__") >= 0 && txt.indexOf("__ENDIMG__") >= 0) {
              var imgStart = txt.indexOf("__IMG__") + 7;
              var imgEnd = txt.indexOf("__ENDIMG__");
              var imgSrc = txt.substring(imgStart, imgEnd);
              imgHtml =
                '<div style="background:#0a0a15;padding:8px;border-radius:8px;margin:8px 0"><img src="' +
                imgSrc +
                '" style="max-width:100%;border-radius:5px;border:2px solid #0ff"><p style="color:#0ff;font-size:10px;margin-top:5px">üìé NOWY DOWOD - sprawdz w SPRAWY</p></div>';
              txt = txt.substring(imgEnd + 10);
            }
            h +=
              '<div class="chat-msg ' +
              m.from +
              '" style="margin-bottom:12px">' +
              (m.from == "you"
                ? '<b style="color:#0ff">Ty:</b> '
                : "<b>" + c.avatar + ":</b> ") +
              txt +
              imgHtml +
              "</div>";
          }
        }
        document.getElementById("chat-messages").innerHTML = h;
        var msgs = document.getElementById("chat-messages");
        msgs.scrollTop = msgs.scrollHeight;
      }
      function getClientResponse(c, msg) {
        var m = msg.toLowerCase();
        // POZDROWIENIA
        if (
          m.indexOf("dzien dobry") >= 0 ||
          m.indexOf("dzie≈Ñ dobry") >= 0 ||
          m.indexOf("hej") >= 0 ||
          m.indexOf("czesc") >= 0 ||
          m.indexOf("cze≈õƒá") >= 0 ||
          m.indexOf("witam") >= 0 ||
          m.indexOf("siema") >= 0 ||
          m.indexOf("hello") >= 0
        )
          return "Dzie≈Ñ dobry! Dziƒôkujƒô ≈ºe Pan/Pani siƒô zajmuje mojƒÖ sprawƒÖ. Jak mogƒô pom√≥c?";
        if (
          m.indexOf("jak sie masz") >= 0 ||
          m.indexOf("jak siƒô masz") >= 0 ||
          m.indexOf("co slychac") >= 0 ||
          m.indexOf("co s≈Çychaƒá") >= 0
        )
          return "Szczerze? Kiepsko... Ta sytuacja bardzo mnie stresuje. Ale dziƒôkujƒô ≈ºe Pan/Pani pyta.";
        if (
          m.indexOf("dobranoc") >= 0 ||
          m.indexOf("do widzenia") >= 0 ||
          m.indexOf("pa") >= 0 ||
          m.indexOf("nara") >= 0
        )
          return "Do widzenia! Proszƒô daƒá znaƒá jak bƒôdƒÖ jakie≈õ postƒôpy w sprawie.";
        // SCREENY
        var wantsScreens =
          m.indexOf("screen") >= 0 ||
          m.indexOf("zdj") >= 0 ||
          m.indexOf("foto") >= 0 ||
          m.indexOf("dowod") >= 0 ||
          m.indexOf("dow√≥d") >= 0 ||
          m.indexOf("wyslij") >= 0 ||
          m.indexOf("wy≈õlij") >= 0 ||
          m.indexOf("przeslij") >= 0 ||
          m.indexOf("prze≈õlij") >= 0 ||
          m.indexOf("pokaz") >= 0 ||
          m.indexOf("poka≈º") >= 0 ||
          m.indexOf("wiecej") >= 0 ||
          m.indexOf("wiƒôcej") >= 0 ||
          m.indexOf("jeszcze") >= 0;
        if (wantsScreens) {
          if (!c.extraScreensSent) c.extraScreensSent = 0;
          if (c.extraScreensSent >= 3)
            return (
              "To ju≈º wszystko co mam. Wys≈Ça≈Çem/am ju≈º " +
              c.evidence.length +
              " screen√≥w - wiƒôcej nie posiadam. Przepraszam!"
            );
          c.extraScreensSent++;
          var baseEv = c.evidence[0];
          var isFake = baseEv.fake;
          function generateScreenText(c, num) {
            var baseEv = c.evidence[0];
            var name = c.name.split(" ")[0];
            var isFemale =
              c.avatar.indexOf("üë©") >= 0 ||
              c.avatar.indexOf("üßë‚Äçü¶∞") >= 0 ||
              c.avatar.indexOf("üëß") >= 0;
            var suspect = c.suspect || "nieznany sprawca";

            if (c.type == "STALKING") {
              var texts = [
                "Widzia≈Çem ciƒô dzisiaj na mie≈õcie. " +
                  (isFemale
                    ? "≈Åadnie wyglƒÖda≈Ça≈õ."
                    : "WyglƒÖda≈Çe≈õ na zmƒôczonego."),
                "Dlaczego mnie ignorujesz? Wiem ≈ºe czytasz moje wiadomo≈õci.",
                "Zauwa≈ºy≈Çem ≈ºe " +
                  (isFemale ? "zmieni≈Ça≈õ" : "zmieni≈Çe≈õ") +
                  " trasƒô. My≈õlisz ≈ºe to pomo≈ºe?",
                isFemale
                  ? "Widzia≈Çem ciƒô z tƒÖ kole≈ºankƒÖ. Kim ona jest?"
                  : "Widzia≈Çem ciƒô z tym kolegƒÖ. Kim on jest?",
                "Nie uciekniesz przede mnƒÖ. Zawsze ciƒô znajdƒô.",
                "Twoje okno by≈Ço otwarte wczoraj wieczorem.",
                "Wiem o kt√≥rej wychodzisz z domu i o kt√≥rej wracasz.",
                isFemale ? "Ta nowa fryzura ci pasuje." : "Nowa kurtka? ≈Åadna.",
                "Widzƒô wszystko co robisz. Nie mo≈ºesz siƒô przede mnƒÖ schowaƒá.",
                "Dlaczego nie odbierasz telefon√≥w? Wiem ≈ºe masz przy sobie kom√≥rkƒô.",
              ];
              return texts[num % texts.length];
            }

            if (c.type == "GRO≈πBY") {
              var isGroup =
                c.fullStory.indexOf("grupa") >= 0 ||
                c.fullStory.indexOf("kole≈ºank") >= 0;
              var isChild =
                c.fullStory.indexOf("c√≥rk") >= 0 ||
                c.fullStory.indexOf("13") >= 0 ||
                c.fullStory.indexOf("12") >= 0 ||
                c.fullStory.indexOf("nastolatk") >= 0;
              if (isChild || isGroup) {
                var texts = [
                  "Lepiej nie przychod≈∫ jutro do szko≈Çy.",
                  "Wszyscy wiedzƒÖ ≈ºe jeste≈õ dziwna. Nikt ciƒô nie lubi.",
                  "Jak przyjdziesz to po≈ºa≈Çujesz. Ostrzegamy.",
                  "Twoje zdjƒôcie krƒÖ≈ºy po ca≈Çej szkole haha.",
                  "Czekamy na ciebie po lekcjach.",
                  "My≈õlisz ≈ºe jeste≈õ lepsza? Poka≈ºemy ci.",
                  "Nie masz ≈ºadnych prawdziwych przyjaci√≥≈Ç.",
                  "Wszyscy siƒô z ciebie ≈õmiejƒÖ za plecami.",
                  "Lepiej siƒô wyprowad≈∫ z miasta.",
                  "To dopiero poczƒÖtek. Bƒôdzie gorzej.",
                ];
                return texts[num % texts.length];
              } else {
                var texts = [
                  "Znajdƒô ciƒô i po≈ºa≈Çujesz.",
                  "Wiem gdzie mieszkasz. Uwa≈ºaj.",
                  "Ty i twoja rodzina zap≈Çacicie za to.",
                  "Lepiej oglƒÖdaj siƒô za siebie.",
                  "To ostrze≈ºenie. Nastƒôpnym razem bƒôdzie gorzej.",
                  "Zniszczƒô ci ≈ºycie.",
                  "Masz 24h ≈ºeby przeprosiƒá.",
                  "Tw√≥j samoch√≥d ≈Çadnie wyglƒÖda. Szkoda jakby co≈õ mu siƒô sta≈Ço.",
                  "Nie ≈õpij spokojnie.",
                  "Pamiƒôtaj - zawsze ciƒô znajdƒô.",
                ];
                return texts[num % texts.length];
              }
            }

            if (c.type == "ZNIES≈ÅAWIENIE") {
              var texts = [
                "UWAGA! " +
                  name +
                  " to oszust! Nie wierzcie " +
                  (isFemale ? "jej" : "mu") +
                  "!",
                "Mam dowody ≈ºe " + name + " oszukuje ludzi!",
                name + " kradnie od swoich klient√≥w! Udostƒôpniajcie!",
                "SKANDAL! " +
                  name +
                  " " +
                  (isFemale ? "bra≈Ça" : "bra≈Ç") +
                  " ≈Çap√≥wki!",
                name +
                  " to " +
                  (isFemale ? "z≈Çodziejka" : "z≈Çodziej") +
                  "! Ka≈ºdy w mie≈õcie wie!",
                "Ta osoba jest niebezpieczna! Ostrzegam wszystkich!",
                name + " oszukuje na ka≈ºdym kroku! Mam nagrania!",
                "Nie r√≥bcie interes√≥w z " +
                  name +
                  "! " +
                  (isFemale ? "Oszuka≈Ça" : "Oszuka≈Ç") +
                  " mnie na tysiƒÖce!",
                "UWAGA NA OSZUSTA! " +
                  name +
                  " " +
                  (isFemale ? "zniszczy≈Ça" : "zniszczy≈Ç") +
                  " mi ≈ºycie!",
                "Wszyscy muszƒÖ wiedzieƒá prawdƒô o " + name + "!",
              ];
              return texts[num % texts.length];
            }

            if (c.type == "OSZUSTWO") {
              var texts = [
                "Przelej jeszcze 200 z≈Ç na doko≈Ñczenie transakcji.",
                "Twoja paczka czeka, dop≈Çaƒá 15 z≈Ç c≈Ça.",
                "To ja, tw√≥j kuzyn. Potrzebujƒô pilnie 500 z≈Ç.",
                "Wygra≈Çe≈õ nagrodƒô! Wp≈Çaƒá podatek ≈ºeby odebraƒá.",
                "Jestem z banku, proszƒô potwierdziƒá dane.",
                "Sprzedam taniej ni≈º w sklepie! Przedp≈Çata 50%.",
                "Ostatnia szansa! Promocja ko≈Ñczy siƒô za godzinƒô!",
                "Zainwestuj teraz, zysk gwarantowany!",
                "Twoje konto zostanie zablokowane. Kliknij link.",
                "Mama, zmieni≈Çam numer. Po≈ºycz mi pilnie pieniƒÖdze.",
              ];
              return texts[num % texts.length];
            }

            if (c.type == "HACKING") {
              var texts = [
                "Mamy dostƒôp do twoich danych. P≈Çaƒá albo publikujemy.",
                "Twoje has≈Ça sƒÖ nasze. Wszystkie konta przejƒôte.",
                "Nagrali≈õmy ciƒô przez kamerkƒô. Mamy materia≈Ç.",
                "Szyfrujemy tw√≥j dysk. 48h na zap≈Çatƒô.",
                "Twoja poczta nale≈ºy do nas. Widzimy wszystko.",
                "Mamy twoje dane bankowe. Wsp√≥≈Çpracuj.",
                "Keylogger aktywny. Widzimy wszystko co piszesz.",
                "Tw√≥j telefon jest pod kontrolƒÖ.",
                "Wykradli≈õmy wszystkie twoje zdjƒôcia.",
                "Zap≈Çaƒá albo twoi znajomi zobaczƒÖ ciekawe rzeczy.",
              ];
              return texts[num % texts.length];
            }

            if (c.type == "SZANTA≈ª") {
              var texts = [
                "Mam twoje prywatne zdjƒôcia. Wp≈Çaƒá albo wy≈õlƒô wszystkim.",
                "Wiem o twojej tajemnicy. Mo≈ºemy siƒô dogadaƒá.",
                "Mam screeny rozm√≥w. Wyobra≈∫ sobie co powiedzƒÖ w pracy.",
                "Twoje sekrety sƒÖ bezpieczne. Na razie.",
                "Opublikujƒô wszystko je≈õli nie zap≈Çacisz.",
                "Mam materia≈Çy kt√≥rych nie chcesz ≈ºeby kto≈õ widzia≈Ç.",
                "Twoi znajomi chƒôtnie zobaczƒÖ co mam.",
                "Mo≈ºemy to za≈Çatwiƒá po cichu. Albo wszyscy siƒô dowiedzƒÖ.",
                "P≈Çaƒá co miesiƒÖc albo zaczynam wysy≈Çaƒá.",
                "To by≈Çaby szkoda gdyby rodzina zobaczy≈Ça...",
              ];
              return texts[num % texts.length];
            }

            if (c.type == "PODSZYWANIE") {
              var texts = [
                "[Fa≈Çszywy profil " +
                  name +
                  "] Oszukujƒô klient√≥w i nic mi nie zrobicie!",
                "[Fa≈Çszywy profil " + name + "] Moja firma to ≈õciema!",
                "[Fa≈Çszywy profil " + name + "] Kradnƒô pomys≈Çy od innych!",
                "[Fa≈Çszywy profil " + name + "] Nienawidzƒô swoich klient√≥w!",
                "[Fa≈Çszywy profil " +
                  name +
                  "] Sprzedajƒô podr√≥bki jako orygina≈Çy!",
                "[Fa≈Çszywy profil " + name + "] Nie p≈Çacƒô podatk√≥w haha!",
                "[Fa≈Çszywy profil " +
                  name +
                  "] Wyrzucam pracownik√≥w bez powodu!",
                "[Fa≈Çszywy profil " +
                  name +
                  "] Moje produkty sƒÖ bezwarto≈õciowe!",
                "[Fa≈Çszywy profil " + name + "] Oszukujƒô na wadze!",
                "[Fa≈Çszywy profil " + name + "] Zaczynam piramidƒô finansowƒÖ!",
              ];
              return texts[num % texts.length];
            }

            return baseEv.txt;
          }

          var randomText = generateScreenText(c, c.extraScreensSent);
          var newEv = {
            id: "e" + c.id + "_" + c.extraScreensSent,
            tp: baseEv.tp + " #" + (c.evidence.length + 1),
            fake: isFake,
            txt: randomText,
            verified: false,
            verdict: null,
            ind: {
              meta: {
                s: isFake ? 1 : 0,
                i: isFake
                  ? "Plik edytowany w " +
                    ["Photoshop", "GIMP", "Paint.NET", "Canva"][
                      c.extraScreensSent % 4
                    ]
                  : "Oryginalny plik",
              },
              ela: {
                s: isFake ? 1 : 0,
                i: isFake
                  ? "Wykryto ≈õlady manipulacji pikseli"
                  : "Brak ≈õlad√≥w manipulacji",
              },
              font: {
                s: isFake ? 1 : 0,
                i: isFake
                  ? "Czcionka niezgodna z aplikacjƒÖ " + baseEv.tp
                  : "Czcionka zgodna z " + baseEv.tp,
              },
              time: {
                s: isFake ? 1 : 0,
                i: isFake
                  ? "Znacznik czasu podejrzany/niemo≈ºliwy"
                  : "Znaczniki czasowe prawid≈Çowe",
              },
              ai: {
                s: isFake ? 1 : 0,
                i: isFake
                  ? 78 +
                    Math.floor(Math.random() * 18) +
                    "% - prawdopodobnie fa≈Çszywy"
                  : 1 +
                    Math.floor(Math.random() * 9) +
                    "% - wyglƒÖda na autentyczny",
              },
            },
          };
          newEv.img = genImg(newEv);
          c.evidence.push(newEv);
          if (!G.results[c.id]) G.results[c.id] = {};
          G.results[c.id][newEv.id] = {};
          saveGame();
          setTimeout(function () {
            notify(
              "üìé Nowy dow√≥d!",
              "Screen #" + c.evidence.length + " dodany!"
            );
            renderPanel("case");
          }, 300);
          return (
            "__IMG__" +
            newEv.img +
            "__ENDIMG__Wysy≈Çam screen #" +
            c.evidence.length +
            "! Mam jeszcze " +
            (3 - c.extraScreensSent) +
            ". Sprawd≈∫ w zak≈Çadce SPRAWY."
          );
        }
        // STALKING
        if (c.type == "STALKING") {
          if (
            m.indexOf("ile") >= 0 &&
            (m.indexOf("wiadom") >= 0 || m.indexOf("razy") >= 0)
          )
            return "Dostajƒô po 10-20 wiadomo≈õci dziennie. Czasem wiƒôcej. To nie ustaje od tygodni.";
          if (
            m.indexOf("gdzie") >= 0 &&
            (m.indexOf("widzi") >= 0 ||
              m.indexOf("≈õledzi") >= 0 ||
              m.indexOf("sledzi") >= 0)
          )
            return "Widzia≈Ç mnie w kawiarni, pod pracƒÖ, w sklepie, na si≈Çowni... Dos≈Çownie wszƒôdzie!";
          if (m.indexOf("blokow") >= 0 || m.indexOf("zablokowac") >= 0)
            return "Blokowa≈Çam go ju≈º z 10 razy! Ale ciƒÖgle zak≈Çada nowe konta i pisze dalej.";
          if (
            m.indexOf("od kiedy") >= 0 ||
            m.indexOf("jak dlugo") >= 0 ||
            m.indexOf("jak d≈Çugo") >= 0
          )
            return "To trwa ju≈º prawie 3 miesiƒÖce, od naszego rozstania. Nie odpuszcza.";
          if (
            m.indexOf("boisz") >= 0 ||
            m.indexOf("strach") >= 0 ||
            m.indexOf("bezpiecz") >= 0
          )
            return "Tak, bardzo siƒô bojƒô! Nie wychodzƒô sama z domu. Czujƒô siƒô obserwowana 24/7.";
          if (m.indexOf("policj") >= 0)
            return "By≈Çam na policji ale powiedzieli ≈ºe to za ma≈Ço dowod√≥w. Dlatego do Pana/Pani przysz≈Çam.";
          if (m.indexOf("numer") >= 0 || m.indexOf("telefon") >= 0)
            return "Pisze z r√≥≈ºnych numer√≥w. Blokujƒô jeden, pojawia siƒô nastƒôpny.";
        }
        // GRO≈πBY
        if (c.type == "GRO≈πBY") {
          if (
            m.indexOf("ile") >= 0 &&
            (m.indexOf("wiadom") >= 0 ||
              m.indexOf("groz") >= 0 ||
              m.indexOf("gro≈∫") >= 0 ||
              m.indexOf("razy") >= 0)
          )
            return "Dosta≈Çem/am ju≈º ponad 20 takich wiadomo≈õci. Ka≈ºda gorsza od poprzedniej!";
          if (
            m.indexOf("grupa") >= 0 ||
            m.indexOf("ile osob") >= 0 ||
            m.indexOf("ile os√≥b") >= 0
          )
            return "To chyba 4-5 os√≥b w grupie. PiszƒÖ z r√≥≈ºnych kont ale styl podobny.";
          if (m.indexOf("policj") >= 0)
            return "Zg≈Çosi≈Çem/am na policjƒô ale powiedzieli ≈ºe potrzebujƒÖ wiƒôcej dowod√≥w.";
          if (m.indexOf("boisz") >= 0 || m.indexOf("strach") >= 0)
            return "Tak, bojƒô siƒô o siebie i rodzinƒô! Gro≈ºƒÖ ≈ºe wiedzƒÖ gdzie mieszkam!";
          if (
            m.indexOf("skad") >= 0 ||
            m.indexOf("skƒÖd") >= 0 ||
            m.indexOf("dlaczego") >= 0
          )
            return "Nie wiem skƒÖd ta nienawi≈õƒá... Mo≈ºe to przez konflikt w pracy/szkole.";
          if (m.indexOf("anonimow") >= 0)
            return "Tak, piszƒÖ z anonimowych kont. Nie mogƒô ustaliƒá kim sƒÖ.";
        }
        // ZNIES≈ÅAWIENIE
        if (c.type == "ZNIES≈ÅAWIENIE") {
          if (
            m.indexOf("gdzie") >= 0 &&
            (m.indexOf("opublik") >= 0 || m.indexOf("post") >= 0)
          )
            return "To by≈Ço na Facebooku i jakim≈õ forum lokalnym. Post by≈Ç udostƒôpniany setki razy!";
          if (
            m.indexOf("ile") >= 0 &&
            (m.indexOf("osob") >= 0 ||
              m.indexOf("os√≥b") >= 0 ||
              m.indexOf("ludzi") >= 0)
          )
            return "Widzia≈Ço to setki os√≥b! Niekt√≥rzy nawet mi to wysy≈Çali z pytaniem czy to prawda.";
          if (m.indexOf("usun") >= 0 || m.indexOf("skasow") >= 0)
            return "Zg≈Çasza≈Çem/am do usuniƒôcia ale platforma nie reaguje. Dalej tam wisi!";
          if (m.indexOf("strac") >= 0 || m.indexOf("szkod") >= 0)
            return "Straci≈Çem/am klient√≥w, znajomych siƒô odsunƒô≈Ço, w pracy patrzƒÖ dziwnie...";
          if (
            m.indexOf("prawda") >= 0 ||
            m.indexOf("klamstw") >= 0 ||
            m.indexOf("k≈Çamstw") >= 0
          )
            return "To totalne k≈Çamstwa! Nigdy czego≈õ takiego nie zrobi≈Çem/am!";
        }
        // OSZUSTWO
        if (c.type == "OSZUSTWO") {
          if (
            m.indexOf("ile") >= 0 &&
            (m.indexOf("pieniedz") >= 0 ||
              m.indexOf("pieniƒôdz") >= 0 ||
              m.indexOf("zl") >= 0 ||
              m.indexOf("strac") >= 0)
          )
            return "Straci≈Çem/am kilka tysiƒôcy z≈Çotych. Ca≈Çe oszczƒôdno≈õci ≈ºycia!";
          if (m.indexOf("przelew") >= 0 || m.indexOf("bank") >= 0)
            return "Mam potwierdzenie przelewu. PieniƒÖdze posz≈Çy i przepad≈Çy.";
          if (m.indexOf("kontakt") >= 0 || m.indexOf("odpis") >= 0)
            return "Pr√≥bowa≈Çem/am siƒô kontaktowaƒá ale oszust zniknƒÖ≈Ç. Konto usuniƒôte, telefon martwy.";
          if (m.indexOf("jak") >= 0 && m.indexOf("oszuk") >= 0)
            return "Udawa≈Ç ≈ºe sprzedaje co≈õ tanio. Zap≈Çaci≈Çem/am i nigdy nie dosta≈Çem towaru.";
          if (m.indexOf("policj") >= 0)
            return "Policja m√≥wi ≈ºe trudno namierzyƒá bo konta fake. Dlatego potrzebujƒô pomocy!";
        }
        // HACKING
        if (c.type == "HACKING") {
          if (m.indexOf("haslo") >= 0 || m.indexOf("has≈Ço") >= 0)
            return "Moje has≈Ço by≈Ço silne... ale chyba wyciek≈Ço gdzie≈õ z bazy danych.";
          if (
            m.indexOf("ile") >= 0 &&
            (m.indexOf("pieniedz") >= 0 || m.indexOf("pieniƒôdz") >= 0)
          )
            return "Ukradli mi kilkana≈õcie tysiƒôcy z≈Çotych z konta!";
          if (
            m.indexOf("phishing") >= 0 ||
            m.indexOf("link") >= 0 ||
            m.indexOf("mail") >= 0
          )
            return "Tak, kliknƒÖ≈Çem w jaki≈õ link... G≈Çupia pomy≈Çka. Strona wyglƒÖda≈Ça jak bank.";
          if (m.indexOf("konto") >= 0)
            return "W≈Çamali siƒô na moje konto bankowe i do social media!";
        }
        // SZANTA≈ª
        if (c.type == "SZANTA≈ª") {
          if (
            m.indexOf("ile") >= 0 &&
            (m.indexOf("zada") >= 0 ||
              m.indexOf("≈ºƒÖda") >= 0 ||
              m.indexOf("chce") >= 0)
          )
            return "≈ªƒÖdajƒÖ ode mnie kilku tysiƒôcy z≈Çotych! To szale≈Ñstwo!";
          if (
            m.indexOf("zaplac") >= 0 ||
            m.indexOf("zap≈Çac") >= 0 ||
            m.indexOf("placic") >= 0 ||
            m.indexOf("p≈Çacic") >= 0
          )
            return "Nie chcƒô p≈Çaciƒá! Bojƒô siƒô ≈ºe i tak opublikujƒÖ. Szukam innego wyj≈õcia.";
          if (
            m.indexOf("zdjec") >= 0 ||
            m.indexOf("zdjƒôc") >= 0 ||
            m.indexOf("material") >= 0 ||
            m.indexOf("materia≈Ç") >= 0
          )
            return "To... prywatne materia≈Çy. Bardzo siƒô wstydzƒô ≈ºe da≈Çem siƒô w to wmanewrowaƒá.";
          if (m.indexOf("skad") >= 0 || m.indexOf("skƒÖd") >= 0)
            return "Poznali≈õmy siƒô na randkowym portalu. Potem zaczƒÖ≈Ç szanta≈ºowaƒá.";
        }
        // PODSZYWANIE
        if (c.type == "PODSZYWANIE") {
          if (m.indexOf("zdjec") >= 0 || m.indexOf("zdjƒôc") >= 0)
            return "Tak, u≈ºywajƒÖ mojego zdjƒôcia! Ukradli je z mojego profilu!";
          if (m.indexOf("zglos") >= 0 || m.indexOf("zg≈Ços") >= 0)
            return "Zg≈Çasza≈Çem do platformy ale ignorujƒÖ moje zg≈Çoszenia od tygodni.";
          if (m.indexOf("szkod") >= 0 || m.indexOf("strac") >= 0)
            return "Straci≈Çem przez to klient√≥w i kontrakty. Ludzie my≈õlƒÖ ≈ºe to ja piszƒô te rzeczy!";
        }
        // UNIWERSALNE
        if (
          m.indexOf("podejrzew") >= 0 ||
          m.indexOf("kto to") >= 0 ||
          m.indexOf("sprawca") >= 0
        )
          return c.suspect
            ? "Podejrzewam ≈ºe to: " + c.suspect + ". Ale nie mam 100% pewno≈õci."
            : "Nie wiem dok≈Çadnie kto za tym stoi. Dlatego potrzebujƒô pomocy!";
        if (
          m.indexOf("policj") >= 0 ||
          m.indexOf("zglosi") >= 0 ||
          m.indexOf("zg≈Çosi") >= 0
        )
          return "Sprawa idzie do policji? Proszƒô mi powiedzieƒá co mam robiƒá!";
        if (
          m.indexOf("sad") >= 0 ||
          m.indexOf("sƒÖd") >= 0 ||
          m.indexOf("rozpraw") >= 0
        )
          return "SƒÖd? Bƒôdƒô musia≈Ç/a zeznawaƒá? Trochƒô siƒô bojƒô ale zrobiƒô co trzeba.";
        if (
          m.indexOf("falsz") >= 0 ||
          m.indexOf("fa≈Çsz") >= 0 ||
          m.indexOf("fake") >= 0 ||
          m.indexOf("podrobion") >= 0
        )
          return "Uwa≈ºa Pan/Pani ≈ºe to sfa≈Çszowane? Co mam teraz robiƒá?";
        if (
          m.indexOf("prawdzi") >= 0 ||
          m.indexOf("autentycz") >= 0 ||
          m.indexOf("oryginal") >= 0
        )
          return "Te dowody sƒÖ prawdziwe? To dobrze czy ≈∫le dla mojej sprawy?";
        if (
          m.indexOf("dziek") >= 0 ||
          m.indexOf("dziƒôk") >= 0 ||
          m.indexOf("super") >= 0 ||
          m.indexOf("swietnie") >= 0 ||
          m.indexOf("≈õwietnie") >= 0
        )
          return "To ja dziƒôkujƒô! Bardzo siƒô cieszƒô ≈ºe kto≈õ wreszcie mi pomaga!";
        if (m.indexOf("spokojnie") >= 0 || m.indexOf("nie martw") >= 0)
          return "Dziƒôkujƒô... Staram siƒô nie panikowaƒá ale to naprawdƒô stresujƒÖca sytuacja.";
        if (m.indexOf("pomog") >= 0 || m.indexOf("zajm") >= 0)
          return "Dziƒôkujƒô bardzo! Liczƒô na Pana/PaniƒÖ. Ta sprawa jest dla mnie bardzo wa≈ºna.";
        if (
          m.indexOf("opowiedz") >= 0 ||
          m.indexOf("od poczatku") >= 0 ||
          m.indexOf("od poczƒÖtku") >= 0 ||
          m.indexOf("historia") >= 0
        )
          return c.fullStory;
        if (
          m.indexOf("termin") >= 0 ||
          m.indexOf("czas") >= 0 ||
          m.indexOf("kiedy") >= 0
        )
          return "Im szybciej tym lepiej... Ta sytuacja mnie wyka≈Ñcza psychicznie.";
        if (m.indexOf("?") >= 0)
          return (
            "Hmm, dobre pytanie. Powiem co wiem: " +
            c.fullStory.substring(0, 100) +
            "..."
          );
        return (
          "Rozumiem. Je≈õli potrzebujesz wiƒôcej screen√≥w - mam jeszcze " +
          (3 - (c.extraScreensSent || 0)) +
          ". Wystarczy napisaƒá!"
        );
      }
      document.getElementById("close-chat").onclick = function () {
        document.getElementById("client-chat").style.display = "none";
        chatCaseIdx = null;
      };
      var chatSendBtn = document.getElementById("chat-send");
      if (chatSendBtn) {
        chatSendBtn.onclick = chatSendBtn.ontouchend = function (e) {
          e.preventDefault();
          var txt = document.getElementById("chat-input").value.trim();
          if (!txt || chatCaseIdx === null) return;
          var c = G.activeCases[chatCaseIdx];
          if (!c.chatHistory) c.chatHistory = [];
          c.chatHistory.push({ from: "you", text: txt });
          document.getElementById("chat-input").value = "";
          renderChatMessages(c);
          setTimeout(function () {
            var resp = getClientResponse(c, txt);
            c.chatHistory.push({ from: "client", text: resp });
            renderChatMessages(c);
            saveGame();
          }, 1000 + Math.random() * 1000);
        };
      }
      var currentVisitor = null;
      var agreedPrice = 0;
      function negotiatePrice(offered) {
        if (!currentVisitor) return;
        var base = currentVisitor.fee;
        var max = Math.floor(base * 2.5);
        var min = Math.floor(base * 0.5);
        var resp = document.getElementById("price-response");
        var priceBtn = document.getElementById("agreed-price");
        var isMale =
          currentVisitor.avatar.indexOf("üë®") >= 0 ||
          currentVisitor.avatar.indexOf("üßë") >= 0;
        var honorific = isMale ? "Panie" : "Pani";
        if (offered <= 0 || isNaN(offered)) {
          resp.textContent = "Proszƒô wpisaƒá konkretnƒÖ kwotƒô.";
          resp.style.color = "#f90";
          return;
        }
        if (offered < min) {
          resp.textContent =
            '"' +
            honorific +
            ", to stanowczo za ma≈Ço. Nie mogƒô siƒô na to zgodziƒá. Minimum to " +
            min +
            'üí∞."';
          resp.style.color = "#f36";
          agreedPrice = 0;
          priceBtn.textContent = "---";
        } else if (offered <= base) {
          resp.textContent =
            '"Zgadzam siƒô na ' + offered + 'üí∞. To uczciwa cena."';
          resp.style.color = "#0f8";
          agreedPrice = offered;
          priceBtn.textContent = offered;
        } else if (offered <= Math.floor(base * 1.5)) {
          resp.textContent =
            '"Hmm... ' +
            offered +
            'üí∞ to trochƒô du≈ºo, ale zgoda. Zale≈ºy mi na rozwiƒÖzaniu sprawy."';
          resp.style.color = "#0f8";
          agreedPrice = offered;
          priceBtn.textContent = offered;
        } else if (offered <= max) {
          var chance = Math.random();
          if (chance > 0.4) {
            resp.textContent =
              '"' +
              offered +
              'üí∞? *westchnienie* No dobrze, zgadzam siƒô. Ale liczƒô na wyniki!"';
            resp.style.color = "#fc0";
            agreedPrice = offered;
            priceBtn.textContent = offered;
          } else {
            var counter = Math.floor(base * 1.3);
            resp.textContent =
              '"' +
              honorific +
              ", " +
              offered +
              "üí∞ to za du≈ºo. Mogƒô daƒá maksymalnie " +
              counter +
              'üí∞."';
            resp.style.color = "#f90";
            agreedPrice = counter;
            priceBtn.textContent = counter;
          }
        } else {
          resp.textContent =
            '"' +
            honorific +
            "! " +
            offered +
            'üí∞?! To jaki≈õ ≈ºart? Znajdƒô kogo≈õ innego!"';
          resp.style.color = "#f36";
          agreedPrice = 0;
          priceBtn.textContent = "---";
        }
      }
      function spawnVisitor() {
        if (currentVisitor) {
          document.getElementById("visitor").style.display = "flex";
          return;
        }
        var avail = CASES.filter(function (c) {
          return (
            !G.completed.find(function (x) {
              return x.id == c.id;
            }) &&
            !G.activeCases.find(function (x) {
              return x.id == c.id;
            })
          );
        });
        if (!avail.length) {
          notify("Brak", "Wszystkie sprawy!");
          return;
        }
        currentVisitor = avail[Math.floor(Math.random() * avail.length)];
        var c = currentVisitor;
        document.getElementById("v-avatar").textContent = c.avatar;
        document.getElementById("v-name").textContent = c.name;
        document.getElementById("v-fee").textContent = c.fee;
        document.getElementById("visitor-complaint").innerHTML =
          "<strong>" +
          c.type +
          "</strong><br><br>" +
          c.fullStory +
          '<br><br><em style="color:#0ff">Dow√≥d: ' +
          c.evidence[0].tp +
          ' - "' +
          c.evidence[0].txt +
          '"</em>';
        document.getElementById("v-deadline").textContent = c.days;
        document.getElementById("v-penalty").textContent = c.pen;
        document.getElementById("price-input").value = c.fee;
        document.getElementById("price-response").textContent = "";
        document.getElementById("agreed-price").textContent = c.fee;
        agreedPrice = c.fee;
        document.getElementById("visitor").style.display = "flex";
        document.getElementById("price-input").oninput = function () {
          negotiatePrice(parseInt(this.value) || 0);
        };
      }
      document.getElementById("btn-accept").onclick = function () {
        if (!currentVisitor || agreedPrice <= 0) return;
        var c = currentVisitor;
        var nc = JSON.parse(JSON.stringify(c));
        nc.startDay = G.day;
        nc.agreedFee = agreedPrice;
        nc.evidence[0].verified = false;
        nc.evidence[0].verdict = null;
        nc.evidence[0].img = genImg(nc.evidence[0]);
        nc.extraScreens = 0;
        nc.chatHistory = [];
        G.results[nc.id] = {};
        G.activeCases.push(nc);
        G.selectedCase = G.activeCases.length - 1;
        currentVisitor = null;
        agreedPrice = 0;
        document.getElementById("visitor").style.display = "none";
        updateHUD();
        saveGame();
        notify("Przyjƒôto!", "Zap≈Çata " + nc.agreedFee + "üí∞ po wykonaniu");
      };
      document.getElementById("btn-reject").onclick = function () {
        currentVisitor = null;
        agreedPrice = 0;
        document.getElementById("visitor").style.display = "none";
      };
      function finishCase(idx, to) {
        var c = G.activeCases[idx];
        // Mapowanie: kt√≥re sprawy idƒÖ gdzie (bez polskich znak√≥w!)
        var correctPlace = {
          GRO≈πBY: "Policja",
          STALKING: "Policja",
          HACKING: "Policja",
          OSZUSTWO: "Policja",
          SZANTA≈ª: "Policja",
          ZNIES≈ÅAWIENIE: "Sad",
          PODSZYWANIE: "Sad",
        };
        var shouldGo = correctPlace[c.type] || "Policja";
        if (to != shouldGo) {
          // Z≈Çe miejsce - kara i sprawa zostaje
          G.credits = Math.max(0, G.credits - 50);
          updateHUD();
          saveGame();
          document.getElementById("wrong-place-msg").textContent =
            "Ta sprawa (" +
            c.type +
            ") powinna trafiƒá do: " +
            (shouldGo == "Sad" ? "SƒÑDU" : "POLICJI") +
            "!";
          document.getElementById("wrong-place").style.display = "flex";
          return;
        }
        // Prawid≈Çowe miejsce - kontynuuj
        var cCopy = JSON.parse(JSON.stringify(c));
        var allCorrect = true;
        for (var i = 0; i < c.evidence.length; i++) {
          if (c.evidence[i].verdict != c.evidence[i].fake) allCorrect = false;
        }
        G.activeCases.splice(idx, 1);
        delete G.results[c.id];
        G.selectedCase = G.activeCases.length ? 0 : null;
        saveGame();
        exitPC();
        startScene(to, cCopy, allCorrect);
      }
      function showResult(correct, rew, to) {
        document.getElementById("result-icon").textContent = correct
          ? "‚úì"
          : "‚úó";
        document.getElementById("result-icon").style.color = correct
          ? "#0f8"
          : "#f36";
        document.getElementById("result-title").textContent = correct
          ? "SUKCES!"
          : "B≈ÅƒÑD!";
        document.getElementById("result-title").style.color = correct
          ? "#0f8"
          : "#f36";
        document.getElementById("result-msg").textContent = "‚Üí " + to;
        document.getElementById("result-reward").textContent =
          (rew >= 0 ? "+" : "") + rew + "üí∞";
        document.getElementById("result-reward").style.color =
          rew >= 0 ? "#fc0" : "#f36";
        document.getElementById("result").style.display = "flex";
      }
      document.getElementById("continue-btn").onclick = function () {
        document.getElementById("result").style.display = "none";
        G.day++;
        updateHUD();
        saveGame();
        renderPanel("case");
      };
      function initScene3D(type) {
        var canvas = document.getElementById("scene-canvas");
        sceneScene = new THREE.Scene();
        var isCourt = type == "Sad";
        // T≈Ço z gradientem
        sceneScene.background = new THREE.Color(isCourt ? 0x1a1208 : 0x0a1020);
        sceneScene.fog = new THREE.Fog(isCourt ? 0x1a1208 : 0x0a1020, 5, 25);
        sceneCamera = new THREE.PerspectiveCamera(
          60,
          innerWidth / (innerHeight * 0.45),
          0.1,
          100
        );
        sceneCamera.position.set(0, 1.6, 4);
        sceneRenderer = new THREE.WebGLRenderer({
          canvas: canvas,
          antialias: true,
        });
        sceneRenderer.setSize(innerWidth, innerHeight * 0.45);
        sceneRenderer.shadowMap.enabled = true;
        // ≈öwiat≈Ça
        sceneScene.add(
          new THREE.AmbientLight(isCourt ? 0xffd090 : 0x2040a0, 0.4)
        );
        var mainLight = new THREE.SpotLight(
          isCourt ? 0xffcc66 : 0x4080ff,
          1.5,
          30,
          Math.PI / 4,
          0.5
        );
        mainLight.position.set(0, 6, 2);
        mainLight.castShadow = true;
        sceneScene.add(mainLight);
        var fillLight = new THREE.PointLight(
          isCourt ? 0xff9933 : 0x3366ff,
          0.5,
          15
        );
        fillLight.position.set(-3, 3, 0);
        sceneScene.add(fillLight);
        var fillLight2 = new THREE.PointLight(
          isCourt ? 0xffaa44 : 0x4488ff,
          0.5,
          15
        );
        fillLight2.position.set(3, 3, 0);
        sceneScene.add(fillLight2);
        // Pod≈Çoga z teksturƒÖ
        var floorGeo = new THREE.PlaneGeometry(30, 30, 30, 30);
        var floorMat = new THREE.MeshStandardMaterial({
          color: isCourt ? 0x3a2815 : 0x151525,
          roughness: 0.8,
          metalness: 0.1,
        });
        var floor = new THREE.Mesh(floorGeo, floorMat);
        floor.rotation.x = -Math.PI / 2;
        floor.receiveShadow = true;
        sceneScene.add(floor);
        // ≈öciany
        var wallMat = new THREE.MeshStandardMaterial({
          color: isCourt ? 0x2a1a0a : 0x0a0a1a,
          roughness: 0.9,
        });
        var backWall = new THREE.Mesh(new THREE.PlaneGeometry(20, 8), wallMat);
        backWall.position.set(0, 4, -6);
        sceneScene.add(backWall);
        var leftWall = new THREE.Mesh(new THREE.PlaneGeometry(12, 8), wallMat);
        leftWall.position.set(-10, 4, 0);
        leftWall.rotation.y = Math.PI / 2;
        sceneScene.add(leftWall);
        var rightWall = new THREE.Mesh(new THREE.PlaneGeometry(12, 8), wallMat);
        rightWall.position.set(10, 4, 0);
        rightWall.rotation.y = -Math.PI / 2;
        sceneScene.add(rightWall);
        if (isCourt) {
          // SƒÑD - SZCZEG√ì≈ÅOWY
          // Podwy≈ºszenie sƒôdziego
          var platformMat = new THREE.MeshStandardMaterial({
            color: 0x4a2a10,
            roughness: 0.6,
          });
          var platform = new THREE.Mesh(
            new THREE.BoxGeometry(6, 0.6, 3),
            platformMat
          );
          platform.position.set(0, 0.3, -4);
          platform.castShadow = true;
          sceneScene.add(platform);
          // ≈Åawa sƒôdziowska
          var benchMat = new THREE.MeshStandardMaterial({
            color: 0x3a1a08,
            roughness: 0.5,
          });
          var bench = new THREE.Mesh(
            new THREE.BoxGeometry(5, 1.2, 0.8),
            benchMat
          );
          bench.position.set(0, 1.2, -4.5);
          bench.castShadow = true;
          sceneScene.add(bench);
          // Panel na ≈Çawie
          var panelMat = new THREE.MeshStandardMaterial({
            color: 0x2a0a00,
            roughness: 0.3,
          });
          var panel = new THREE.Mesh(
            new THREE.BoxGeometry(4.5, 0.8, 0.1),
            panelMat
          );
          panel.position.set(0, 1.5, -4.1);
          sceneScene.add(panel);
          // God≈Ço
          var emblemMat = new THREE.MeshStandardMaterial({
            color: 0xffd700,
            metalness: 0.8,
            roughness: 0.2,
            emissive: 0x332200,
          });
          var emblem = new THREE.Mesh(
            new THREE.CircleGeometry(0.6, 32),
            emblemMat
          );
          emblem.position.set(0, 3.5, -5.9);
          sceneScene.add(emblem);
          var emblemRing = new THREE.Mesh(
            new THREE.RingGeometry(0.55, 0.7, 32),
            new THREE.MeshStandardMaterial({ color: 0xcc9900, metalness: 0.9 })
          );
          emblemRing.position.set(0, 3.5, -5.85);
          sceneScene.add(emblemRing);
          // Flagi
          var flagPole1 = new THREE.Mesh(
            new THREE.CylinderGeometry(0.03, 0.03, 3),
            new THREE.MeshStandardMaterial({ color: 0x888888, metalness: 0.9 })
          );
          flagPole1.position.set(-2, 2.5, -5.5);
          sceneScene.add(flagPole1);
          var flag1 = new THREE.Mesh(
            new THREE.PlaneGeometry(0.8, 0.5),
            new THREE.MeshBasicMaterial({
              color: 0xdc143c,
              side: THREE.DoubleSide,
            })
          );
          flag1.position.set(-1.6, 3.5, -5.5);
          sceneScene.add(flag1);
          var flagPole2 = new THREE.Mesh(
            new THREE.CylinderGeometry(0.03, 0.03, 3),
            new THREE.MeshStandardMaterial({ color: 0x888888, metalness: 0.9 })
          );
          flagPole2.position.set(2, 2.5, -5.5);
          sceneScene.add(flagPole2);
          var flag2 = new THREE.Mesh(
            new THREE.PlaneGeometry(0.8, 0.5),
            new THREE.MeshBasicMaterial({
              color: 0xffffff,
              side: THREE.DoubleSide,
            })
          );
          flag2.position.set(1.6, 3.5, -5.5);
          sceneScene.add(flag2);
          // M≈Çotek sƒôdziowski
          var gavel = new THREE.Mesh(
            new THREE.CylinderGeometry(0.08, 0.08, 0.3),
            new THREE.MeshStandardMaterial({ color: 0x2a1500, roughness: 0.4 })
          );
          gavel.position.set(1.5, 1.85, -4.3);
          gavel.rotation.z = Math.PI / 2;
          sceneScene.add(gavel);
          var gavelHead = new THREE.Mesh(
            new THREE.CylinderGeometry(0.12, 0.12, 0.2),
            new THREE.MeshStandardMaterial({ color: 0x1a0a00, roughness: 0.3 })
          );
          gavelHead.position.set(1.65, 1.85, -4.3);
          sceneScene.add(gavelHead);
          // ≈Åawy dla publiczno≈õci
          for (var i = 0; i < 3; i++) {
            var pew = new THREE.Mesh(
              new THREE.BoxGeometry(3, 0.6, 0.5),
              new THREE.MeshStandardMaterial({ color: 0x3a2010 })
            );
            pew.position.set(-4 + i * 4, 0.3, 2);
            pew.castShadow = true;
            sceneScene.add(pew);
          }
          // ≈öwiece/lampy
          for (var i = 0; i < 4; i++) {
            var candleBase = new THREE.Mesh(
              new THREE.CylinderGeometry(0.1, 0.15, 0.3),
              new THREE.MeshStandardMaterial({
                color: 0x888844,
                metalness: 0.7,
              })
            );
            candleBase.position.set(-3 + i * 2, 2.5, -5.8);
            sceneScene.add(candleBase);
            var flame = new THREE.Mesh(
              new THREE.SphereGeometry(0.08),
              new THREE.MeshBasicMaterial({ color: 0xffaa00 })
            );
            flame.position.set(-3 + i * 2, 2.7, -5.8);
            sceneScene.add(flame);
          }
          // Okna
          for (var i = 0; i < 2; i++) {
            var windowFrame = new THREE.Mesh(
              new THREE.BoxGeometry(1.5, 2.5, 0.1),
              new THREE.MeshStandardMaterial({ color: 0x1a0a00 })
            );
            windowFrame.position.set(-5 + i * 10, 3, -5.9);
            sceneScene.add(windowFrame);
            var windowGlass = new THREE.Mesh(
              new THREE.PlaneGeometry(1.2, 2.2),
              new THREE.MeshBasicMaterial({
                color: 0x87ceeb,
                transparent: true,
                opacity: 0.3,
              })
            );
            windowGlass.position.set(-5 + i * 10, 3, -5.85);
            sceneScene.add(windowGlass);
          }
        } else {
          // POLICJA - SZCZEG√ì≈ÅOWA
          // Biurko g≈Ç√≥wne
          var deskMat = new THREE.MeshStandardMaterial({
            color: 0x2a3040,
            roughness: 0.6,
            metalness: 0.2,
          });
          var desk = new THREE.Mesh(new THREE.BoxGeometry(4, 0.8, 2), deskMat);
          desk.position.set(0, 0.4, -3);
          desk.castShadow = true;
          sceneScene.add(desk);
          // Blat biurka
          var deskTop = new THREE.Mesh(
            new THREE.BoxGeometry(4.2, 0.1, 2.2),
            new THREE.MeshStandardMaterial({ color: 0x3a4050, roughness: 0.4 })
          );
          deskTop.position.set(0, 0.85, -3);
          sceneScene.add(deskTop);
          // Monitor
          var monitorStand = new THREE.Mesh(
            new THREE.BoxGeometry(0.3, 0.4, 0.3),
            new THREE.MeshStandardMaterial({ color: 0x222222 })
          );
          monitorStand.position.set(-0.8, 1.05, -3.5);
          sceneScene.add(monitorStand);
          var monitor = new THREE.Mesh(
            new THREE.BoxGeometry(1.2, 0.8, 0.08),
            new THREE.MeshStandardMaterial({ color: 0x111111 })
          );
          monitor.position.set(-0.8, 1.65, -3.5);
          sceneScene.add(monitor);
          var screen = new THREE.Mesh(
            new THREE.PlaneGeometry(1.1, 0.7),
            new THREE.MeshBasicMaterial({ color: 0x003366 })
          );
          screen.position.set(-0.8, 1.65, -3.45);
          sceneScene.add(screen);
          // Klawiatura
          var keyboard = new THREE.Mesh(
            new THREE.BoxGeometry(0.6, 0.03, 0.2),
            new THREE.MeshStandardMaterial({ color: 0x222222 })
          );
          keyboard.position.set(-0.8, 0.87, -3);
          sceneScene.add(keyboard);
          // Lampa biurkowa
          var lampBase = new THREE.Mesh(
            new THREE.CylinderGeometry(0.15, 0.2, 0.1),
            new THREE.MeshStandardMaterial({ color: 0x333333, metalness: 0.8 })
          );
          lampBase.position.set(1.2, 0.9, -3.3);
          sceneScene.add(lampBase);
          var lampArm = new THREE.Mesh(
            new THREE.CylinderGeometry(0.02, 0.02, 0.6),
            new THREE.MeshStandardMaterial({ color: 0x444444, metalness: 0.9 })
          );
          lampArm.position.set(1.2, 1.2, -3.3);
          sceneScene.add(lampArm);
          var lampHead = new THREE.Mesh(
            new THREE.ConeGeometry(0.15, 0.2, 16),
            new THREE.MeshStandardMaterial({ color: 0x2266aa, metalness: 0.5 })
          );
          lampHead.position.set(1.2, 1.55, -3.3);
          lampHead.rotation.x = Math.PI;
          sceneScene.add(lampHead);
          var lampLight = new THREE.PointLight(0x4488ff, 0.8, 3);
          lampLight.position.set(1.2, 1.4, -3.3);
          sceneScene.add(lampLight);
          // Dokumenty na biurku
          var papers = new THREE.Mesh(
            new THREE.BoxGeometry(0.4, 0.02, 0.5),
            new THREE.MeshStandardMaterial({ color: 0xeeeeee })
          );
          papers.position.set(0.5, 0.87, -2.8);
          papers.rotation.y = 0.2;
          sceneScene.add(papers);
          // Kubek
          var mug = new THREE.Mesh(
            new THREE.CylinderGeometry(0.06, 0.05, 0.12),
            new THREE.MeshStandardMaterial({ color: 0x4444aa })
          );
          mug.position.set(1.5, 0.93, -2.7);
          sceneScene.add(mug);
          // Szafki na akta
          for (var i = 0; i < 3; i++) {
            var cabinet = new THREE.Mesh(
              new THREE.BoxGeometry(1, 2.5, 0.6),
              new THREE.MeshStandardMaterial({
                color: 0x3a3a4a,
                metalness: 0.3,
              })
            );
            cabinet.position.set(-4 + i * 0.5, 1.25, -5.5);
            cabinet.castShadow = true;
            sceneScene.add(cabinet);
            var handle = new THREE.Mesh(
              new THREE.BoxGeometry(0.3, 0.05, 0.05),
              new THREE.MeshStandardMaterial({
                color: 0x888888,
                metalness: 0.9,
              })
            );
            handle.position.set(-4 + i * 0.5, 1.5, -5.2);
            sceneScene.add(handle);
          }
          // Tablica korkowa
          var board = new THREE.Mesh(
            new THREE.BoxGeometry(2, 1.5, 0.1),
            new THREE.MeshStandardMaterial({ color: 0x8b6914 })
          );
          board.position.set(3, 2, -5.9);
          sceneScene.add(board);
          var boardFrame = new THREE.Mesh(
            new THREE.BoxGeometry(2.2, 1.7, 0.05),
            new THREE.MeshStandardMaterial({ color: 0x4a3010 })
          );
          boardFrame.position.set(3, 2, -5.95);
          sceneScene.add(boardFrame);
          // Pinezki na tablicy
          for (var i = 0; i < 5; i++) {
            var pin = new THREE.Mesh(
              new THREE.SphereGeometry(0.03),
              new THREE.MeshBasicMaterial({
                color: [0xff0000, 0x00ff00, 0x0000ff, 0xffff00, 0xff00ff][i],
              })
            );
            pin.position.set(
              2.5 + Math.random() * 1,
              1.5 + Math.random() * 0.8,
              -5.85
            );
            sceneScene.add(pin);
          }
          // Krzes≈Ço dla go≈õcia
          var chairSeat = new THREE.Mesh(
            new THREE.BoxGeometry(0.6, 0.08, 0.6),
            new THREE.MeshStandardMaterial({ color: 0x333344 })
          );
          chairSeat.position.set(0, 0.5, 0);
          sceneScene.add(chairSeat);
          var chairBack = new THREE.Mesh(
            new THREE.BoxGeometry(0.6, 0.8, 0.08),
            new THREE.MeshStandardMaterial({ color: 0x333344 })
          );
          chairBack.position.set(0, 0.9, -0.25);
          sceneScene.add(chairBack);
          for (var i = 0; i < 4; i++) {
            var leg = new THREE.Mesh(
              new THREE.CylinderGeometry(0.03, 0.03, 0.5),
              new THREE.MeshStandardMaterial({
                color: 0x666666,
                metalness: 0.8,
              })
            );
            leg.position.set(
              -0.2 + Math.floor(i / 2) * 0.4,
              0.25,
              -0.2 + (i % 2) * 0.4
            );
            sceneScene.add(leg);
          }
          // Logo policji na ≈õcianie
          var logoBack = new THREE.Mesh(
            new THREE.CircleGeometry(0.8, 32),
            new THREE.MeshStandardMaterial({ color: 0x000066 })
          );
          logoBack.position.set(0, 3, -5.9);
          sceneScene.add(logoBack);
          var logoStar = new THREE.Mesh(
            new THREE.CircleGeometry(0.5, 6),
            new THREE.MeshStandardMaterial({ color: 0xffd700, metalness: 0.7 })
          );
          logoStar.position.set(0, 3, -5.85);
          sceneScene.add(logoStar);
          // Zegar
          var clockFace = new THREE.Mesh(
            new THREE.CircleGeometry(0.4, 32),
            new THREE.MeshStandardMaterial({ color: 0xffffff })
          );
          clockFace.position.set(-3, 3, -5.9);
          sceneScene.add(clockFace);
          var clockFrame = new THREE.Mesh(
            new THREE.RingGeometry(0.38, 0.45, 32),
            new THREE.MeshStandardMaterial({ color: 0x222222 })
          );
          clockFrame.position.set(-3, 3, -5.88);
          sceneScene.add(clockFrame);
        }
        // Obs≈Çuga dotyku i myszy
        var stx = 0,
          sty = 0;
        canvas.ontouchstart = function (e) {
          stx = e.touches[0].clientX;
          sty = e.touches[0].clientY;
        };
        canvas.ontouchmove = function (e) {
          sceneRotY -= (e.touches[0].clientX - stx) * 0.005;
          sceneRotX = Math.max(
            -0.5,
            Math.min(0.5, sceneRotX - (e.touches[0].clientY - sty) * 0.005)
          );
          stx = e.touches[0].clientX;
          sty = e.touches[0].clientY;
        };
        canvas.onmousemove = function (e) {
          if (e.buttons) {
            sceneRotY -= e.movementX * 0.003;
            sceneRotX = Math.max(
              -0.5,
              Math.min(0.5, sceneRotX - e.movementY * 0.003)
            );
          }
        };
        animateScene();
      }
      function animateScene() {
        if (document.getElementById("scene-overlay").style.display != "flex")
          return;
        requestAnimationFrame(animateScene);
        sceneCamera.rotation.order = "YXZ";
        sceneCamera.rotation.y = sceneRotY;
        sceneCamera.rotation.x = sceneRotX;
        sceneRenderer.render(sceneScene, sceneCamera);
      }
      function startScene(type, caseData, correct) {
        sceneData = {
          type: type,
          caseData: caseData,
          correct: correct,
          phase: 0,
          allTexts: "",
        };
        sceneRotY = 0;
        sceneRotX = 0;
        document.getElementById("scene-overlay").style.display = "flex";
        document.getElementById("scene-result").style.display = "none";
        document.getElementById("scene-dialogue").style.display = "block";
        initScene3D(type);
        animateScene();
        runScenePhase();
      }
      function analyzePlayerText(txt) {
        var score = 0;
        var result = {};
        var kw = {
          evidence: [
            "dowod",
            "screen",
            "zrzut",
            "nagranie",
            "mail",
            "wiadomo",
            "sms",
            "foto",
            "zdjƒôci",
            "plik",
            "dokument",
            "wyciƒÖg",
            "log",
            "historia",
            "backup",
          ],
          technical: [
            "metadan",
            "analiz",
            "exif",
            "ip",
            "adres",
            "lokalizacj",
            "timestamp",
            "hash",
            "sygnatur",
            "photoshop",
            "edycj",
            "manipulacj",
            "fa≈Çsz",
          ],
          professional: [
            "wysoki sƒÖdzie",
            "panie oficerze",
            "pani oficer",
            "przedstawiam",
            "wnoszƒô",
            "o≈õwiadczam",
            "zeznaj",
            "potwierdzam",
          ],
          uncertain: [
            "nie wiem",
            "mo≈ºe",
            "chyba",
            "wydaje mi siƒô",
            "nie jestem pewien",
            "trudno powiedzieƒá",
            "mo≈ºliwe",
            "prawdopodobnie",
            "nie pamiƒôtam",
          ],
          aggressive: [
            "k≈Çam",
            "oszust",
            "przestƒôpc",
            "bandyt",
            "z≈Çodziej",
            "≈õwinia",
            "idiota",
            "g≈Çupi",
          ],
          urgent: [
            "pilne",
            "szybko",
            "natychmiast",
            "teraz",
            "zaraz",
            "niebezpiecz",
            "grozi",
            "≈ºyci",
            "zdrowi",
            "przemoc",
          ],
          suspect: [
            "znam",
            "wiem kto",
            "to jest",
            "nazwisko",
            "adres",
            "mieszka",
            "pracuje",
            "numer",
            "telefon",
            "profil",
          ],
          victim: [
            "ofiara",
            "pokrzywdzon",
            "bezpiecz",
            "strach",
            "boi siƒô",
            "ukrywa",
            "chroni",
            "pomoc",
          ],
          weak: [
            "tylko",
            "trochƒô",
            "niewiele",
            "ma≈Ço",
            "sam",
            "jeden",
            "mo≈ºe byƒá",
          ],
          strong: [
            "pewny",
            "na pewno",
            "jednoznaczn",
            "bezsprzeczn",
            "niezbity",
            "oczywist",
            "ewidentn",
          ],
          legal: [
            "paragraf",
            "artyku≈Ç",
            "kodeks",
            "ustawa",
            "prawo",
            "przepis",
            "sankcj",
          ],
          emotional: [
            "proszƒô",
            "b≈Çagam",
            "pom√≥≈º",
            "ratuj",
            "straszn",
            "okropn",
            "koszmar",
          ],
        };
        for (var cat in kw) {
          result[cat] = 0;
          for (var i = 0; i < kw[cat].length; i++) {
            if (txt.indexOf(kw[cat][i]) >= 0) {
              result[cat]++;
              score +=
                cat == "uncertain" || cat == "weak" || cat == "aggressive"
                  ? -2
                  : 2;
            }
          }
        }
        result.score = score;
        result.hasEvidence = result.evidence > 0 || result.technical > 0;
        result.isPro = result.professional > 0;
        result.isUnsure = result.uncertain > 0 || result.weak > 1;
        result.isAggressive = result.aggressive > 0;
        result.isUrgent = result.urgent > 0;
        result.knowsSuspect = result.suspect > 0;
        result.victimDanger = result.urgent > 0 && result.victim > 0;
        result.isStrong = result.strong > 0 && result.evidence > 1;
        result.isEmotional = result.emotional > 0;
        result.isLegal = result.legal > 0;
        result.length = txt.length;
        return result;
      }

      function getDefResp(a, txt) {
        if (a.isUnsure && a.length < 50)
          return "Wysoki SƒÖdzie! To jest ≈ºart? Oskar≈ºyciel sam przyznaje ≈ºe nie jest pewien i nie potrafi nawet sensownie opisaƒá sprawy! ≈ªƒÖdam natychmiastowego uniewinnienia!";
        if (a.isUnsure)
          return 'Wysoki SƒÖdzie! S≈Çyszeli≈õcie te wahania? "Mo≈ºe", "chyba"... To nie sƒÖ s≈Çowa kogo≈õ kto ma twarde dowody!';
        if (a.isAggressive)
          return "Sprzeciw! Oskar≈ºyciel zamiast fakt√≥w rzuca obelgi! To ≈õwiadczy o braku argument√≥w! Proszƒô o upomnienie!";
        if (a.isEmotional && !a.hasEvidence)
          return "Wysoki SƒÖdzie, widzƒô tu du≈ºo emocji, ale zero konkretnych dowod√≥w. Emocje to nie dowody!";
        if (txt.indexOf("photoshop") >= 0 || txt.indexOf("edyt") >= 0)
          return 'Oskar≈ºyciel twierdzi ≈ºe wykry≈Ç edycjƒô? A mo≈ºe to ON sfabrykowa≈Ç te tak zwane "dowody"? Ka≈ºdy mo≈ºe co≈õ napisaƒá!';
        if (txt.indexOf("metadan") >= 0)
          return "Metadane? Wysoki SƒÖdzie, ka≈ºdy nastolatek umie zmieniƒá metadane pliku! To ≈ºaden dow√≥d!";
        if (a.technical > 2 && a.evidence > 1)
          return "Te... te techniczne bzdury... Wysoki SƒÖdzie, wnoszƒô o powo≈Çanie NIEZALE≈ªNEGO bieg≈Çego! Nie mo≈ºemy ufaƒá analizom oskar≈ºyciela!";
        if (a.isStrong)
          return "Mimo pewno≈õci siebie oskar≈ºyciela, wciƒÖ≈º nie widzƒô NIEBITYCH dowod√≥w! M√≥j klient jest niewinny!";
        if (a.hasEvidence)
          return 'Te tak zwane "dowody" mog≈Çy zostaƒá sfabrykowane! W dobie AI wszystko mo≈ºna podrobiƒá! To nic nie dowodzi!';
        if (a.isLegal)
          return "Oskar≈ºyciel cytuje paragrafy, ale czy naprawdƒô rozumie prawo? Interpretacja jest wysoce wƒÖtpliwa!";
        if (a.length < 30)
          return "To wszystko? TAK KR√ìTKA wypowied≈∫ ma byƒá oskar≈ºeniem? ≈ömieszne! ≈ªƒÖdam uniewinnienia!";
        return "Wysoki SƒÖdzie, oskar≈ºyciel nie przedstawi≈Ç ≈ºadnych konkretnych, niepodwa≈ºalnych dowod√≥w! ≈ªƒÖdam uniewinnienia mojego klienta!";
      }

      function getJudgeResp(a, txt) {
        if (a.isAggressive)
          return "Proszƒô o spok√≥j i powagƒô! To jest sala sƒÖdowa. Nastƒôpne takie zachowanie sko≈Ñczy siƒô karƒÖ porzƒÖdkowƒÖ. Proszƒô trzymaƒá siƒô fakt√≥w.";
        if (a.isUnsure && a.length < 50)
          return "Panie oskar≈ºycielu, Pana wypowied≈∫ jest bardzo niepewna i kr√≥tka. Czy jest Pan przygotowany do tej rozprawy?";
        if (a.isUnsure)
          return "S≈Çyszƒô w Pana s≈Çowach niepewno≈õƒá. SƒÖd potrzebuje PEWNO≈öCI, nie domys≈Ç√≥w. Czy ma Pan twarde dowody?";
        if (a.isEmotional && !a.hasEvidence)
          return "Rozumiem emocje, ale sƒÖd opiera siƒô na faktach i dowodach, nie na uczuciach. Proszƒô o konkrety.";
        if (a.isPro && a.isStrong)
          return "Dziƒôkujƒô za profesjonalne i pewne przedstawienie sprawy. SƒÖd we≈∫mie pod uwagƒô przedstawione argumenty.";
        if (a.isPro && a.hasEvidence)
          return "Dziƒôkujƒô. Widzƒô ≈ºe jest Pan przygotowany. Proszƒô kontynuowaƒá.";
        if (a.technical > 2)
          return "Rozumiem ≈ºe sprawa ma aspekt techniczny. Czy te analizy by≈Çy przeprowadzone zgodnie ze standardami?";
        if (a.hasEvidence && !a.isUnsure)
          return "Dobrze, mamy wiƒôc jakie≈õ dowody. SƒÖd je rozpatrzy.";
        if (a.isLegal)
          return "Widzƒô ≈ºe zna Pan przepisy. Proszƒô jednak pamiƒôtaƒá ≈ºe interpretacja prawa nale≈ºy do sƒÖdu.";
        if (a.length > 200 && a.hasEvidence)
          return "Dziƒôkujƒô za szczeg√≥≈Çowe wyja≈õnienie. SƒÖd ma teraz pe≈Çniejszy obraz sprawy.";
        if (a.length < 30)
          return "To bardzo kr√≥tka wypowied≈∫. Czy nie ma Pan nic wiƒôcej do dodania?";
        return "Rozumiem. Proszƒô kontynuowaƒá i przedstawiƒá wiƒôcej szczeg√≥≈Ç√≥w.";
      }

      function getPolResp(a, txt) {
        if (a.isAggressive)
          return "Proszƒô siƒô uspokoiƒá. Rozumiem ≈ºe jest Pan zdenerwowany, ale potrzebujƒô konkretnych informacji, nie emocji.";
        if (a.isUnsure && a.length < 50)
          return "Hmm, nie brzmi to przekonujƒÖco. Potrzebujƒô konkret√≥w ≈ºeby podjƒÖƒá dzia≈Çania. Kto, co, kiedy, gdzie?";
        if (a.isUnsure)
          return 'S≈Çyszƒô du≈ºo niepewno≈õci. Trudno mi dzia≈Çaƒá na podstawie "mo≈ºe" i "chyba". Ma Pan co≈õ konkretnego?';
        if (a.isUrgent && a.victimDanger)
          return "Rozumiem ≈ºe sytuacja jest powa≈ºna. Natychmiast wy≈õlƒô patrol do ofiary. Proszƒô kontynuowaƒá zg≈Çoszenie.";
        if (a.isUrgent)
          return "OK, widzƒô ≈ºe sprawa jest pilna. Proszƒô szybko podaƒá najwa≈ºniejsze fakty.";
        if (a.isPro && a.hasEvidence)
          return "Dobrze, widzƒô ≈ºe jest Pan przygotowany i ma dowody. To u≈Çatwi sprawƒô.";
        if (a.hasEvidence && a.technical > 1)
          return "O, ma Pan analizy techniczne? To mo≈ºe byƒá kluczowe. Zabezpieczymy te materia≈Çy.";
        if (a.hasEvidence)
          return "Dobrze, mamy jakie≈õ dowody. Screeny, nagrania - to podstawa do dzia≈Çania.";
        if (a.knowsSuspect)
          return "Zna Pan podejrzanego? To bardzo wa≈ºne. Proszƒô podaƒá wszystkie szczeg√≥≈Çy.";
        if (a.isEmotional)
          return "Rozumiem ≈ºe to trudna sytuacja. Proszƒô siƒô uspokoiƒá i podaƒá mi fakty po kolei.";
        if (a.length > 200)
          return "OK, mam sporo informacji. Zaczynam rozumieƒá sytuacjƒô.";
        if (a.length < 30)
          return "To trochƒô ma≈Ço. Potrzebujƒô wiƒôcej szczeg√≥≈Ç√≥w ≈ºeby podjƒÖƒá dzia≈Çania.";
        return "Rozumiem. Proszƒô kontynuowaƒá - potrzebujƒô pe≈Çnego obrazu sytuacji.";
      }

      function getSceneOutcome(d) {
        var txt = d.allTexts ? d.allTexts.toLowerCase() : "";
        var c = d.caseData;
        var keywordsFound = 0;
        if (c.keywords) {
          for (var i = 0; i < c.keywords.length; i++) {
            if (txt.indexOf(c.keywords[i]) >= 0) keywordsFound++;
          }
        }
        var keywordScore =
          keywordsFound / Math.max(1, c.keywords ? c.keywords.length : 1);
        var isEmpty = txt.length < 30;
        var mentionedEvidence =
          txt.indexOf("dowod") >= 0 ||
          txt.indexOf("screen") >= 0 ||
          txt.indexOf("analiz") >= 0 ||
          txt.indexOf("metadan") >= 0;

        var playerVerdict = c.evidence[0].verdict;
        var realFake = c.evidence[0].fake;
        var wasCorrect = playerVerdict == realFake;

        var saidFake =
          txt.indexOf("fa≈Çsz") >= 0 ||
          txt.indexOf("fake") >= 0 ||
          txt.indexOf("podrobion") >= 0 ||
          txt.indexOf("sfa≈Çsz") >= 0 ||
          txt.indexOf("zmodyf") >= 0 ||
          txt.indexOf("edytow") >= 0;
        var saidReal =
          txt.indexOf("prawdzi") >= 0 ||
          txt.indexOf("autentycz") >= 0 ||
          txt.indexOf("oryginal") >= 0 ||
          txt.indexOf("prawda") >= 0;

        var speechMatchesVerdict =
          (playerVerdict && saidFake) || (!playerVerdict && saidReal);
        var speechContradicts =
          (playerVerdict && saidReal) || (!playerVerdict && saidFake);

        var accusedClient =
          txt.indexOf("klient") >= 0 &&
          (txt.indexOf("k≈Çam") >= 0 ||
            txt.indexOf("sfa≈Çsz") >= 0 ||
            txt.indexOf("oszuk") >= 0 ||
            txt.indexOf("winn") >= 0);
        accusedClient =
          accusedClient ||
          (txt.indexOf(c.name.split(" ")[0].toLowerCase()) >= 0 &&
            (txt.indexOf("k≈Çam") >= 0 ||
              txt.indexOf("sfa≈Çsz") >= 0 ||
              txt.indexOf("winn") >= 0));

        if (isEmpty)
          return {
            type: "dismissed",
            msg: "Nie przedstawiono ≈ºadnych argument√≥w.",
            rew: 0,
          };

        if (speechContradicts) {
          return {
            type: "contradiction",
            msg:
              "SPRZECZNO≈öƒÜ! Zaznaczy≈Çe≈õ ≈ºe dow√≥d jest " +
              (playerVerdict ? "FA≈ÅSZYWY" : "PRAWDZIWY") +
              " ale m√≥wisz ≈ºe jest " +
              (saidFake ? "fa≈Çszywy" : "prawdziwy") +
              "!",
            rew: -Math.floor(c.fine * 0.5),
          };
        }

        if (c.clientLies) {
          if (accusedClient && realFake) {
            return {
              type: "client_guilty",
              msg:
                "BRAWO! Wykry≈Çe≈õ ≈ºe to KLIENT sfa≈Çszowa≈Ç dowody! " +
                c.name +
                " pr√≥bowa≈Ç wrobiƒá niewinnƒÖ osobƒô!",
              rew: Math.floor(c.rew * 2),
            };
          }
          if (!accusedClient && wasCorrect) {
            return {
              type: "partial",
              msg: "Dow√≥d jest fa≈Çszywy, ale nie wskaza≈Çe≈õ prawdziwego winnego - KLIENTA!",
              rew: Math.floor(c.rew * 0.3),
            };
          }
          if (!wasCorrect) {
            return {
              type: "wrong",
              msg: "B≈Çƒôdna analiza. Dow√≥d by≈Ç sfa≈Çszowany przez klienta!",
              rew: -c.fine,
            };
          }
        }

        if (accusedClient && !c.clientLies) {
          return {
            type: "wrong_accusation",
            msg: "Oskar≈ºy≈Çe≈õ klienta kt√≥ry m√≥wi≈Ç prawdƒô! To pomy≈Çka!",
            rew: -c.fine,
          };
        }

        var wrongAccusation =
          !wasCorrect &&
          !c.clientLies &&
          (txt.indexOf("winn") >= 0 ||
            txt.indexOf("skazaƒá") >= 0 ||
            txt.indexOf("aresztowaƒá") >= 0);
        if (wrongAccusation)
          return {
            type: "suspend",
            msg: "Fa≈Çszywe oskar≈ºenie niewinnej osoby!",
            rew: 0,
          };

        if (wasCorrect) {
          if (speechMatchesVerdict && keywordScore > 0.4 && mentionedEvidence)
            return {
              type: "full_win",
              msg: "Doskona≈Çe! Analiza poprawna, zeznania sp√≥jne, argumenty mocne!",
              rew: Math.floor(c.rew * 1.5),
            };
          if (speechMatchesVerdict && keywordScore > 0.25)
            return {
              type: "win",
              msg: "Sprawa udowodniona. Zeznania zgodne z analizƒÖ.",
              rew: c.rew,
            };
          if (keywordScore > 0.2)
            return {
              type: "partial",
              msg: "Analiza poprawna ale s≈Çabe argumenty w zeznaniach.",
              rew: Math.floor(c.rew * 0.5),
            };
          if (mentionedEvidence)
            return {
              type: "weak_win",
              msg: "Tylko dowody uratowa≈Çy sprawƒô.",
              rew: Math.floor(c.rew * 0.3),
            };
          return {
            type: "dismissed",
            msg: "Brak konkret√≥w mimo poprawnej analizy.",
            rew: 0,
          };
        } else {
          if (keywordScore > 0.3)
            return {
              type: "fine",
              msg: "Zna≈Çe≈õ fakty ale ≈∫le oceni≈Çe≈õ dowody!",
              rew: -c.fine,
            };
          return {
            type: "lose",
            msg: "B≈Çƒôdna analiza dowod√≥w.",
            rew: -Math.floor(c.fine * 0.5),
          };
        }
      }
      function runScenePhase() {
        var d = sceneData,
          sp = document.getElementById("scene-speaker"),
          tx = document.getElementById("scene-text"),
          inp = document.getElementById("scene-input"),
          opts = document.getElementById("scene-options");
        inp.style.display = "none";
        opts.style.display = "none";
        var c = d.caseData;
        var txt = d.allTexts ? d.allTexts.toLowerCase() : "";
        var lastTxt = d.lastAnswer ? d.lastAnswer.toLowerCase() : "";

        // S≈ÅOWA KLUCZOWE W KONTEK≈öCIE - per typ sprawy
        var contextKeywords = {
          GRO≈πBY: [
            "gro≈∫b",
            "grozi",
            "zastrasz",
            "zabij",
            "pobij",
            "atak",
            "strach",
            "boj",
            "niebezp",
            "przem",
            "zagro≈ºen",
            "≈õmier",
            "krzywda",
            "rodzin",
          ],
          STALKING: [
            "≈õledzeni",
            "obserwuj",
            "stalking",
            "≈õledzi",
            "nachodzi",
            "czatuj",
            "nƒôkani",
            "kontroluj",
            "prze≈õladuj",
            "obsesj",
            "dzwoni",
            "wiadomo",
          ],
          HACKING: [
            "w≈Çaman",
            "hack",
            "has≈Ço",
            "konto",
            "phishing",
            "link",
            "malware",
            "wirus",
            "dostƒôp",
            "logowani",
            "danych",
            "kradzie",
            "cyberprzestƒôp",
            "serwer",
          ],
          OSZUSTWO: [
            "oszust",
            "pieniƒÖd",
            "przelew",
            "p≈Çatno",
            "konto",
            "bank",
            "fa≈Çszyw",
            "wy≈Çudz",
            "kradzie≈º",
            "pieniƒôd",
            "strat",
            "ofiara",
            "scam",
          ],
          ZNIES≈ÅAWIENIE: [
            "znies≈Çawi",
            "pom√≥wi",
            "k≈Çamstw",
            "reputacj",
            "opini",
            "fa≈Çszyw",
            "oskar≈ºeni",
            "zarzut",
            "publiczn",
            "media",
            "post",
            "komentarz",
          ],
          PODSZYWANIE: [
            "podszyw",
            "fa≈Çszyw",
            "profil",
            "to≈ºsam",
            "konto",
            "udawa",
            "imitacj",
            "fake",
            "imperson",
            "kradzie≈º",
            "wizerun",
          ],
          SZANTA≈ª: [
            "szanta≈º",
            "gro≈∫b",
            "ujawni",
            "zdjƒôci",
            "nagra",
            "pieniƒÖd",
            "≈ºƒÖda",
            "zap≈Çat",
            "sekret",
            "kompromit",
            "wyciek",
          ],
        };
        var typeKw = contextKeywords[c.type] || [];

        // Sprawd≈∫ ile s≈Ç√≥w kluczowych z kontekstu u≈ºy≈Ç gracz
        var foundContext = 0;
        for (var i = 0; i < typeKw.length; i++) {
          if (txt.indexOf(typeKw[i]) >= 0) foundContext++;
        }
        // Sprawd≈∫ te≈º s≈Çowa kluczowe z samej sprawy
        var foundCase = 0;
        if (c.keywords) {
          for (var i = 0; i < c.keywords.length; i++) {
            if (txt.indexOf(c.keywords[i]) >= 0) foundCase++;
          }
        }

        var mentionedSuspect =
          c.suspect && txt.indexOf(c.suspect.split(" ")[0].toLowerCase()) >= 0;
        var mentionedEvidence =
          txt.indexOf("dowod") >= 0 ||
          txt.indexOf("screen") >= 0 ||
          txt.indexOf("analiz") >= 0 ||
          txt.indexOf("mail") >= 0 ||
          txt.indexOf("sms") >= 0 ||
          txt.indexOf("zdjƒôci") >= 0;
        var mentionedDetails =
          txt.indexOf("szczeg√≥≈Ç") >= 0 ||
          txt.indexOf("dok≈Çadni") >= 0 ||
          foundCase > 2 ||
          foundContext > 2;
        var playerVerdict = c.evidence[0].verdict;
        var verdictWord = playerVerdict ? "FA≈ÅSZYWY" : "PRAWDZIWY";

        // WYKRYWANIE CZY GRACZ M√ìWI O FA≈ÅSZYWYCH DOWODACH czy o czym≈õ innym
        function saidVerdictFake() {
          var fakePatterns = [
            "dowod.*fa≈Çsz",
            "fa≈Çszyw.*dowod",
            "screen.*sfa≈Çsz",
            "sfa≈Çszow",
            "fabryko",
            "podrobion.*dowod",
            "zmanipulow",
            "dowod.*nieprawdzi",
            "analiza.*fa≈Çsz",
            "to fake",
            "to podr√≥bka",
            "klient.*sk≈Çama≈Ç",
            "klient.*fa≈Çsz",
          ];
          for (var i = 0; i < fakePatterns.length; i++) {
            if (txt.match(new RegExp(fakePatterns[i]))) return true;
          }
          // Ale NIE je≈õli m√≥wi o "fa≈Çszywym linku", "fa≈Çszywej stronie" itp.
          var falsePositives = [
            "fa≈Çszyw.*link",
            "fa≈Çszyw.*stron",
            "fa≈Çszyw.*mail",
            "fa≈Çszyw.*kont",
            "fa≈Çszyw.*profil",
            "fa≈Çszyw.*wiadomo",
          ];
          var hasFalsePositive = false;
          for (var i = 0; i < falsePositives.length; i++) {
            if (lastTxt.match(new RegExp(falsePositives[i])))
              hasFalsePositive = true;
          }
          if (
            hasFalsePositive &&
            !lastTxt.match(/dowod.*fa≈Çsz|fa≈Çsz.*dowod|screen.*fa≈Çsz/)
          )
            return false;
          return (
            txt.indexOf("fa≈Çsz") >= 0 &&
            (txt.indexOf("dowod") >= 0 || txt.indexOf("screen") >= 0)
          );
        }
        function saidVerdictReal() {
          var realPatterns = [
            "dowod.*prawdzi",
            "prawdzi.*dowod",
            "autentyczn",
            "oryginaln",
            "screen.*prawdzi",
            "analiza.*potwierdz",
            "dowod.*ok",
            "wiarygod",
          ];
          for (var i = 0; i < realPatterns.length; i++) {
            if (txt.match(new RegExp(realPatterns[i]))) return true;
          }
          return (
            txt.indexOf("prawdzi") >= 0 &&
            (txt.indexOf("dowod") >= 0 || txt.indexOf("screen") >= 0)
          );
        }

        // DYNAMICZNE PYTANIA per typ sprawy
        var typeQuestions = {
          GRO≈πBY: {
            q1: [
              "Jakie gro≈∫by otrzyma≈Ça ofiara?",
              "Co dok≈Çadnie napisa≈Ç sprawca?",
              "Jak grozi≈Ç?",
            ],
            q2: [
              "Czy ofiara jest teraz bezpieczna?",
              "Czy sprawca wie gdzie mieszka ofiara?",
              "Jak czƒôsto przychodzƒÖ gro≈∫by?",
            ],
            q3: [
              "Czy zg≈Çoszono to wcze≈õniej?",
              "Czy sƒÖ ≈õwiadkowie?",
              "Jak d≈Çugo to trwa?",
            ],
          },
          STALKING: {
            q1: [
              "Jak d≈Çugo trwa to nƒôkanie?",
              "W jaki spos√≥b sprawca ≈õledzi ofiarƒô?",
              "Ile wiadomo≈õci dziennie?",
            ],
            q2: [
              "Czy sprawca zna miejsce zamieszkania ofiary?",
              "Czy ofiara czuje siƒô zagro≈ºona?",
              "Czy by≈Çy pr√≥by kontaktu osobistego?",
            ],
            q3: [
              "Czy sprawca grozi≈Ç przemocƒÖ?",
              "Czy ofiara zmienia≈Ça numery/konta?",
              "Czy sƒÖ inne ofiary?",
            ],
          },
          HACKING: {
            q1: [
              "Jak dosz≈Ço do w≈Çamania?",
              "Czy klika≈Ç w jakie≈õ podejrzane linki?",
              "Co zosta≈Ço skradzione?",
            ],
            q2: [
              "Czy zmieniono has≈Ça po incydencie?",
              "SkƒÖd by≈Ço logowanie - z jakiego IP?",
              "Jakie straty finansowe?",
            ],
            q3: [
              "Czy bank zosta≈Ç powiadomiony?",
              "Czy sƒÖ inne konta zagro≈ºone?",
              "Czy zachowa≈Ç maile phishingowe?",
            ],
          },
          OSZUSTWO: {
            q1: [
              "Na jakƒÖ kwotƒô by≈Ço oszustwo?",
              "Jak oszust nawiƒÖza≈Ç kontakt?",
              "Co obieca≈Ç sprawca?",
            ],
            q2: [
              "Czy pieniƒÖdze mo≈ºna odzyskaƒá?",
              "Czy sƒÖ dane sprawcy?",
              "Jak dokonano p≈Çatno≈õci?",
            ],
            q3: [
              "Czy sƒÖ inni poszkodowani?",
              "Czy sprawca nadal jest aktywny?",
              "Czy bank by≈Ç powiadomiony?",
            ],
          },
          ZNIES≈ÅAWIENIE: {
            q1: [
              "Co dok≈Çadnie napisano o kliencie?",
              "Gdzie opublikowano te tre≈õci?",
              "Ile os√≥b to widzia≈Ço?",
            ],
            q2: [
              "Czy to wp≈Çynƒô≈Ço na reputacjƒô zawodowƒÖ?",
              "Czy autor siƒô podpisa≈Ç?",
              "Czy tre≈õci zosta≈Çy usuniƒôte?",
            ],
            q3: [
              "Czy klient ≈ºƒÖda przeprosin czy odszkodowania?",
              "Czy sƒÖ ≈õwiadkowie szkody?",
              "Jak d≈Çugo tre≈õci by≈Çy widoczne?",
            ],
          },
          PODSZYWANIE: {
            q1: [
              "Pod kogo siƒô podszywano?",
              "Na jakiej platformie?",
              "Co robi≈Ç fa≈Çszywy profil?",
            ],
            q2: [
              "Czy oszukano jakie≈õ osoby trzecie?",
              "Czy wy≈Çudzono pieniƒÖdze?",
              "Czy profil zosta≈Ç zg≈Çoszony?",
            ],
            q3: [
              "Czy sƒÖ podejrzenia kto to zrobi≈Ç?",
              "Jak d≈Çugo profil istnia≈Ç?",
              "Czy platforma reagowa≈Ça?",
            ],
          },
          SZANTA≈ª: {
            q1: [
              "Czym szanta≈ºuje sprawca?",
              "Jakiej kwoty ≈ºƒÖda?",
              "Jakie materia≈Çy posiada?",
            ],
            q2: [
              "Czy ofiara zap≈Çaci≈Ça ju≈º cokolwiek?",
              "SkƒÖd sprawca ma te materia≈Çy?",
              "Czy grozi≈Ç publikacjƒÖ?",
            ],
            q3: [
              "Czy kto≈õ jeszcze wie o szanta≈ºu?",
              "Czy materia≈Çy sƒÖ prawdziwe?",
              "Czy by≈Ç kontakt z policjƒÖ?",
            ],
          },
        };
        var tq = typeQuestions[c.type] || {
          q1: ["Co siƒô sta≈Ço?"],
          q2: ["Kto jest podejrzany?"],
          q3: ["Jakie masz dowody?"],
        };
        function pickQ(arr) {
          return arr[Math.floor(Math.random() * arr.length)];
        }

        // FAZY - r√≥≈ºne dla sƒÖdu i policji
        if (d.type == "Sad") {
          // Generuj fazy dynamicznie
          if (!d.phases) {
            d.phases = [
              {
                who: "judge",
                icon: "‚öñÔ∏è SƒòDZIA",
                say:
                  "Rozprawa w sprawie " +
                  c.name +
                  ". Zarzut: " +
                  c.type +
                  ". Oskar≈ºycielu, proszƒô przedstawiƒá sprawƒô.",
              },
              {
                who: "you",
                icon: "üîç TY",
                say:
                  "(Opisz co siƒô sta≈Ço - u≈ºyj s≈Ç√≥w zwiƒÖzanych ze sprawƒÖ: " +
                  typeKw.slice(0, 4).join(", ") +
                  "...)",
              },
              {
                who: "judge",
                icon: "‚öñÔ∏è SƒòDZIA",
                say: function () {
                  if (txt.length < 15)
                    return "Panie oskar≈ºycielu, proszƒô m√≥wiƒá g≈Ço≈õniej i wyra≈∫niej!";
                  if (mentionedDetails)
                    return "Rozumiem sytuacjƒô. Kogo oskar≈ºamy?";
                  return pickQ(tq.q1);
                },
              },
              {
                who: "you",
                icon: "üîç TY",
                say: mentionedSuspect
                  ? "(Ju≈º poda≈Çe≈õ sprawcƒô - co jeszcze chcesz dodaƒá?)"
                  : "(Kto jest sprawcƒÖ? Podaj imiƒô lub opis)",
              },
              {
                who: "judge",
                icon: "‚öñÔ∏è SƒòDZIA",
                say: function () {
                  if (mentionedSuspect && mentionedEvidence)
                    return "Mamy sprawcƒô i dowody. Proszƒô o szczeg√≥≈Çy analizy.";
                  if (mentionedSuspect)
                    return (
                      "Oskar≈ºony: " +
                      c.suspect.split("-")[0] +
                      ". " +
                      pickQ(tq.q2)
                    );
                  return pickQ(tq.q2);
                },
              },
              {
                who: "you",
                icon: "üîç TY",
                say: mentionedEvidence
                  ? "(Ju≈º wspomnia≈Çe≈õ o dowodach - opisz analizƒô)"
                  : "(Jakie masz dowody? Co wykaza≈Ça analiza?)",
              },
              {
                who: "defense",
                icon: "üëî OBRO≈ÉCA",
                say: function () {
                  if (mentionedEvidence && foundContext > 3)
                    return "Wysoki SƒÖdzie! ≈ªƒÖdam weryfikacji tych rzekomych dowod√≥w!";
                  if (!mentionedEvidence)
                    return "Wysoki SƒÖdzie, oskar≈ºyciel nie przedstawi≈Ç ≈ºadnych konkretnych dowod√≥w!";
                  return "Sprzeciw! SkƒÖd pewno≈õƒá ≈ºe dowody nie sƒÖ sfabrykowane?";
                },
              },
              {
                who: "judge",
                icon: "‚öñÔ∏è SƒòDZIA",
                say:
                  "Oskar≈ºycielu, zaznaczy≈Ç Pan w analizie ≈ºe dow√≥d jest " +
                  verdictWord +
                  ". Czy to Pana ostateczna ocena?",
              },
              {
                who: "you",
                icon: "üîç TY",
                say:
                  "(Potwierd≈∫: dow√≥d " +
                  verdictWord +
                  " - i wyja≈õnij DLACZEGO tak oceni≈Çe≈õ)",
              },
              {
                who: "judge",
                icon: "‚öñÔ∏è SƒòDZIA",
                say: function () {
                  var sf = saidVerdictFake(),
                    sr = saidVerdictReal();
                  if (playerVerdict && sr)
                    return "SPRZECZNO≈öƒÜ! Zaznaczy≈Ç Pan FA≈ÅSZYWY ale m√≥wi ≈ºe prawdziwy!";
                  if (!playerVerdict && sf)
                    return "SPRZECZNO≈öƒÜ! Zaznaczy≈Ç Pan PRAWDZIWY ale m√≥wi ≈ºe fa≈Çszywy!";
                  if (sf || sr)
                    return "Zeznania zgodne z dokumentacjƒÖ. " + pickQ(tq.q3);
                  return "Proszƒô jasno: dow√≥d jest FA≈ÅSZYWY czy PRAWDZIWY wed≈Çug analizy?";
                },
              },
              {
                who: "you",
                icon: "üîç TY",
                say: "(Ostatnie s≈Çowo - podsumuj sprawƒô)",
              },
              {
                who: "judge",
                icon: "‚öñÔ∏è SƒòDZIA",
                say: "Dziƒôkujƒô. SƒÖd wyda wyrok...",
                verdict: true,
              },
            ];
          }
        } else {
          // POLICJA - inne pytania
          if (!d.phases) {
            d.phases = [
              {
                who: "police",
                icon: "üöî OFICER",
                say:
                  "Dzie≈Ñ dobry. Zg≈Çoszenie: " +
                  c.type +
                  ". Proszƒô opisaƒá sytuacjƒô.",
              },
              {
                who: "you",
                icon: "üîç TY",
                say: "(Opisz zdarzenie - " + c.type.toLowerCase() + ")",
              },
              {
                who: "police",
                icon: "üöî OFICER",
                say: function () {
                  if (txt.length < 15)
                    return "Proszƒô m√≥wiƒá konkretniej. Co dok≈Çadnie siƒô sta≈Ço?";
                  if (mentionedDetails)
                    return "OK, rozumiem. Kto jest podejrzany?";
                  return pickQ(tq.q1);
                },
              },
              {
                who: "you",
                icon: "üîç TY",
                say: mentionedSuspect
                  ? "(Sprawca ju≈º podany - dodaj szczeg√≥≈Çy)"
                  : "(Kto to zrobi≈Ç? Podejrzenia?)",
              },
              {
                who: "police",
                icon: "üöî OFICER",
                say: function () {
                  if (mentionedSuspect && mentionedEvidence)
                    return "Mamy podejrzanego i dowody. Co wykaza≈Ça analiza?";
                  if (mentionedSuspect)
                    return (
                      "Namierzamy: " +
                      c.suspect.split("-")[0] +
                      ". " +
                      pickQ(tq.q2)
                    );
                  return pickQ(tq.q2);
                },
              },
              {
                who: "you",
                icon: "üîç TY",
                say: mentionedEvidence
                  ? "(Dowody ju≈º podane - opisz wyniki analizy)"
                  : "(Jakie dowody? Screeny, maile?)",
              },
              {
                who: "police",
                icon: "üöî OFICER",
                say:
                  "W dokumentach masz ≈ºe dow√≥d jest " +
                  verdictWord +
                  ". Potwierdzasz?",
              },
              {
                who: "you",
                icon: "üîç TY",
                say: "(Powiedz czy dow√≥d PRAWDZIWY czy FA≈ÅSZYWY - musi siƒô zgadzaƒá!)",
              },
              {
                who: "police",
                icon: "üöî OFICER",
                say: function () {
                  var sf = saidVerdictFake(),
                    sr = saidVerdictReal();
                  if (playerVerdict && sr)
                    return "Halo! W papierach masz FA≈ÅSZYWY a m√≥wisz prawdziwy?!";
                  if (!playerVerdict && sf)
                    return "Moment! W dokumentach PRAWDZIWY a ty ≈ºe fa≈Çszywy?!";
                  if (c.type == "GRO≈πBY" || c.type == "STALKING")
                    return "Czy ofiara jest teraz bezpieczna?";
                  return pickQ(tq.q3);
                },
              },
              { who: "you", icon: "üîç TY", say: "(Ostatnie informacje)" },
              {
                who: "police",
                icon: "üöî OFICER",
                say: "Mam wszystko. Podejmujƒô decyzjƒô...",
                verdict: true,
              },
            ];
          }
        }
        var phases = d.phases;
        var ph = phases[d.phase];
        if (!ph) {
          showSceneVerdict();
          return;
        }
        sp.className = "scene-speaker " + ph.who;
        sp.textContent = ph.icon;
        var sayTxt = typeof ph.say === "function" ? ph.say() : ph.say;
        tx.textContent = sayTxt;
        if (ph.who != "you") speak(sayTxt, ph.who);
        if (ph.input || ph.who == "you") {
          inp.style.display = "block";
          document.getElementById("scene-textarea").value = "";
          document.getElementById("scene-textarea").focus();
        } else if (ph.verdict) {
          setTimeout(showSceneVerdict, 3000);
        } else {
          d.phase++;
          setTimeout(runScenePhase, 3000);
        }
      }
      var sceneSubmitBtn = document.getElementById("scene-submit");
      if (sceneSubmitBtn) {
        sceneSubmitBtn.onclick = sceneSubmitBtn.ontouchend = function (e) {
          e.preventDefault();
          var txt = document
            .getElementById("scene-textarea")
            .value.toLowerCase()
            .trim();
          document.getElementById("scene-input").style.display = "none";
          if (!sceneData.allTexts) sceneData.allTexts = "";
          sceneData.allTexts += " " + txt;
          sceneData.lastAnswer = txt;
          document.getElementById("scene-text").textContent =
            txt.length > 0
              ? '"' +
                txt.substring(0, 80) +
                (txt.length > 80 ? "..." : "") +
                '"'
              : '"(milczenie)"';
          sceneData.phase++;
          setTimeout(runScenePhase, 2000);
        };
      }
      function showSceneVerdict() {
        document.getElementById("scene-dialogue").style.display = "none";
        var res = document.getElementById("scene-result");
        res.style.display = "block";
        var title = document.getElementById("scene-verdict-title"),
          text = document.getElementById("scene-verdict-text");
        var outcome = getSceneOutcome(sceneData);
        var rew = outcome.rew;
        var msg = outcome.msg;
        var col = rew > 0 ? "#0f8" : rew == 0 ? "#f90" : "#f36";
        var speak_txt = "";
        if (outcome.type == "suspend") {
          title.textContent = "‚õî ZAWIESZENIE!";
          title.style.color = "#f36";
          text.innerHTML =
            msg +
            '<br><br><span style="color:#f36">Licencja zawieszona na 2 godziny!</span>';
          speak_txt =
            sceneData.type == "Sad"
              ? "Za fa≈Çszywe oskar≈ºenie zawieszam Pana licencjƒô!"
              : "Za fa≈Çszywe zg≈Çoszenie nak≈Çadam zawieszenie!";
          speak(speak_txt, sceneData.type == "Sad" ? "judge" : "police");
          G.completed.push({
            id: sceneData.caseData.id,
            name: sceneData.caseData.name,
            rew: 0,
          });
          G.inbox.unshift({
            from: sceneData.type,
            body: "Licencja zawieszona za fa≈Çszywe oskar≈ºenie.",
            read: false,
          });
          updateHUD();
          saveGame();
          setTimeout(function () {
            suspendPlayer(2);
          }, 3000);
          return;
        }
        if (outcome.type == "full_win")
          speak_txt =
            sceneData.type == "Sad"
              ? "Uznajƒô oskar≈ºonego winnym! Doskona≈Ça praca!"
              : "Aresztujemy podejrzanego! ≈öwietna robota!";
        else if (outcome.type == "win")
          speak_txt =
            sceneData.type == "Sad"
              ? "Uznajƒô oskar≈ºonego winnym."
              : "Wszczynamy postƒôpowanie.";
        else if (outcome.type == "partial")
          speak_txt =
            sceneData.type == "Sad"
              ? "Czƒô≈õciowo uznajƒô winƒô."
              : "Przyjmujemy zg≈Çoszenie.";
        else if (outcome.type == "weak_win")
          speak_txt = "S≈Çabe argumenty, ale akceptujƒô.";
        else if (outcome.type == "dismissed")
          speak_txt = "Sprawa umorzona. Brak dowod√≥w.";
        else if (outcome.type == "fine")
          speak_txt = "Nak≈Çadam grzywnƒô za b≈Çƒôdne oskar≈ºenie!";
        else if (outcome.type == "lose") speak_txt = "Odrzucam to zg≈Çoszenie.";
        else speak_txt = "Sprawa rozpatrzona.";
        speak(speak_txt, sceneData.type == "Sad" ? "judge" : "police");
        title.textContent =
          rew > 0 ? "‚úÖ SUKCES!" : rew == 0 ? "‚ö†Ô∏è UMORZONE" : "‚ùå PORA≈ªKA!";
        title.style.color = col;
        var tax = getTotalTax();
        var taxAmount = rew > 0 ? Math.floor((rew * tax) / 100) : 0;
        var finalRew = rew - taxAmount;
        text.innerHTML =
          msg +
          '<br><br><span style="font-size:20px;color:' +
          col +
          '">' +
          (rew >= 0 ? "+" : "") +
          rew +
          "üí∞</span>" +
          (taxAmount > 0
            ? '<br><span style="font-size:14px;color:#f90">-' +
              taxAmount +
              "üí∞ (" +
              tax +
              '% op≈Çata za narzƒôdzia)</span><br><span style="font-size:16px;color:#0f8">= ' +
              finalRew +
              "üí∞ netto</span>"
            : "");
        G.credits = Math.max(0, G.credits + finalRew);
        G.completed.push({
          id: sceneData.caseData.id,
          name: sceneData.caseData.name,
          rew: rew,
        });
        G.inbox.unshift({ from: sceneData.type, body: msg, read: false });
        updateHUD();
        saveGame();
      }
      var sceneExitBtn = document.getElementById("scene-exit");
      if (sceneExitBtn) {
        sceneExitBtn.onclick = sceneExitBtn.ontouchend = function (e) {
          e.preventDefault();
          document.getElementById("scene-overlay").style.display = "none";
          G.day++;
          updateHUD();
          saveGame();
          renderPanel("case");
        };
      }
      document.getElementById("start-btn").onclick = function () {
        document.getElementById("intro").style.display = "none";
        init3D();
        document.getElementById("touch-btn").onclick = function () {
          if (lookAt && !G.inPC) interact(lookAt);
        };
        setTimeout(function () {
          notify("Witaj!", "Id≈∫ do DRZWI");
        }, 500);
      };
      window.onresize = function () {
        if (camera && renderer) {
          camera.aspect = innerWidth / innerHeight;
          camera.updateProjectionMatrix();
          renderer.setSize(innerWidth, innerHeight);
        }
      };
      document.oncontextmenu = function (e) {
        e.preventDefault();
        return false;
      };
      var chatClientIdx = null;
      var mediatorHistory = [];
      var mediatorCaseIdx = null;
      function openMediatorChat() {
        mediatorCaseIdx = parseInt(document.getElementById("case-sel").value);
        var c = G.activeCases[mediatorCaseIdx];
        mediatorHistory = [];
        if (c) {
          mediatorHistory.push({
            from: "mediator",
            txt:
              "Witam, jestem po≈õrednikiem prawnym. Widzƒô sprawƒô: " +
              c.name +
              " (" +
              c.type +
              '). Mogƒô doradziƒá gdzie najlepiej jƒÖ skierowaƒá. Napisz "porada" a za 50üí∞ powiem ci dok≈Çadnie gdzie wys≈Çaƒá i dlaczego.',
          });
        } else {
          mediatorHistory.push({
            from: "mediator",
            txt: "Witam. Nie widzƒô wybranej sprawy. Wybierz sprawƒô z listy i wr√≥ƒá do mnie.",
          });
        }
        renderMediatorMessages();
        document.getElementById("mediator-chat").style.display = "flex";
      }
      function renderMediatorMessages() {
        var h = "";
        for (var i = 0; i < mediatorHistory.length; i++) {
          var m = mediatorHistory[i];
          h +=
            '<div style="margin-bottom:10px;text-align:' +
            (m.from == "ty" ? "right" : "left") +
            '"><div style="display:inline-block;background:' +
            (m.from == "ty" ? "#fc0" : "#2a2a4e") +
            ";color:" +
            (m.from == "ty" ? "#000" : "#fff") +
            ';padding:8px 12px;border-radius:10px;max-width:80%;font-size:13px;white-space:pre-wrap">' +
            m.txt +
            "</div></div>";
        }
        document.getElementById("mediator-messages").innerHTML = h;
        document.getElementById("mediator-messages").scrollTop = 9999;
      }
      function getMediatorResponse(msg) {
        var m = msg.toLowerCase();
        var c = G.activeCases[mediatorCaseIdx];
        if (!c)
          return "Nie widzƒô ≈ºadnej wybranej sprawy. Zamknij okno, wybierz sprawƒô z listy i wr√≥ƒá.";
        if (
          m.indexOf("porada") >= 0 ||
          m.indexOf("tak") >= 0 ||
          m.indexOf("chcƒô") >= 0 ||
          m.indexOf("dawaj") >= 0 ||
          m.indexOf("m√≥w") >= 0
        ) {
          if (G.credits < 50)
            return (
              "‚ùå Nie masz wystarczajƒÖcych ≈õrodk√≥w. Potrzebujesz 50üí∞, masz tylko " +
              G.credits +
              "üí∞."
            );
          G.credits -= 50;
          updateHUD();
          saveGame();
          var best = "";
          var reason = "";
          if (c.type == "GRO≈πBY") {
            best = "üöî POLICJA";
            reason =
              "Gro≈∫by to sprawa karna. Policja mo≈ºe natychmiast dzia≈Çaƒá, zabezpieczyƒá dowody i zapewniƒá ochronƒô ofierze. MogƒÖ te≈º namierzyƒá sprawcƒô.";
          } else if (c.type == "STALKING") {
            best = "üöî POLICJA";
            reason =
              "Stalking to przestƒôpstwo ≈õcigane z urzƒôdu. Policja mo≈ºe wydaƒá zakaz zbli≈ºania siƒô i monitorowaƒá sprawcƒô. Ofiara dostanie ochronƒô.";
          } else if (c.type == "ZNIES≈ÅAWIENIE") {
            best = "‚öñÔ∏è SƒÑD";
            reason =
              "Znies≈Çawienie to sprawa cywilna. SƒÖd mo≈ºe nakazaƒá usuniƒôcie fa≈Çszywych tre≈õci, przeprosiny i odszkodowanie finansowe.";
          } else if (c.type == "PODSZYWANIE") {
            best = "‚öñÔ∏è SƒÑD";
            reason =
              "Podszywanie siƒô pod kogo≈õ to naruszenie d√≥br osobistych. SƒÖd mo≈ºe nakazaƒá usuniƒôcie fa≈Çszywego profilu i zasƒÖdziƒá odszkodowanie.";
          } else if (c.type == "OSZUSTWO") {
            best = "üöî POLICJA";
            reason =
              "Oszustwo to przestƒôpstwo. Policja wszczyna ≈õledztwo, mo≈ºe zablokowaƒá konta bankowe sprawcy i odzyskaƒá pieniƒÖdze.";
          } else if (c.type == "HACKING") {
            best = "üöî POLICJA";
            reason =
              "W≈Çamanie na konto to cyberprzestƒôpstwo. Policja ma wydzia≈Ç cyberprzestƒôpczo≈õci kt√≥ry mo≈ºe namierzyƒá hakera.";
          } else if (c.type == "SZANTA≈ª") {
            best = "üöî POLICJA lub üìã PROKURATURA";
            reason =
              "Szanta≈º to powa≈ºne przestƒôpstwo zagro≈ºone wiƒôzieniem. Policja dzia≈Ça szybciej, prokuratura ma wiƒôcej zasob√≥w na trudne sprawy.";
          } else if (c.type == "WY≈ÅUDZENIE") {
            best = "üìã PROKURATURA";
            reason =
              "Wy≈Çudzenia na du≈ºƒÖ skalƒô najlepiej kierowaƒá do prokuratury - prowadzƒÖ kompleksowe ≈õledztwa finansowe.";
          } else {
            best = "üöî POLICJA";
            reason =
              "W razie wƒÖtpliwo≈õci policja to bezpieczny wyb√≥r - przeka≈ºƒÖ sprawƒô dalej je≈õli trzeba.";
          }
          return (
            "‚úÖ PORADA (-50üí∞)\n\n‚û°Ô∏è Wy≈õlij do: " +
            best +
            "\n\nüìù Dlaczego: " +
            reason +
            "\n\nPowodzenia!"
          );
        }
        if (
          m.indexOf("ile") >= 0 ||
          m.indexOf("koszt") >= 0 ||
          m.indexOf("cena") >= 0
        )
          return 'Porada kosztuje 50üí∞. Napisz "porada" ≈ºeby jƒÖ otrzymaƒá.';
        if (m.indexOf("dziƒôki") >= 0 || m.indexOf("dziƒôkujƒô") >= 0)
          return "Nie ma za co! Powodzenia ze sprawƒÖ.";
        if (
          m.indexOf("hej") >= 0 ||
          m.indexOf("cze≈õƒá") >= 0 ||
          m.indexOf("siema") >= 0
        )
          return 'Witam! Napisz "porada" je≈õli chcesz wiedzieƒá gdzie wys≈Çaƒá sprawƒô (50üí∞).';
        return 'Napisz "porada" ≈ºeby otrzymaƒá rekomendacjƒô za 50üí∞, lub "ile" ≈ºeby sprawdziƒá cenƒô.';
      }
      document.getElementById("close-mediator").onclick = function () {
        document.getElementById("mediator-chat").style.display = "none";
      };
      var medSendBtn = document.getElementById("mediator-send");
      if (medSendBtn) {
        medSendBtn.onclick = medSendBtn.ontouchend = function (e) {
          e.preventDefault();
          var input = document.getElementById("mediator-input");
          var txt = input.value.trim();
          if (!txt) return;
          mediatorHistory.push({ from: "ty", txt: txt });
          var resp = getMediatorResponse(txt);
          setTimeout(function () {
            mediatorHistory.push({ from: "mediator", txt: resp });
            renderMediatorMessages();
          }, 500);
          input.value = "";
          renderMediatorMessages();
        };
      }
    </script>
  </body>
</html>
