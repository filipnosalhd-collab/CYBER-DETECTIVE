<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"
    />
    <title>Cyber Detective</title>
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%230a0a12' width='100' height='100' rx='20'/><circle cx='40' cy='40' r='20' fill='none' stroke='%2300ffff' stroke-width='6'/><line x1='55' y1='55' x2='75' y2='75' stroke='%2300ffff' stroke-width='6' stroke-linecap='round'/><circle cx='70' cy='30' r='8' fill='%23ff3366'/><path d='M65 30 h10 M70 25 v10' stroke='white' stroke-width='2'/></svg>"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700&display=swap");
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        background: #000;
        overflow: hidden;
        font-family: "Segoe UI", sans-serif;
      }
      #loader,
      #suspended {
        position: fixed;
        inset: 0;
        background: linear-gradient(135deg, #0a0a12, #1a1a2e);
        z-index: 3000;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
        text-align: center;
      }
      #loader-logo {
        width: 120px;
        height: 120px;
        margin-bottom: 30px;
        animation: pulse-logo 2s ease-in-out infinite;
      }
      @keyframes pulse-logo {
        0%,
        100% {
          filter: drop-shadow(0 0 20px #0ff);
        }
        50% {
          filter: drop-shadow(0 0 40px #0ff);
        }
      }
      #loader h1 {
        font-family: "Orbitron";
        font-size: clamp(20px, 5vw, 32px);
        color: #0ff;
        text-shadow: 0 0 30px #0ff;
        margin-bottom: 30px;
      }
      #loader-bar-container {
        width: 80%;
        max-width: 400px;
        height: 20px;
        background: #1a1a2e;
        border: 2px solid #0ff;
        border-radius: 10px;
        overflow: hidden;
        margin-bottom: 15px;
      }
      #loader-bar {
        width: 0%;
        height: 100%;
        background: linear-gradient(90deg, #0ff, #0f8);
        border-radius: 8px;
        transition: width 0.3s ease;
      }
      #loader-percent {
        font-family: "Orbitron";
        font-size: 24px;
        color: #0ff;
        margin-bottom: 10px;
      }
      #loader-text {
        font-family: "Share Tech Mono";
        font-size: 14px;
        color: #888;
      }
      #suspended h1 {
        font-family: "Orbitron";
        color: #f36;
        font-size: 28px;
        margin-bottom: 20px;
      }
      #suspended p {
        color: #aaa;
        margin-bottom: 10px;
      }
      #suspended .time {
        font-family: "Orbitron";
        color: #fc0;
        font-size: 36px;
        margin: 20px 0;
      }
      #intro {
        position: fixed;
        inset: 0;
        background: linear-gradient(135deg, #0a0a12, #1a1a2e);
        z-index: 2000;
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
        text-align: center;
      }
      #intro h1 {
        font-family: "Orbitron";
        font-size: clamp(28px, 8vw, 50px);
        color: #0ff;
        text-shadow: 0 0 50px #0ff;
        margin-bottom: 15px;
      }
      #intro p {
        color: #888;
        margin-bottom: 40px;
      }
      #intro button {
        background: transparent;
        border: 2px solid #0ff;
        color: #0ff;
        padding: 15px 50px;
        font-family: "Orbitron";
        cursor: pointer;
      }
      canvas {
        display: block;
      }
      #crosshair {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 20px;
        height: 20px;
        pointer-events: none;
        z-index: 100;
      }
      #crosshair::before,
      #crosshair::after {
        content: "";
        position: absolute;
        background: #0ff;
      }
      #crosshair::before {
        width: 2px;
        height: 100%;
        left: 50%;
        transform: translateX(-50%);
      }
      #crosshair::after {
        width: 100%;
        height: 2px;
        top: 50%;
        transform: translateY(-50%);
      }
      #prompt {
        position: fixed;
        bottom: 20%;
        left: 50%;
        transform: translateX(-50%);
        color: #0ff;
        font-family: "Share Tech Mono";
        background: rgba(0, 20, 30, 0.9);
        padding: 12px 24px;
        border: 2px solid #0ff;
        border-radius: 8px;
        opacity: 0;
        z-index: 100;
      }
      #touch-btn {
        display: none;
        position: fixed;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(135deg, #0ff, #0f8);
        color: #000;
        font-family: "Orbitron", sans-serif;
        font-weight: bold;
        padding: 18px 40px;
        border-radius: 30px;
        font-size: 16px;
        z-index: 100;
        cursor: pointer;
      }
      #hud {
        position: fixed;
        top: 10px;
        left: 10px;
        color: #0ff;
        font-family: "Share Tech Mono";
        font-size: 13px;
        z-index: 100;
      }
      #hud div {
        margin-bottom: 4px;
        padding: 5px 10px;
        background: rgba(0, 255, 255, 0.15);
        border-left: 3px solid #0ff;
      }
      #computer {
        position: fixed;
        inset: 0;
        background: #0a0a12;
        z-index: 500;
        display: none;
        flex-direction: column;
      }
      #computer-bar {
        height: 45px;
        background: #1a1a2e;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 12px;
        border-bottom: 1px solid #333;
      }
      #computer-bar span {
        font-family: "Orbitron";
        color: #0ff;
      }
      #computer-bar button {
        background: #f36;
        color: #fff;
        border: none;
        padding: 8px 16px;
        cursor: pointer;
        border-radius: 5px;
      }
      #computer-main {
        flex: 1;
        display: flex;
        overflow: hidden;
      }
      #sidebar {
        width: 60px;
        background: #0f0f1a;
        border-right: 1px solid #1a1a2e;
        padding: 8px;
      }
      .nav-item {
        padding: 14px 8px;
        margin-bottom: 4px;
        background: rgba(0, 255, 255, 0.05);
        color: #888;
        font-size: 20px;
        cursor: pointer;
        border-left: 3px solid transparent;
        text-align: center;
        border-radius: 0 5px 5px 0;
      }
      .nav-item:hover,
      .nav-item.active {
        background: rgba(0, 255, 255, 0.15);
        color: #0ff;
        border-color: #0ff;
      }
      .nav-item.notify {
        background: rgba(255, 51, 102, 0.2);
        border-color: #f36;
      }
      #content {
        flex: 1;
        padding: 15px;
        overflow-y: auto;
      }
      .panel {
        background: #0f0f1a;
        border: 1px solid #1a1a2e;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
      }
      .panel h2 {
        font-family: "Orbitron";
        color: #0ff;
        margin-bottom: 12px;
        font-size: 16px;
      }
      .case-card {
        background: #1a1a2e;
        border: 2px solid #2a2a4e;
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 10px;
        cursor: pointer;
      }
      .case-card:hover,
      .case-card.active {
        border-color: #0ff;
      }
      .case-card h4 {
        color: #fff;
        font-size: 14px;
      }
      .case-card p {
        color: #888;
        font-size: 12px;
      }
      .evidence-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 10px;
      }
      .evidence-card {
        background: #1a1a2e;
        border: 2px solid #2a2a4e;
        border-radius: 8px;
        padding: 10px;
        cursor: pointer;
      }
      .evidence-card:hover {
        border-color: #0ff;
      }
      .evidence-img {
        height: 80px;
        background: #0a0a12;
        border-radius: 5px;
        margin-bottom: 8px;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .evidence-img img {
        max-width: 100%;
        max-height: 100%;
      }
      .badge {
        font-size: 10px;
        padding: 3px 8px;
        border-radius: 4px;
      }
      .badge-pending {
        background: rgba(255, 153, 0, 0.3);
        color: #f90;
      }
      .badge-ok {
        background: rgba(0, 255, 136, 0.3);
        color: #0f8;
      }
      .badge-fake {
        background: rgba(255, 51, 102, 0.3);
        color: #f36;
      }
      .recipient-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
        margin: 10px 0;
      }
      .recipient-opt {
        background: #1a1a2e;
        border: 2px solid #2a2a4e;
        padding: 12px;
        text-align: center;
        border-radius: 8px;
        cursor: pointer;
      }
      .recipient-opt:hover,
      .recipient-opt.selected {
        border-color: #0ff;
        background: rgba(0, 255, 255, 0.1);
      }
      .recipient-opt .icon {
        font-size: 24px;
      }
      .recipient-opt .name {
        color: #fff;
        font-size: 11px;
      }
      .send-btn {
        width: 100%;
        background: linear-gradient(135deg, #0f8, #0ff);
        color: #000;
        border: none;
        padding: 14px;
        font-family: "Orbitron";
        cursor: pointer;
        border-radius: 8px;
        margin-top: 10px;
      }
      .send-btn:disabled {
        background: #333;
        color: #666;
      }
      #analysis {
        position: fixed;
        inset: 0;
        background: #000;
        z-index: 600;
        display: none;
        flex-direction: column;
      }
      #analysis-header {
        background: #1a1a2e;
        padding: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      #analysis-header h2 {
        font-family: "Orbitron";
        color: #0ff;
        font-size: 14px;
      }
      #analysis-header button {
        background: #f36;
        border: none;
        color: #fff;
        padding: 8px 15px;
        cursor: pointer;
        border-radius: 5px;
      }
      #analysis-body {
        flex: 1;
        display: flex;
        flex-direction: column;
      }
      #img-viewer {
        flex: 1;
        background: #050508;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }
      #img-viewer img {
        max-width: 95%;
        max-height: 50vh;
        transition: transform 0.3s;
        cursor: zoom-in;
      }
      #tools-panel {
        background: #0a0a12;
        padding: 10px;
        overflow-y: auto;
        max-height: 40vh;
      }
      .tool-btn {
        width: 100%;
        padding: 10px;
        margin-bottom: 5px;
        background: #1a1a2e;
        border: 2px solid #2a2a4e;
        color: #888;
        font-size: 12px;
        cursor: pointer;
        text-align: left;
        border-radius: 5px;
      }
      .tool-btn:hover {
        border-color: #0ff;
        color: #0ff;
      }
      .tool-btn.locked {
        opacity: 0.4;
      }
      .tool-btn.active {
        border-color: #0f8;
        color: #0f8;
      }
      #results-box {
        background: #1a1a2e;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
        max-height: 100px;
        overflow-y: auto;
      }
      .result-row {
        display: flex;
        justify-content: space-between;
        padding: 4px 0;
        font-size: 11px;
      }
      .result-val.sus {
        color: #f90;
      }
      .result-val.ok {
        color: #0f8;
      }
      #verdict-btns {
        display: flex;
        gap: 10px;
      }
      .verdict-btn {
        flex: 1;
        padding: 12px;
        border: 2px solid;
        background: transparent;
        font-family: "Orbitron";
        font-size: 12px;
        cursor: pointer;
        border-radius: 8px;
      }
      .v-ok {
        border-color: #0f8;
        color: #0f8;
      }
      .v-fake {
        border-color: #f36;
        color: #f36;
      }
      #visitor {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.95);
        z-index: 400;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 15px;
      }
      #visitor-box {
        background: #1a1a2e;
        border: 2px solid #0ff;
        border-radius: 15px;
        padding: 20px;
        max-width: 400px;
        width: 100%;
      }
      .visitor-head {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 15px;
      }
      .visitor-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: #0ff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
      }
      #visitor-complaint {
        color: #ddd;
        margin-bottom: 15px;
        padding: 12px;
        background: #0a0a12;
        border-radius: 8px;
        border-left: 3px solid #f90;
        max-height: 200px;
        overflow-y: auto;
        font-size: 13px;
        line-height: 1.5;
      }
      .visitor-btns {
        display: flex;
        gap: 10px;
      }
      .visitor-btns button {
        flex: 1;
        padding: 12px;
        font-family: "Orbitron";
        border-radius: 8px;
        cursor: pointer;
      }
      #btn-accept {
        background: #0ff;
        color: #000;
        border: none;
      }
      #btn-reject {
        background: transparent;
        border: 2px solid #f36;
        color: #f36;
      }
      #result {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.95);
        z-index: 700;
        display: none;
        align-items: center;
        justify-content: center;
      }
      #result-box {
        text-align: center;
      }
      #result-icon {
        font-size: 60px;
      }
      #result-title {
        font-family: "Orbitron";
        font-size: 24px;
        margin: 10px 0;
      }
      #result-msg {
        color: #aaa;
        margin-bottom: 15px;
      }
      #result-reward {
        font-family: "Orbitron";
        font-size: 20px;
        margin-bottom: 20px;
      }
      #result button {
        background: #0ff;
        color: #000;
        border: none;
        padding: 12px 30px;
        font-family: "Orbitron";
        cursor: pointer;
        border-radius: 8px;
      }
      #notif {
        position: fixed;
        top: 60px;
        right: 10px;
        background: #1a1a2e;
        border: 2px solid #0ff;
        border-radius: 10px;
        padding: 12px;
        z-index: 1000;
        display: none;
        max-width: 200px;
      }
      #notif h4 {
        color: #0ff;
        font-size: 11px;
      }
      #notif p {
        color: #aaa;
        font-size: 11px;
      }
      .shop-item {
        background: #1a1a2e;
        border: 2px solid #2a2a4e;
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .shop-btn {
        background: #fc0;
        color: #000;
        border: none;
        padding: 8px 15px;
        cursor: pointer;
        border-radius: 5px;
      }
      .shop-btn:disabled {
        background: #333;
        color: #666;
      }
      .mail-item {
        background: #1a1a2e;
        border: 2px solid #2a2a4e;
        border-radius: 8px;
        padding: 10px;
        margin-bottom: 8px;
        cursor: pointer;
      }
      .mail-item.unread {
        border-left: 4px solid #0ff;
      }
      #scene-overlay {
        position: fixed;
        inset: 0;
        background: #000;
        z-index: 800;
        display: none;
        flex-direction: column;
      }
      #scene-canvas {
        width: 100%;
        height: 40vh;
      }
      #scene-ui {
        padding: 15px;
        overflow-y: auto;
        flex: 1;
        background: linear-gradient(transparent, rgba(0, 0, 0, 0.9));
      }
      #scene-dialogue {
        background: #1a1a2e;
        border: 2px solid #0ff;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 10px;
      }
      .scene-speaker {
        font-family: "Orbitron";
        font-size: 14px;
        margin-bottom: 8px;
      }
      .scene-speaker.judge {
        color: #fc0;
      }
      .scene-speaker.police {
        color: #36f;
      }
      .scene-speaker.defense {
        color: #f36;
      }
      .scene-speaker.you {
        color: #0f8;
      }
      #scene-text {
        color: #ddd;
        line-height: 1.5;
        font-size: 13px;
        min-height: 40px;
      }
      #scene-input {
        display: none;
        margin-top: 10px;
      }
      #scene-input textarea {
        width: 100%;
        background: #0a0a12;
        border: 2px solid #0ff;
        color: #fff;
        padding: 10px;
        border-radius: 8px;
        font-size: 13px;
        min-height: 60px;
        resize: none;
      }
      #scene-input button {
        width: 100%;
        background: linear-gradient(135deg, #0ff, #0f8);
        color: #000;
        border: none;
        padding: 12px;
        font-family: "Orbitron";
        cursor: pointer;
        border-radius: 8px;
        margin-top: 8px;
      }
      #scene-options {
        display: none;
        margin-top: 10px;
      }
      .scene-option {
        background: #1a1a2e;
        border: 2px solid #2a2a4e;
        color: #aaa;
        padding: 10px;
        margin-bottom: 5px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 12px;
      }
      .scene-option:hover {
        border-color: #0ff;
        color: #0ff;
      }
      #scene-result {
        display: none;
        text-align: center;
        padding: 20px;
      }
      #scene-result h2 {
        font-family: "Orbitron";
        font-size: 24px;
        margin-bottom: 15px;
      }
      #scene-result p {
        color: #aaa;
        margin-bottom: 20px;
      }
      #scene-result button {
        background: linear-gradient(135deg, #0ff, #0f8);
        color: #000;
        border: none;
        padding: 12px 30px;
        font-family: "Orbitron";
        cursor: pointer;
        border-radius: 8px;
      }
      #client-chat {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.95);
        z-index: 650;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 15px;
      }
      #chat-box {
        background: #1a1a2e;
        border: 2px solid #0ff;
        border-radius: 15px;
        padding: 20px;
        max-width: 500px;
        width: 100%;
        max-height: 80vh;
        display: flex;
        flex-direction: column;
      }
      #chat-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }
      #chat-header h3 {
        color: #0ff;
        font-family: "Orbitron";
      }
      #chat-close {
        background: #f36;
        color: #fff;
        border: none;
        padding: 8px 15px;
        cursor: pointer;
        border-radius: 5px;
      }
      #chat-messages {
        flex: 1;
        overflow-y: auto;
        margin-bottom: 15px;
        max-height: 300px;
      }
      .chat-msg {
        padding: 10px;
        margin-bottom: 8px;
        border-radius: 8px;
        font-size: 13px;
      }
      .chat-msg.client {
        background: #2a2a4e;
        color: #fff;
        margin-right: 40px;
      }
      .chat-msg.you {
        background: #0a3a3a;
        color: #0ff;
        margin-left: 40px;
        text-align: right;
      }
      #chat-input {
        display: flex;
        gap: 10px;
      }
      #chat-input textarea {
        flex: 1;
        background: #0a0a12;
        border: 2px solid #0ff;
        color: #fff;
        padding: 10px;
        border-radius: 8px;
        resize: none;
        min-height: 50px;
      }
      #chat-input button {
        background: #0ff;
        color: #000;
        border: none;
        padding: 10px 20px;
        cursor: pointer;
        border-radius: 8px;
        font-family: "Orbitron";
      }
    </style>
  </head>
  <body>
    <div id="suspended" style="display: none">
      <h1>‚õî ZAWIESZONY</h1>
      <p>Twoja licencja detektywa zosta≈Ça zawieszona za b≈Çƒôdne wnioski.</p>
      <p>Mo≈ºesz wr√≥ciƒá za:</p>
      <div class="time" id="suspend-time">00:00:00</div>
      <p style="color: #666; font-size: 12px">Zamknij stronƒô i wr√≥ƒá p√≥≈∫niej.</p>
    </div>
    <div id="loader">
      <svg
        id="loader-logo"
        viewBox="0 0 120 120"
        xmlns="http://www.w3.org/2000/svg"
      >
        <defs>
          <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color: #0ff" />
            <stop offset="100%" style="stop-color: #0f8" />
          </linearGradient>
        </defs>
        <rect fill="#0a0a12" width="120" height="120" rx="15" />
        <circle
          cx="45"
          cy="50"
          r="28"
          fill="none"
          stroke="url(#grad1)"
          stroke-width="5"
        />
        <line
          x1="66"
          y1="71"
          x2="95"
          y2="100"
          stroke="url(#grad1)"
          stroke-width="6"
          stroke-linecap="round"
        />
        <circle cx="85" cy="30" r="12" fill="#f36" />
        <text
          x="85"
          y="35"
          text-anchor="middle"
          fill="white"
          font-size="16"
          font-weight="bold"
        >
          !
        </text>
      </svg>
      <h1>CYBER DETECTIVE</h1>
      <div id="loader-percent">0%</div>
      <div id="loader-bar-container"><div id="loader-bar"></div></div>
      <div id="loader-text">Inicjalizacja...</div>
    </div>
    <div id="intro">
      <h1>CYBER DETECTIVE</h1>
      <p>≈öledczy ds. Cyberprzestƒôpczo≈õci</p>
      <div
        style="
          text-align: left;
          background: #1a1a2e;
          padding: 15px;
          border-radius: 10px;
          margin: 15px 0;
          max-height: 50vh;
          overflow-y: auto;
          font-size: 12px;
          line-height: 1.6;
        "
      >
        <h3 style="color: #0ff; margin-top: 0">üìã INSTRUKCJA GRY</h3>

        <p style="color: #fc0"><strong>üéØ CEL GRY:</strong></p>
        <p>
          Jeste≈õ detektywem cyfrowym. Analizujesz dowody cyberprzestƒôpstw i
          przedstawiasz sprawy w sƒÖdzie lub na policji. Zarabiasz pieniƒÖdze za
          poprawne wnioski, tracisz za b≈Çƒôdy!
        </p>

        <p style="color: #fc0"><strong>üè¢ LOKALIZACJE W BIURZE:</strong></p>
        <p>
          ‚Ä¢ <strong>üö™ DRZWI</strong> - przyjmowanie nowych klient√≥w<br />
          ‚Ä¢ <strong>üíª KOMPUTER</strong> - analiza dowod√≥w i wysy≈Çanie spraw<br />
          ‚Ä¢ <strong>üõí SKLEP</strong> - kupowanie narzƒôdzi forensycznych
        </p>

        <p style="color: #fc0">
          <strong>üî¨ ANALIZA DOWOD√ìW (przy komputerze):</strong>
        </p>
        <p>
          1. Wejd≈∫ w zak≈Çadkƒô <strong>üìÅ SPRAWY</strong><br />
          2. Wybierz sprawƒô i kliknij <strong>üîç ANALIZUJ</strong><br />
          3. U≈ºyj narzƒôdzi do zbadania dowodu:<br />
          &nbsp;&nbsp;‚Ä¢ <strong>üîç Lupa</strong> - powiƒôkszenie 2.5x
          (darmowa)<br />
          &nbsp;&nbsp;‚Ä¢ <strong>üìä Meta</strong> - metadane pliku (800üí∞)<br />
          &nbsp;&nbsp;‚Ä¢ <strong>‚ö° ELA</strong> - analiza b≈Çƒôd√≥w kompresji
          (1500üí∞)<br />
          &nbsp;&nbsp;‚Ä¢ <strong>üî§ Font</strong> - sprawdzenie czcionek
          (1000üí∞)<br />
          &nbsp;&nbsp;‚Ä¢ <strong>üïê Czas</strong> - analiza znacznik√≥w czasowych
          (1200üí∞)<br />
          &nbsp;&nbsp;‚Ä¢ <strong>ü§ñ AI</strong> - wykrywanie AI/deepfake
          (3000üí∞)<br />
          4. Na podstawie wynik√≥w zaznacz:
          <strong style="color: #f36">‚ùå FA≈ÅSZ</strong> lub
          <strong style="color: #0f8">‚úì OK</strong>
        </p>

        <p style="color: #fc0"><strong>üì§ WYSY≈ÅANIE SPRAWY:</strong></p>
        <p>
          1. Wejd≈∫ w zak≈Çadkƒô <strong>üì§ WY≈öLIJ</strong><br />
          2. Wybierz sprawƒô z listy<br />
          3. (Opcjonalnie) Kliknij <strong>ü§µ PO≈öREDNIK</strong> - porada za
          50üí∞<br />
          4. Wybierz instytucjƒô:<br />
          &nbsp;&nbsp;‚Ä¢ <strong>üöî POLICJA</strong> - gro≈∫by, stalking,
          przemoc<br />
          &nbsp;&nbsp;‚Ä¢ <strong>‚öñÔ∏è SƒÑD</strong> - znies≈Çawienie, oszustwa
          cywilne<br />
          5. Kliknij <strong>üì§ WY≈öLIJ</strong>
        </p>

        <p style="color: #fc0"><strong>‚öñÔ∏è ROZPRAWA / PRZES≈ÅUCHANIE:</strong></p>
        <p>
          Po wys≈Çaniu sprawy trafisz do sƒÖdu lub na policjƒô. Musisz odpowiadaƒá
          na pytania!<br />
          ‚Ä¢ U≈ºywaj <strong>s≈Ç√≥w kluczowych</strong> ze sprawy (imiona, miejsca,
          szczeg√≥≈Çy)<br />
          ‚Ä¢ Twoje zeznania muszƒÖ byƒá <strong>SP√ìJNE</strong> z tym co
          zaznaczy≈Çe≈õ!<br />
          ‚Ä¢ Je≈õli zaznaczy≈Çe≈õ FA≈ÅSZ ‚Üí m√≥w ≈ºe dow√≥d jest fa≈Çszywy<br />
          ‚Ä¢ Je≈õli zaznaczy≈Çe≈õ OK ‚Üí m√≥w ≈ºe dow√≥d jest prawdziwy
        </p>

        <p style="color: #f36">
          <strong>‚ö†Ô∏è UWAGA - KLIENT MO≈ªE K≈ÅAMAƒÜ!</strong>
        </p>
        <p>
          Niekt√≥rzy klienci sami fa≈ÇszujƒÖ dowody ≈ºeby wrobiƒá niewinnych! Je≈õli
          analiza wyka≈ºe ≈ºe to KLIENT sfa≈Çszowa≈Ç dow√≥d - oskar≈º JEGO w
          zeznaniach! (np. "klient k≈Çamie", "klient sfa≈Çszowa≈Ç")
        </p>

        <p style="color: #fc0">
          <strong>üí∞ SYSTEM OP≈ÅAT ZA NARZƒòDZIA:</strong>
        </p>
        <p>
          Ka≈ºde kupione narzƒôdzie pobiera
          <strong style="color: #f36">% z ka≈ºdej wyp≈Çaty</strong>!<br />
          &nbsp;&nbsp;‚Ä¢ üìä Meta = <strong>5%</strong> z wyp≈Çat<br />
          &nbsp;&nbsp;‚Ä¢ üî§ Font = <strong>6%</strong> z wyp≈Çat<br />
          &nbsp;&nbsp;‚Ä¢ üïê Czas = <strong>8%</strong> z wyp≈Çat<br />
          &nbsp;&nbsp;‚Ä¢ ‚ö° ELA = <strong>10%</strong> z wyp≈Çat<br />
          &nbsp;&nbsp;‚Ä¢ ü§ñ AI = <strong>15%</strong> z wyp≈Çat<br />
          Wszystkie narzƒôdzia razem =
          <strong style="color: #f36">44% podatku!</strong><br />
          Mo≈ºesz <strong style="color: #0f8">sprzedaƒá</strong> narzƒôdzie za 5%
          jego warto≈õci ≈ºeby pozbyƒá siƒô op≈Çaty.
        </p>

        <p style="color: #fc0"><strong>üí∞ NAGRODY I KARY:</strong></p>
        <p>
          ‚Ä¢ ‚úÖ Poprawna analiza + dobre zeznania =
          <strong style="color: #0f8">+150% nagrody</strong><br />
          ‚Ä¢ ‚úÖ Poprawna analiza =
          <strong style="color: #0f8">+100% nagrody</strong><br />
          ‚Ä¢ ‚ö†Ô∏è S≈Çabe zeznania =
          <strong style="color: #f90">+50% lub mniej</strong><br />
          ‚Ä¢ ‚ùå B≈Çƒôdna analiza = <strong style="color: #f36">GRZYWNA</strong
          ><br />
          ‚Ä¢ ‚ùå Sprzeczne zeznania = <strong style="color: #f36">GRZYWNA</strong
          ><br />
          ‚Ä¢ ‚ùå Fa≈Çszywe oskar≈ºenie =
          <strong style="color: #f36">ZAWIESZENIE 2h!</strong>
        </p>

        <p style="color: #0ff"><strong>üí° WSKAZ√ìWKI:</strong></p>
        <p>
          ‚Ä¢ Czytaj uwa≈ºnie historiƒô klienta - tam sƒÖ wskaz√≥wki!<br />
          ‚Ä¢ Sprawd≈∫ WSZYSTKIE narzƒôdzia przed ocenƒÖ<br />
          ‚Ä¢ Pamiƒôtaj co zaznaczy≈Çe≈õ - sƒôdzia/policja o to zapyta!<br />
          ‚Ä¢ Nie spiesz siƒô - b≈Çƒôdy kosztujƒÖ!
        </p>
      </div>
      <button id="start-btn">‚ñ∂ ROZPOCZNIJ GRƒò</button>
    </div>
    <canvas id="canvas"></canvas>
    <div id="crosshair"></div>
    <div id="prompt"></div>
    <div id="touch-btn">üëÜ WEJD≈π</div>
    <div id="hud">
      <div>üí∞ <span id="hud-credits">500</span></div>
      <div>üìã <span id="hud-cases">0</span></div>
      <div>üìÖ Dzie≈Ñ <span id="hud-day">1</span></div>
      <div style="color: #f90">üìâ <span id="hud-tax">0%</span></div>
    </div>
    <div id="computer">
      <div id="computer-bar">
        <span>üñ•Ô∏è TERMINAL</span><button id="exit-btn">‚úï</button>
      </div>
      <div id="computer-main">
        <div id="sidebar">
          <div class="nav-item active" data-panel="case">üìã</div>
          <div class="nav-item" data-panel="send">üì§</div>
          <div class="nav-item" data-panel="inbox">üì¨</div>
          <div class="nav-item" data-panel="shop">üõí</div>
          <div class="nav-item" data-panel="archive">üìÅ</div>
        </div>
        <div id="content"></div>
      </div>
    </div>
    <div id="analysis">
      <div id="analysis-header">
        <h2>üî¨ ANALIZA</h2>
        <button id="close-analysis">‚úï</button>
      </div>
      <div id="analysis-body">
        <div id="img-viewer"><img id="analysis-img" src="" /></div>
        <div id="tools-panel"></div>
      </div>
    </div>
    <div id="visitor">
      <div id="visitor-box">
        <div class="visitor-head">
          <div class="visitor-avatar" id="v-avatar">üë§</div>
          <div>
            <h3 id="v-name" style="color: #fff">Klient</h3>
            <p style="color: #0f8">Op≈Çata: <span id="v-fee">100</span>üí∞</p>
          </div>
        </div>
        <div id="visitor-complaint"></div>
        <p style="color: #f90; font-size: 12px">
          ‚è∞ Termin: <span id="v-deadline">3</span> dni | Kara:
          <span id="v-penalty">200</span>üí∞
        </p>
        <div class="visitor-btns" style="margin-top: 15px">
          <button id="btn-accept">‚úì PRZYJMIJ</button
          ><button id="btn-reject">‚úï ODRZUƒÜ</button>
        </div>
      </div>
    </div>
    <div id="result">
      <div id="result-box">
        <div id="result-icon">‚úì</div>
        <h2 id="result-title">SUKCES!</h2>
        <p id="result-msg"></p>
        <p id="result-reward">+300üí∞</p>
        <button id="continue-btn">DALEJ ‚Üí</button>
      </div>
    </div>
    <div id="notif">
      <h4 id="notif-title">Info</h4>
      <p id="notif-msg">Msg</p>
    </div>
    <div
      id="client-chat"
      style="
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.95);
        z-index: 650;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 15px;
      "
    >
      <div
        style="
          background: #1a1a2e;
          border: 2px solid #0ff;
          border-radius: 15px;
          padding: 20px;
          max-width: 500px;
          width: 100%;
          max-height: 80vh;
          overflow-y: auto;
        "
      >
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
          "
        >
          <h3 style="color: #0ff; font-family: Orbitron" id="chat-client-name">
            üí¨ Klient
          </h3>
          <button
            id="close-chat"
            style="
              background: #f36;
              color: #fff;
              border: none;
              padding: 5px 12px;
              border-radius: 5px;
              cursor: pointer;
            "
          >
            ‚úï
          </button>
        </div>
        <div
          id="chat-messages"
          style="
            background: #0a0a12;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
            min-height: 150px;
            max-height: 300px;
            overflow-y: auto;
          "
        ></div>
        <textarea
          id="chat-input"
          placeholder="Napisz do klienta..."
          style="
            width: 100%;
            background: #0a0a12;
            border: 2px solid #2a2a4e;
            color: #fff;
            padding: 10px;
            border-radius: 8px;
            min-height: 60px;
            resize: none;
            margin-bottom: 10px;
          "
        ></textarea>
        <button
          id="chat-send"
          style="
            width: 100%;
            background: linear-gradient(135deg, #0ff, #0f8);
            color: #000;
            border: none;
            padding: 12px;
            font-family: Orbitron;
            cursor: pointer;
            border-radius: 8px;
          "
        >
          üì§ WY≈öLIJ
        </button>
      </div>
    </div>
    <div
      id="mediator-chat"
      style="
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.95);
        z-index: 650;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 15px;
      "
    >
      <div
        style="
          background: #1a1a2e;
          border: 2px solid #fc0;
          border-radius: 15px;
          padding: 20px;
          max-width: 500px;
          width: 100%;
          max-height: 80vh;
          overflow-y: auto;
        "
      >
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
          "
        >
          <h3 style="color: #fc0; font-family: Orbitron">ü§µ PO≈öREDNIK</h3>
          <button
            id="close-mediator"
            style="
              background: #f36;
              color: #fff;
              border: none;
              padding: 5px 12px;
              border-radius: 5px;
              cursor: pointer;
            "
          >
            ‚úï
          </button>
        </div>
        <p style="color: #888; font-size: 12px; margin-bottom: 10px">
          Rozmowa za darmo | Porada: <span style="color: #fc0">50üí∞</span>
        </p>
        <div
          id="mediator-messages"
          style="
            background: #0a0a12;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
            min-height: 150px;
            max-height: 300px;
            overflow-y: auto;
          "
        ></div>
        <textarea
          id="mediator-input"
          placeholder="Opisz sprawƒô po≈õrednikowi..."
          style="
            width: 100%;
            background: #0a0a12;
            border: 2px solid #2a2a4e;
            color: #fff;
            padding: 10px;
            border-radius: 8px;
            min-height: 60px;
            resize: none;
            margin-bottom: 10px;
          "
        ></textarea>
        <button
          id="mediator-send"
          style="
            width: 100%;
            background: linear-gradient(135deg, #fc0, #f90);
            color: #000;
            border: none;
            padding: 12px;
            font-family: Orbitron;
            cursor: pointer;
            border-radius: 8px;
          "
        >
          üì§ WY≈öLIJ
        </button>
      </div>
    </div>
    <div id="client-chat">
      <div id="chat-box">
        <div id="chat-header">
          <h3 id="chat-client-name">üí¨ Chat</h3>
          <button id="chat-close">‚úï</button>
        </div>
        <div id="chat-messages"></div>
        <div id="chat-input">
          <textarea
            id="chat-textarea"
            placeholder="Napisz wiadomo≈õƒá..."
          ></textarea>
          <button id="chat-send">üì§</button>
        </div>
      </div>
    </div>
    <div id="scene-overlay">
      <canvas id="scene-canvas"></canvas>
      <div id="scene-ui">
        <div id="scene-dialogue">
          <div class="scene-speaker" id="scene-speaker">‚öñÔ∏è SƒòDZIA</div>
          <div id="scene-text">...</div>
        </div>
        <div id="scene-input">
          <textarea
            id="scene-textarea"
            placeholder="Twoja odpowied≈∫..."
          ></textarea>
          <button id="scene-submit">üì¢ ODPOWIEDZ</button>
        </div>
        <div id="scene-options"></div>
        <div id="scene-result">
          <h2 id="scene-verdict-title">WYROK</h2>
          <p id="scene-verdict-text"></p>
          <button id="scene-exit">ZAKO≈ÉCZ</button>
        </div>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
      var G = {
        credits: 500,
        day: 1,
        activeCases: [],
        selectedCase: null,
        inPC: false,
        tools: {
          zoom: true,
          meta: false,
          ela: false,
          font: false,
          time: false,
          ai: false,
        },
        results: {},
        completed: [],
        inbox: [],
        suspendedUntil: 0,
      };
      var sceneData = { type: null, caseData: null, correct: false, phase: 0 };
      var sceneScene,
        sceneCamera,
        sceneRenderer,
        sceneRotY = 0,
        sceneRotX = 0;
      var TOOLS = {
        zoom: { n: "üîç Lupa", p: 0, tax: 0 },
        meta: { n: "üìä Meta", p: 800, tax: 5 },
        ela: { n: "‚ö° ELA", p: 1500, tax: 10 },
        font: { n: "üî§ Font", p: 1000, tax: 6 },
        time: { n: "üïê Czas", p: 1200, tax: 8 },
        ai: { n: "ü§ñ AI", p: 3000, tax: 15 },
      };
      function getTotalTax() {
        var t = 0;
        for (var k in TOOLS) {
          if (G.tools[k] && TOOLS[k].tax) t += TOOLS[k].tax;
        }
        return t;
      }
      function sellTool(k) {
        if (!G.tools[k] || k == "zoom") return;
        var refund = Math.floor(TOOLS[k].p * 0.05);
        G.credits += refund;
        G.tools[k] = false;
        saveGame();
        updateHUD();
        notify("Sprzedano!", TOOLS[k].n + " +" + refund + "üí∞");
      }
      var CASES = [
        {
          id: 1,
          name: "Anna Nowak",
          avatar: "üë©",
          fee: 100,
          days: 3,
          pen: 200,
          rew: 400,
          fine: 200,
          type: "ZNIES≈ÅAWIENIE",
          complaint: "Fa≈Çszywe screeny Messenger",
          clientLies: false,
          fullStory:
            "Prowadzƒô sklep internetowy od 5 lat. Tydzie≈Ñ temu na Facebooku pojawi≈Çy siƒô screeny z Messengera gdzie niby przyznajƒô siƒô do oszukiwania klient√≥w na wadze produkt√≥w. Problem w tym ≈ºe NIGDY czego≈õ takiego nie napisa≈Çam! Straci≈Çam ju≈º 15 klient√≥w, ludzie piszƒÖ ≈ºe jestem oszustkƒÖ. Mam podejrzenia kto to zrobi≈Ç - moja by≈Ça pracownica Kasia, kt√≥rƒÖ zwolni≈Çam miesiƒÖc temu. Proszƒô o pomoc, to rujnuje m√≥j biznes!",
          keywords: [
            "sklep",
            "kasia",
            "pracownic",
            "zwolni",
            "messenger",
            "waga",
            "klient",
            "oszuk",
            "facebook",
            "screen",
          ],
          suspect: "Kasia - by≈Ça pracownica",
          evidence: [
            {
              id: "e1",
              tp: "MESSENGER",
              fake: true,
              txt: "Tak haha oszukujemy klient√≥w na wadze üòÇ Nikt siƒô nie kapnie!",
              ind: {
                meta: { s: 1, i: "Photoshop CC 2024 - plik edytowany" },
                ela: { s: 1, i: "Widoczne ≈õlady manipulacji przy tek≈õcie" },
                font: { s: 1, i: "Czcionka nie pasuje do Messengera" },
                time: { s: 1, i: "03:47 - klientka spa≈Ça o tej porze" },
                ai: { s: 1, i: "94% prawdopodobie≈Ñstwo manipulacji" },
              },
            },
          ],
        },
        {
          id: 2,
          name: "Marek Wi≈õniewski",
          avatar: "üë®‚Äçüíº",
          fee: 150,
          days: 4,
          pen: 300,
          rew: 500,
          fine: 250,
          type: "GRO≈πBY",
          complaint: "Gro≈∫by od by≈Çego wsp√≥lnika",
          clientLies: false,
          fullStory:
            'By≈Çem wsp√≥lnikiem w firmie IT z Tomkiem K. Rozstali≈õmy siƒô w z≈Çych stosunkach - oskar≈ºa≈Ç mnie o kradzie≈º kodu. Od 2 tygodni dostajƒô maile z gro≈∫bami. Pisze ≈ºe "zniszczy mnie i mojƒÖ rodzinƒô", "wie gdzie mieszkam", "po≈ºa≈Çujƒô". Bojƒô siƒô o ≈ºonƒô i dzieci. Zg≈Çosi≈Çem ju≈º na policjƒô ale powiedzieli ≈ºe potrzebujƒÖ dowod√≥w ≈ºe to on. Maile przychodzƒÖ z anonimowego adresu ale styl pisania to NA PEWNO Tomek.',
          keywords: [
            "tomek",
            "wsp√≥lnik",
            "firma",
            "it",
            "kod",
            "mail",
            "gro≈∫b",
            "rodzin",
            "≈ºon",
            "dzieci",
            "anonimow",
          ],
          suspect: "Tomek K. - by≈Çy wsp√≥lnik",
          evidence: [
            {
              id: "e2",
              tp: "EMAIL",
              fake: false,
              txt: "Zniszczƒô ciƒô i twojƒÖ rodzinƒô. Wiem gdzie mieszkasz. Wiem gdzie chodzi tw√≥j syn do szko≈Çy. Po≈ºa≈Çujesz ≈ºe siƒô ze mnƒÖ zadziera≈Çe≈õ.",
              ind: {
                meta: { s: 0, i: "Nag≈Ç√≥wek email oryginalny - serwer Gmail" },
                ela: { s: 0, i: "Brak ≈õlad√≥w edycji" },
                font: { s: 0, i: "Standardowa czcionka email" },
                time: { s: 0, i: "Znaczniki czasowe sp√≥jne" },
                ai: { s: 0, i: "6% - wiadomo≈õƒá autentyczna" },
              },
            },
          ],
        },
        {
          id: 3,
          name: "Katarzyna D.",
          avatar: "üë©‚Äçü¶∞",
          fee: 80,
          days: 2,
          pen: 150,
          rew: 350,
          fine: 175,
          type: "STALKING",
          complaint: "By≈Çy partner mnie ≈õledzi",
          clientLies: false,
          fullStory:
            'Rozsta≈Çam siƒô z Micha≈Çem 3 miesiƒÖce temu. Od tamtej pory non stop dostaje wiadomo≈õci ≈ºe mnie widzia≈Ç - w kawiarni, w pracy, w sklepie. Pisze dok≈Çadnie w co by≈Çam ubrana, z kim rozmawia≈Çam. Wczoraj napisa≈Ç ≈ºe "≈Çadnie mi w tej niebieskiej sukience" - a by≈Çam w niej tylko 2 godziny! Bojƒô siƒô wychodziƒá z domu. Mam screeny z WhatsApp. Proszƒô o pomoc, czujƒô siƒô obserwowana 24/7.',
          keywords: [
            "micha≈Ç",
            "partner",
            "whatsapp",
            "≈õledzi",
            "obserwu",
            "sukienk",
            "kawiarni",
            "ubran",
            "wiadomo",
            "boi",
          ],
          suspect: "Micha≈Ç - by≈Çy partner",
          evidence: [
            {
              id: "e3",
              tp: "WHATSAPP",
              fake: false,
              txt: "Widzia≈Çem ciƒô dzi≈õ w Starbucks o 14:30. ≈Åadna ta niebieska sukienka. Kawa z kole≈ºankƒÖ? Ta blondynka to Ania z pracy?",
              ind: {
                meta: { s: 0, i: "Oryginalny backup WhatsApp - iPhone" },
                ela: { s: 0, i: "Zrzut niemodyfikowany" },
                font: { s: 0, i: "Czcionka WhatsApp prawid≈Çowa" },
                time: { s: 0, i: "Znaczniki sp√≥jne z datƒÖ" },
                ai: { s: 0, i: "4% - wiadomo≈õƒá autentyczna" },
              },
            },
          ],
        },
        {
          id: 4,
          name: "Piotr Lewandowski",
          avatar: "üë®‚Äçüíª",
          fee: 120,
          days: 3,
          pen: 250,
          rew: 450,
          fine: 225,
          type: "PODSZYWANIE",
          complaint: "Fa≈Çszywe konto z rasizmem",
          clientLies: false,
          fullStory:
            "Jestem programistƒÖ, aktywnym na Twitterze/X. Kto≈õ stworzy≈Ç konto @PiotrLew_PRAWDA i publikuje rasistowskie i antysemickie tre≈õci. U≈ºywa mojego zdjƒôcia i nazwiska! Moi klienci my≈õlƒÖ ≈ºe to ja. Straci≈Çem ju≈º 2 kontrakty. Twitter nie reaguje na zg≈Çoszenia. Mam screeny tych post√≥w. Podejrzewam konkurencjƒô - firmƒô DataSoft, z kt√≥rƒÖ walczy≈Çem o du≈ºy kontrakt.",
          keywords: [
            "programist",
            "twitter",
            "datasoft",
            "konkurencj",
            "konto",
            "rasist",
            "zdjƒôci",
            "kontrakt",
            "podszywa",
            "fa≈Çszyw",
          ],
          suspect: "Firma DataSoft - konkurencja",
          evidence: [
            {
              id: "e4",
              tp: "TWITTER",
              fake: true,
              txt: "Imigranci won z Polski! Polska dla prawdziwych Polak√≥w! üáµüá± #wypierpol",
              ind: {
                meta: { s: 1, i: "Zrzut edytowany - Photoshop" },
                ela: { s: 1, i: "Avatar wklejony z innego ≈∫r√≥d≈Ça" },
                font: { s: 1, i: "Czcionka nie pasuje do X/Twitter" },
                time: { s: 0, i: "Data publikacji mo≈ºliwa" },
                ai: { s: 1, i: "91% - profil sfabrykowany" },
              },
            },
          ],
        },
        {
          id: 5,
          name: "Ewa Kami≈Ñska",
          avatar: "üë©‚Äçüíº",
          fee: 200,
          days: 3,
          pen: 400,
          rew: 600,
          fine: 300,
          type: "OSZUSTWO",
          complaint: "Wy≈Çudzenie na fa≈ÇszywƒÖ zbi√≥rkƒô",
          clientLies: false,
          fullStory:
            'Wp≈Çaci≈Çam 5000 z≈Ç na zbi√≥rkƒô "Pomoc dla chorego Jasia" na Facebooku. Zbi√≥rka wyglƒÖda≈Ça wiarygodnie - zdjƒôcia dziecka w szpitalu, dokumenty. Po wp≈Çacie profil zniknƒÖ≈Ç! Napisa≈Çam do szpitala kt√≥ry by≈Ç podany - powiedzieli ≈ºe nie majƒÖ takiego pacjenta. Mam screeny zbi√≥rki i potwierdzenie przelewu. Proszƒô o pomoc w znalezieniu oszusta!',
          keywords: [
            "zbi√≥rk",
            "5000",
            "jasio",
            "szpital",
            "facebook",
            "przelew",
            "profil",
            "zniknƒÖ≈Ç",
            "oszust",
            "chory",
          ],
          suspect: "Nieznany - fa≈Çszywa zbi√≥rka",
          evidence: [
            {
              id: "e5",
              tp: "FACEBOOK",
              fake: false,
              txt: "Zbi√≥rka: Pomoc dla chorego Jasia ‚ù§Ô∏è Cel: 50000 z≈Ç. Jasio ma 5 lat i walczy z bia≈ÇaczkƒÖ...",
              ind: {
                meta: { s: 0, i: "Zrzut oryginalny - Chrome" },
                ela: { s: 0, i: "Bez edycji" },
                font: { s: 0, i: "Czcionka FB prawid≈Çowa" },
                time: { s: 0, i: "Data sp√≥jna" },
                ai: {
                  s: 0,
                  i: "3% - zrzut autentyczny (ale zbi√≥rka fa≈Çszywa)",
                },
              },
            },
          ],
        },
        {
          id: 6,
          name: "Tomasz Kowalczyk",
          avatar: "üë®",
          fee: 90,
          days: 2,
          pen: 180,
          rew: 380,
          fine: 190,
          type: "GRO≈πBY",
          complaint: "Gro≈∫by przez SMS",
          clientLies: false,
          fullStory:
            "Od tygodnia dostajƒô SMS-y z nieznanego numeru. Gro≈ºƒÖ ≈ºe mnie zabijƒÖ, ≈ºe wiedzƒÖ gdzie pracujƒô. Podejrzewam ≈ºe to przez konflikt z sƒÖsiadem - pok≈Ç√≥cili≈õmy siƒô o miejsce parkingowe. On to typ agresywny, ju≈º raz mia≈Ç sprawƒô o pobicie. Numer jest na kartƒô wiƒôc nie wiem jak udowodniƒá ≈ºe to on.",
          keywords: [
            "sms",
            "sƒÖsiad",
            "parking",
            "pobici",
            "numer",
            "karta",
            "gro≈∫b",
            "zabij",
            "praca",
            "konflikt",
          ],
          suspect: "SƒÖsiad - konflikt o parking",
          evidence: [
            {
              id: "e6",
              tp: "SMS",
              fake: false,
              txt: "Zabijƒô ciƒô i ca≈ÇƒÖ twojƒÖ rodzinƒô skurwysynu. Wiem gdzie pracujesz. Uwa≈ºaj jak wychodzisz z roboty.",
              ind: {
                meta: { s: 0, i: "Zrzut Samsung - oryginalny" },
                ela: { s: 0, i: "Brak modyfikacji" },
                font: { s: 0, i: "Systemowa czcionka SMS" },
                time: { s: 0, i: "Daty wiadomo≈õci sp√≥jne" },
                ai: { s: 0, i: "5% - wiadomo≈õci autentyczne" },
              },
            },
          ],
        },
        {
          id: 7,
          name: "Magdalena Zieli≈Ñska",
          avatar: "üë©‚Äçüî¨",
          fee: 180,
          days: 4,
          pen: 350,
          rew: 550,
          fine: 275,
          type: "ZNIES≈ÅAWIENIE",
          complaint: "Fa≈Çszywy post o plagiacie",
          clientLies: false,
          fullStory:
            'Jestem doktorantkƒÖ na Politechnice. Na forum naukowym pojawi≈Ç siƒô post gdzie rzekomo przyznajƒô siƒô do plagiatu w pracy doktorskiej. Screenshot z Messengera gdzie piszƒô "skopiowa≈Çam 70% pracy, system antyplagiatowy tego nie wykry≈Ç". To NIEPRAWDA! Moja promotorka ju≈º ma wƒÖtpliwo≈õci. Podejrzewam zazdrosnƒÖ kole≈ºankƒô Anetƒô kt√≥ra te≈º pisze doktorat z tego tematu.',
          keywords: [
            "doktorant",
            "politechnik",
            "plagiat",
            "aneta",
            "kole≈ºank",
            "forum",
            "70%",
            "promotor",
            "praca",
            "screenshot",
          ],
          suspect: "Aneta - zazdrosna kole≈ºanka",
          evidence: [
            {
              id: "e7",
              tp: "FORUM POST",
              fake: true,
              txt: 'Screenshot rozmowy dr Zieli≈Ñskiej: "Tak, skopiowa≈Çam 70% pracy doktorskiej lol. System tego nie wykry≈Ç üòÇ"',
              ind: {
                meta: { s: 1, i: "Obraz edytowany - Canva" },
                ela: { s: 1, i: "Tekst wstawiony cyfrowo" },
                font: { s: 1, i: "Font nie pasuje do Messengera" },
                time: { s: 1, i: "Konto na forum za≈Ço≈ºone dzie≈Ñ przed postem" },
                ai: { s: 1, i: "89% - screenshot sfabrykowany" },
              },
            },
          ],
        },
        {
          id: 8,
          name: "Robert Adamski",
          avatar: "üë®‚Äçü¶≤",
          fee: 250,
          days: 5,
          pen: 500,
          rew: 700,
          fine: 350,
          type: "HACKING",
          complaint: "W≈Çamanie na konto bankowe",
          clientLies: false,
          fullStory:
            'W zesz≈Çym tygodniu kto≈õ w≈Çama≈Ç siƒô na moje konto w banku i przela≈Ç 12000 z≈Ç na zagraniczne konto. Bank m√≥wi ≈ºe logowanie by≈Ço z mojego urzƒÖdzenia ale to niemo≈ºliwe - by≈Çem w pracy! Podejrzewam phishing - tydzie≈Ñ wcze≈õniej dosta≈Çem dziwny mail "z banku". G≈Çupio kliknƒÖ≈Çem w link i wpisa≈Çem dane. Mam ten mail zapisany.',
          keywords: [
            "bank",
            "12000",
            "phishing",
            "mail",
            "link",
            "w≈Çaman",
            "przelew",
            "zagranic",
            "dane",
            "konto",
          ],
          suspect: "Nieznany haker - phishing",
          evidence: [
            {
              id: "e8",
              tp: "EMAIL PHISHING",
              fake: false,
              txt: "Szanowny Kliencie! Wykryli≈õmy podejrzanƒÖ aktywno≈õƒá. Kliknij aby zweryfikowaƒá: bank-weryfikacja.tk/login",
              ind: {
                meta: { s: 0, i: "Mail prawdziwy - nag≈Ç√≥wki potwierdzone" },
                ela: { s: 0, i: "Oryginalny mail phishingowy" },
                font: { s: 0, i: "Pr√≥ba imitacji banku" },
                time: { s: 0, i: "Wys≈Çany z serwera w Rosji" },
                ai: { s: 0, i: "2% - autentyczny mail phishingowy" },
              },
            },
          ],
        },
        {
          id: 9,
          name: "Alicja Pawlak",
          avatar: "üëß",
          fee: 60,
          days: 2,
          pen: 120,
          rew: 300,
          fine: 150,
          type: "GRO≈πBY",
          complaint: "Cyberprzemoc w szkole",
          clientLies: false,
          fullStory:
            'Moja c√≥rka Zuzia (13 lat) wraca ze szko≈Çy z p≈Çaczem. Na Snapchacie grupa "Zuzia to ofiara" gdzie kole≈ºanki z klasy piszƒÖ okropne rzeczy - ≈ºe jest brzydka, ≈ºe nikt jej nie lubi, ≈ºe powinna "zniknƒÖƒá". Wczoraj by≈Ço "jutro dostaniesz w twarz". Zuzia nie chce i≈õƒá do szko≈Çy. Dyrekcja m√≥wi ≈ºe "nie mogƒÖ nic zrobiƒá bo to poza szko≈ÇƒÖ". Mam screeny z jej telefonu.',
          keywords: [
            "zuzia",
            "c√≥rka",
            "szko≈Ça",
            "snapchat",
            "grupa",
            "kole≈ºank",
            "brzydka",
            "przemoc",
            "13 lat",
            "dyrekcj",
          ],
          suspect: "Kole≈ºanki z klasy",
          evidence: [
            {
              id: "e9",
              tp: "SNAPCHAT",
              fake: false,
              txt: 'Grupa "Zuzia to ofiara": "Jeste≈õ taka brzydka ü§Æ Nikt ciƒô nie lubi. Jutro dostaniesz w twarz loserko!!!"',
              ind: {
                meta: { s: 0, i: "Screenshot Snapchat - oryginalny" },
                ela: { s: 0, i: "Bez edycji" },
                font: { s: 0, i: "Czcionka Snapchat OK" },
                time: { s: 0, i: "Data sp√≥jna" },
                ai: { s: 0, i: "3% - wiadomo≈õci autentyczne" },
              },
            },
          ],
        },
        {
          id: 10,
          name: "Krzysztof Nowicki",
          avatar: "üë®‚Äçüíº",
          fee: 300,
          days: 5,
          pen: 600,
          rew: 800,
          fine: 400,
          type: "SZANTA≈ª",
          complaint: "Szanta≈º intymnymi zdjƒôciami",
          clientLies: false,
          fullStory:
            "Pozna≈Çem kogo≈õ na Tinderze, wymienili≈õmy kilka zdjƒôƒá... w tym intymne. Teraz ta osoba grozi ≈ºe wy≈õle je do mojej ≈ºony i do pracy je≈õli nie zap≈Çacƒô 10000 z≈Ç. Mam rodzinƒô, dobrƒÖ pracƒô w korporacji - to by mnie zniszczy≈Ço. Wiem ≈ºe to moja g≈Çupota ale proszƒô o pomoc. Osoba pisze z anonimowego maila przez Protonmail.",
          keywords: [
            "tinder",
            "zdjƒôci",
            "intymn",
            "≈ºona",
            "praca",
            "10000",
            "szanta≈º",
            "protonmail",
            "anonimow",
            "bitcoin",
            "btc",
          ],
          suspect: "Nieznany - szanta≈ºysta z Tindera",
          evidence: [
            {
              id: "e10",
              tp: "EMAIL",
              fake: false,
              txt: "Mam twoje zdjƒôcia. Wiem gdzie pracujesz - [nazwa firmy]. Mam FB twojej ≈ºony. 10000 z≈Ç na BTC albo wszyscy zobaczƒÖ.",
              ind: {
                meta: { s: 0, i: "Email przez Protonmail - anonimowy" },
                ela: { s: 0, i: "Oryginalny email" },
                font: { s: 0, i: "Standardowy format" },
                time: { s: 0, i: "Wys≈Çany przez sieƒá TOR" },
                ai: { s: 0, i: "4% - prawdziwy szanta≈º" },
              },
            },
          ],
        },
        {
          id: 11,
          name: "Damian Krawczyk",
          avatar: "üë®‚Äçü¶±",
          fee: 180,
          days: 3,
          pen: 350,
          rew: 500,
          fine: 400,
          type: "ZNIES≈ÅAWIENIE",
          complaint: "By≈Çy pracodawca mnie oczernia",
          clientLies: true,
          fullStory:
            "M√≥j by≈Çy szef Janusz z firmy BudMal pisze o mnie k≈Çamstwa na forach budowlanych! Twierdzi ≈ºe krad≈Çem materia≈Çy i oszukiwa≈Çem klient√≥w. To NIEPRAWDA! Przez niego nie mogƒô znale≈∫ƒá pracy w bran≈ºy. Mam screeny jego post√≥w. Chcƒô go pozwaƒá!",
          keywords: [
            "janusz",
            "budmal",
            "szef",
            "forum",
            "krad≈Ç",
            "materia≈Ç",
            "praca",
            "bran≈º",
            "post",
          ],
          suspect: "Janusz - by≈Çy szef",
          evidence: [
            {
              id: "e11",
              tp: "FORUM",
              fake: true,
              txt: "UWAGA na Damiana K.! Pracowa≈Ç u mnie i krad≈Ç materia≈Çy budowlane. Oszukiwa≈Ç te≈º klient√≥w na metra≈ºu. Nie zatrudniajcie!",
              ind: {
                meta: { s: 1, i: "Screenshot edytowany - Paint.NET" },
                ela: { s: 1, i: "Tekst wklejony cyfrowo" },
                font: { s: 1, i: "Font nie pasuje do forum" },
                time: {
                  s: 1,
                  i: "Post datowany na dzie≈Ñ wolny - forum zamkniƒôte",
                },
                ai: { s: 1, i: "92% - screenshot sfabrykowany przez KLIENTA" },
              },
            },
          ],
        },
        {
          id: 12,
          name: "Natalia Wo≈∫niak",
          avatar: "üë©‚Äçüé§",
          fee: 150,
          days: 3,
          pen: 300,
          rew: 450,
          fine: 350,
          type: "GRO≈πBY",
          complaint: "Stalker grozi mi ≈õmierciƒÖ",
          clientLies: true,
          fullStory:
            "Jestem influencerkƒÖ na Instagramie. Od miesiƒÖca dostajƒô wiadomo≈õci od stalkera kt√≥ry grozi ≈ºe mnie zabije! Pisze z anonimowego konta. Bojƒô siƒô wychodziƒá z domu. Mam screeny tych wiadomo≈õci. Proszƒô o pomoc!",
          keywords: [
            "instagram",
            "stalker",
            "grozi",
            "anonimow",
            "wiadomo",
            "influencer",
            "zabij",
            "konto",
            "dm",
          ],
          suspect: "Anonimowy stalker",
          evidence: [
            {
              id: "e12",
              tp: "INSTAGRAM DM",
              fake: true,
              txt: "Wiem gdzie mieszkasz suko. Obserwujƒô ciƒô codziennie. Nied≈Çugo ciƒô dorwƒô i zabijƒô!!! üî™",
              ind: {
                meta: { s: 1, i: "Screenshot utworzony w Photoshop" },
                ela: { s: 1, i: "Interfejs IG niezgodny z wersjƒÖ" },
                font: { s: 1, i: "Czcionka nie pasuje do Instagram" },
                time: { s: 1, i: "Timestamp niemo≈ºliwy - format b≈Çƒôdny" },
                ai: { s: 1, i: "96% - KLIENTKA sama stworzy≈Ça te screeny" },
              },
            },
          ],
        },
        {
          id: 13,
          name: "Bartosz Maj",
          avatar: "üë®‚Äçüíª",
          fee: 200,
          days: 4,
          pen: 400,
          rew: 550,
          fine: 450,
          type: "HACKING",
          complaint: "Kto≈õ w≈Çama≈Ç siƒô na moje konto",
          clientLies: true,
          fullStory:
            "Kto≈õ w≈Çama≈Ç siƒô na moje konto bankowe i zrobi≈Ç przelew na 8000 z≈Ç! Bank nie chce oddaƒá pieniƒôdzy bo m√≥wiƒÖ ≈ºe logowanie by≈Ço z mojego IP. Ale ja nie robi≈Çem tego przelewu! Mam potwierdzenie z banku. To musia≈Ç byƒá haker!",
          keywords: [
            "bank",
            "8000",
            "przelew",
            "ip",
            "w≈Çaman",
            "haker",
            "konto",
            "logowani",
            "pieniƒÖd",
          ],
          suspect: "Nieznany haker",
          evidence: [
            {
              id: "e13",
              tp: "POTWIERDZENIE PRZELEWU",
              fake: false,
              txt: 'Przelew: 8000 z≈Ç | Odbiorca: Konto Bartosza M. (drugie konto) | Tytu≈Ç: "zwrot"',
              ind: {
                meta: { s: 0, i: "Dokument oryginalny z banku" },
                ela: { s: 0, i: "Brak edycji" },
                font: { s: 0, i: "Oficjalny format bankowy" },
                time: { s: 0, i: "Data i godzina sp√≥jne" },
                ai: {
                  s: 0,
                  i: "2% - KLIENT sam przela≈Ç na swoje drugie konto!",
                },
              },
            },
          ],
        },
      ];
      function speak(text, voice) {
        if (!("speechSynthesis" in window)) return;
        var u = new SpeechSynthesisUtterance(text);
        u.lang = "pl-PL";
        u.rate = 0.9;
        if (voice == "judge") {
          u.pitch = 0.8;
          u.rate = 0.85;
        } else if (voice == "defense") {
          u.pitch = 1.1;
          u.rate = 1.0;
        } else if (voice == "police") {
          u.pitch = 0.9;
          u.rate = 0.95;
        }
        speechSynthesis.speak(u);
      }
      function genImg(e) {
        var c = document.createElement("canvas");
        c.width = 300;
        c.height = 150;
        var x = c.getContext("2d");
        x.fillStyle = "#1a1a2e";
        x.fillRect(0, 0, 300, 150);
        x.fillStyle = "#0ff";
        x.font = "bold 11px Arial";
        x.fillText(e.tp, 10, 18);
        x.fillStyle = "#fff";
        x.font = "11px Arial";
        var w = e.txt.split(" "),
          l = "",
          y = 40;
        for (var i = 0; i < w.length; i++) {
          if ((l + w[i]).length > 38) {
            x.fillText(l, 10, y);
            y += 14;
            l = "";
          }
          l += w[i] + " ";
        }
        x.fillText(l, 10, y);
        return c.toDataURL();
      }
      function saveGame() {
        try {
          localStorage.setItem(
            "cyberdetective",
            JSON.stringify({
              credits: G.credits,
              day: G.day,
              tools: G.tools,
              completed: G.completed,
              inbox: G.inbox,
              suspendedUntil: G.suspendedUntil,
              activeCases: G.activeCases,
              selectedCase: G.selectedCase,
              results: G.results,
            })
          );
        } catch (e) {
          console.log("Save error", e);
        }
      }
      function loadGame() {
        try {
          var s = localStorage.getItem("cyberdetective");
          if (s) {
            var d = JSON.parse(s);
            G.credits = d.credits !== undefined ? d.credits : 500;
            G.day = d.day || 1;
            G.tools = d.tools || {
              zoom: true,
              meta: false,
              ela: false,
              font: false,
              time: false,
              ai: false,
            };
            G.completed = d.completed || [];
            G.inbox = d.inbox || [];
            G.suspendedUntil = d.suspendedUntil || 0;
            G.activeCases = d.activeCases || [];
            G.selectedCase =
              d.selectedCase !== undefined ? d.selectedCase : null;
            G.results = d.results || {};
            for (var i = 0; i < G.activeCases.length; i++) {
              for (var j = 0; j < G.activeCases[i].evidence.length; j++) {
                G.activeCases[i].evidence[j].img = genImg(
                  G.activeCases[i].evidence[j]
                );
              }
            }
            return true;
          }
        } catch (e) {
          console.log("Load error", e);
        }
        return false;
      }
      function checkSuspension() {
        if (G.suspendedUntil > Date.now()) {
          document.getElementById("loader").style.display = "none";
          document.getElementById("suspended").style.display = "flex";
          updateSuspendTimer();
          return true;
        }
        return false;
      }
      function updateSuspendTimer() {
        var left = G.suspendedUntil - Date.now();
        if (left <= 0) {
          G.suspendedUntil = 0;
          saveGame();
          location.reload();
          return;
        }
        var h = Math.floor(left / 3600000);
        var m = Math.floor((left % 3600000) / 60000);
        var s = Math.floor((left % 60000) / 1000);
        document.getElementById("suspend-time").textContent =
          (h < 10 ? "0" : "") +
          h +
          ":" +
          (m < 10 ? "0" : "") +
          m +
          ":" +
          (s < 10 ? "0" : "") +
          s;
        setTimeout(updateSuspendTimer, 1000);
      }
      function suspendPlayer(hours) {
        G.suspendedUntil = Date.now() + hours * 3600000;
        saveGame();
        document.getElementById("scene-overlay").style.display = "none";
        document.getElementById("suspended").style.display = "flex";
        updateSuspendTimer();
      }
      loadGame();
      var loadSteps = [
        "Inicjalizacja...",
        "≈Åadowanie interfejsu...",
        "Wczytywanie spraw...",
        "Konfiguracja narzƒôdzi...",
        "Weryfikacja...",
        "System gotowy!",
      ];
      function runLoader() {
        if (checkSuspension()) return;
        var bar = document.getElementById("loader-bar"),
          pct = document.getElementById("loader-percent"),
          txt = document.getElementById("loader-text"),
          prog = 0;
        var iv = setInterval(function () {
          prog += Math.random() * 20 + 5;
          if (prog > 100) prog = 100;
          bar.style.width = prog + "%";
          pct.textContent = Math.floor(prog) + "%";
          txt.textContent = loadSteps[Math.min(Math.floor(prog / 20), 5)];
          if (prog >= 100) {
            clearInterval(iv);
            setTimeout(function () {
              document.getElementById("loader").style.display = "none";
              document.getElementById("intro").style.display = "flex";
            }, 400);
          }
        }, 200);
      }
      window.onload = runLoader;
      var scene,
        camera,
        renderer,
        objs = [],
        rotY = 0,
        rotX = 0,
        lookAt = null;
      function init3D() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0a0a15);
        camera = new THREE.PerspectiveCamera(
          70,
          innerWidth / innerHeight,
          0.1,
          100
        );
        camera.position.set(0, 1.6, 0);
        renderer = new THREE.WebGLRenderer({
          canvas: document.getElementById("canvas"),
          antialias: true,
        });
        renderer.setSize(innerWidth, innerHeight);
        scene.add(new THREE.AmbientLight(0x1a2a4a, 0.5));
        var fl = new THREE.Mesh(
          new THREE.PlaneGeometry(10, 10),
          new THREE.MeshBasicMaterial({ color: 0x2a1810 })
        );
        fl.rotation.x = -Math.PI / 2;
        scene.add(fl);
        var dr = new THREE.Mesh(
          new THREE.BoxGeometry(2, 2.9, 0.1),
          new THREE.MeshBasicMaterial({ color: 0x4a3020 })
        );
        dr.position.set(0, 1.45, 4.9);
        dr.userData = { type: "door" };
        objs.push(dr);
        scene.add(dr);
        var mn = new THREE.Mesh(
          new THREE.BoxGeometry(1.2, 0.7, 0.05),
          new THREE.MeshBasicMaterial({ color: 0x003355 })
        );
        mn.position.set(0, 1.35, -3.2);
        mn.userData = { type: "pc" };
        objs.push(mn);
        scene.add(mn);
        animate();
      }
      function animate() {
        requestAnimationFrame(animate);
        camera.rotation.order = "YXZ";
        camera.rotation.y = rotY;
        camera.rotation.x = rotX;
        var ray = new THREE.Raycaster();
        ray.setFromCamera({ x: 0, y: 0 }, camera);
        var hits = ray.intersectObjects(objs);
        var pr = document.getElementById("prompt"),
          tb = document.getElementById("touch-btn");
        if (hits.length && hits[0].distance < 6) {
          lookAt = hits[0].object;
          var t = lookAt.userData.type == "pc" ? "KOMPUTER" : "DRZWI";
          pr.textContent = "üëÜ " + t;
          pr.style.opacity = "1";
          if (!G.inPC) {
            tb.style.display = "block";
            tb.textContent = "üëÜ " + t;
          }
        } else {
          lookAt = null;
          pr.style.opacity = "0";
          tb.style.display = "none";
        }
        renderer.render(scene, camera);
      }
      var md = false;
      document.onmousedown = function (e) {
        md = true;
        if (e.button == 0 && lookAt && !G.inPC) interact(lookAt);
      };
      document.onmouseup = function () {
        md = false;
      };
      document.onmousemove = function (e) {
        if (md && !G.inPC) {
          rotY -= e.movementX * 0.003;
          rotX = Math.max(-1, Math.min(1, rotX - e.movementY * 0.003));
        }
      };
      var tx = 0,
        ty = 0,
        tt = false,
        tm = false;
      document.ontouchstart = function (e) {
        if (
          G.inPC ||
          e.target.closest(
            "#computer,#visitor,#analysis,#result,#intro,#scene-overlay"
          )
        )
          return;
        tt = true;
        tm = false;
        tx = e.touches[0].clientX;
        ty = e.touches[0].clientY;
      };
      document.ontouchmove = function (e) {
        if (!tt || G.inPC) return;
        var dx = e.touches[0].clientX - tx,
          dy = e.touches[0].clientY - ty;
        if (Math.abs(dx) > 5 || Math.abs(dy) > 5) tm = true;
        rotY -= dx * 0.006;
        rotX = Math.max(-1, Math.min(1, rotX - dy * 0.006));
        tx = e.touches[0].clientX;
        ty = e.touches[0].clientY;
      };
      document.ontouchend = function () {
        if (!tt) return;
        tt = false;
        if (!tm && lookAt && !G.inPC) interact(lookAt);
      };
      function interact(o) {
        if (o.userData.type == "pc") enterPC();
        else spawnVisitor();
      }
      function enterPC() {
        G.inPC = true;
        document.getElementById("computer").style.display = "flex";
        document.getElementById("crosshair").style.display = "none";
        document.getElementById("prompt").style.opacity = "0";
        document.getElementById("touch-btn").style.display = "none";
        initNav();
        renderPanel("case");
      }
      function exitPC() {
        G.inPC = false;
        document.getElementById("computer").style.display = "none";
        document.getElementById("crosshair").style.display = "block";
      }
      document.getElementById("exit-btn").onclick = exitPC;
      function initNav() {
        var items = document.querySelectorAll(".nav-item");
        for (var i = 0; i < items.length; i++) {
          items[i].onclick = items[i].ontouchend = function (e) {
            e.preventDefault();
            for (var j = 0; j < items.length; j++)
              items[j].classList.remove("active");
            this.classList.add("active");
            renderPanel(this.dataset.panel);
          };
        }
      }
      function updateHUD() {
        document.getElementById("hud-credits").textContent = G.credits;
        document.getElementById("hud-cases").textContent = G.activeCases.length;
        document.getElementById("hud-day").textContent = G.day;
        var tax = getTotalTax();
        var taxEl = document.getElementById("hud-tax");
        if (taxEl) taxEl.textContent = tax + "%";
      }
      function notify(t, m) {
        document.getElementById("notif-title").textContent = t;
        document.getElementById("notif-msg").textContent = m;
        document.getElementById("notif").style.display = "block";
        setTimeout(function () {
          document.getElementById("notif").style.display = "none";
        }, 2500);
      }
      function renderPanel(p) {
        var c = document.getElementById("content");
        if (p == "case") c.innerHTML = renderCase();
        else if (p == "send") c.innerHTML = renderSend();
        else if (p == "inbox") c.innerHTML = renderInbox();
        else if (p == "shop") c.innerHTML = renderShop();
        else if (p == "archive") c.innerHTML = renderArchive();
        bindEvents(p);
      }
      function renderCase() {
        if (!G.activeCases.length)
          return '<div class="panel"><h2>üìã Brak Spraw</h2><p style="color:#888">Id≈∫ do DRZWI aby przyjƒÖƒá klienta.</p></div>';
        var h =
          '<div class="panel"><h2>üìã Aktywne Sprawy (' +
          G.activeCases.length +
          ")</h2>";
        for (var i = 0; i < G.activeCases.length; i++) {
          var c = G.activeCases[i],
            left = c.days - (G.day - c.startDay),
            ready = c.evidence[0].verified;
          h +=
            '<div class="case-card' +
            (G.selectedCase == i ? " active" : "") +
            '" data-idx="' +
            i +
            '"><h4>' +
            c.avatar +
            " " +
            c.name +
            "</h4><p>" +
            c.type +
            " | ‚è∞" +
            left +
            " dni | " +
            (ready ? "‚úÖ Gotowe" : "üîç Analizuj") +
            "</p></div>";
        }
        h += "</div>";
        if (G.selectedCase !== null && G.activeCases[G.selectedCase]) {
          var c = G.activeCases[G.selectedCase];
          h +=
            '<div class="panel"><h3 style="color:#fff;margin-bottom:10px">' +
            c.avatar +
            " " +
            c.name +
            " - " +
            c.type +
            '</h3><p style="color:#888;font-size:12px;margin-bottom:10px;line-height:1.5">' +
            c.fullStory +
            '</p><button class="chat-client-btn" data-cidx="' +
            G.selectedCase +
            '" style="background:#0ff;color:#000;border:none;padding:8px 15px;border-radius:5px;cursor:pointer;margin-bottom:15px">üí¨ Napisz do klienta</button><h4 style="color:#0ff;margin-bottom:10px">üìé Dowody:</h4><div class="evidence-grid">';
          for (var j = 0; j < c.evidence.length; j++) {
            var e = c.evidence[j];
            h +=
              '<div class="evidence-card" data-eid="' +
              e.id +
              '"><div class="evidence-img"><img src="' +
              e.img +
              '"></div><span class="badge ' +
              (e.verified
                ? e.verdict
                  ? "badge-fake"
                  : "badge-ok"
                : "badge-pending") +
              '">' +
              (e.verified
                ? e.verdict
                  ? "‚ö†Ô∏è FA≈ÅSZ"
                  : "‚úÖ OK"
                : "‚ùì Analizuj") +
              "</span></div>";
          }
          h += "</div></div>";
        }
        return h;
      }
      function renderSend() {
        var ready = G.activeCases.filter(function (c) {
          return c.evidence[0].verified;
        });
        if (!ready.length)
          return '<div class="panel"><h2>üì§ Wy≈õlij</h2><p style="color:#f90">Przeanalizuj dowody!</p></div>';
        var h =
          '<div class="panel"><h2>üì§ Wy≈õlij</h2><select id="case-sel" style="width:100%;padding:10px;background:#1a1a2e;border:1px solid #2a2a4e;color:#fff;border-radius:5px;margin-bottom:10px">';
        for (var i = 0; i < ready.length; i++) {
          var idx = G.activeCases.indexOf(ready[i]);
          h +=
            '<option value="' +
            idx +
            '">' +
            ready[i].name +
            " (" +
            ready[i].type +
            ")</option>";
        }
        h +=
          '</select><p style="color:#f90;font-size:11px;margin-bottom:5px">‚ö†Ô∏è B≈Çƒôdne wnioski = GRZYWNA lub ZAWIESZENIE!</p><button id="mediator-btn" style="width:100%;background:linear-gradient(135deg,#fc0,#f90);color:#000;border:none;padding:10px;font-family:Orbitron;cursor:pointer;border-radius:8px;margin-bottom:15px;font-size:12px">ü§µ ZAPYTAJ PO≈öREDNIKA</button><div class="recipient-grid"><div class="recipient-opt" data-r="Policja"><div class="icon">üöî</div><div class="name">Policja</div></div><div class="recipient-opt" data-r="SƒÖd"><div class="icon">‚öñÔ∏è</div><div class="name">SƒÖd</div></div></div><button class="send-btn" id="send-btn" disabled>üì§ WY≈öLIJ</button></div>';
        return h;
      }
      function renderInbox() {
        if (!G.inbox.length)
          return '<div class="panel"><h2>üì¨ Poczta</h2><p style="color:#888">Brak.</p></div>';
        var h = '<div class="panel"><h2>üì¨ Poczta</h2>';
        for (var i = 0; i < G.inbox.length; i++) {
          var m = G.inbox[i];
          h +=
            '<div class="mail-item' +
            (m.read ? "" : " unread") +
            '" data-idx="' +
            i +
            '"><strong>' +
            m.from +
            '</strong><p style="color:#888;font-size:11px">' +
            m.body.substring(0, 40) +
            "...</p></div>";
        }
        return h + "</div>";
      }
      function renderShop() {
        var tax = getTotalTax();
        var h =
          '<div class="panel"><h2>üõí Sklep</h2><p style="color:#f90;font-size:11px;margin-bottom:10px">‚ö†Ô∏è Op≈Çata za narzƒôdzia: <strong>' +
          tax +
          "%</strong> z ka≈ºdej wyp≈Çaty</p>";
        for (var k in TOOLS) {
          if (k == "zoom") continue;
          var t = TOOLS[k];
          var owned = G.tools[k];
          var sellPrice = Math.floor(t.p * 0.05);
          h +=
            '<div class="shop-item" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px"><span style="color:#fff">' +
            t.n +
            ' <span style="color:#f90;font-size:10px">(' +
            t.tax +
            "%)</span></span>";
          if (owned) {
            h +=
              '<button class="sell-btn" data-tool="' +
              k +
              '" style="background:#f36;color:#fff;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:11px">Sprzedaj ' +
              sellPrice +
              "üí∞</button>";
          } else {
            h +=
              '<button class="shop-btn" data-tool="' +
              k +
              '" ' +
              (G.credits < t.p ? "disabled" : "") +
              ' style="background:#0ff;color:#000;border:none;padding:5px 10px;border-radius:5px;cursor:pointer;font-size:11px">' +
              t.p +
              "üí∞</button>";
          }
          h += "</div>";
        }
        return (
          h +
          '</div><div class="panel"><h2>‚öôÔ∏è</h2><button id="reset-btn" style="background:#f36;color:#fff;border:none;padding:10px;border-radius:5px;cursor:pointer">üóëÔ∏è RESET</button></div>'
        );
      }
      function renderArchive() {
        var h = '<div class="panel"><h2>üìÅ Archiwum</h2>';
        if (!G.completed.length) h += '<p style="color:#888">Brak.</p>';
        for (var i = 0; i < G.completed.length; i++) {
          var c = G.completed[i];
          h +=
            '<div class="shop-item"><span>' +
            c.name +
            '</span><span style="color:' +
            (c.rew >= 0 ? "#0f8" : "#f36") +
            '">' +
            (c.rew >= 0 ? "+" : "") +
            c.rew +
            "üí∞</span></div>";
        }
        return h + "</div>";
      }
      function bindEvents(p) {
        if (p == "case") {
          var cards = document.querySelectorAll(".case-card");
          for (var i = 0; i < cards.length; i++) {
            cards[i].onclick = cards[i].ontouchend = function (e) {
              e.preventDefault();
              G.selectedCase = parseInt(this.dataset.idx);
              saveGame();
              renderPanel("case");
            };
          }
          var evs = document.querySelectorAll(".evidence-card");
          for (var i = 0; i < evs.length; i++) {
            evs[i].onclick = evs[i].ontouchend = function (e) {
              e.preventDefault();
              openAnalysis(this.dataset.eid);
            };
          }
          var chatBtn = document.querySelector(".chat-client-btn");
          if (chatBtn) {
            chatBtn.onclick = chatBtn.ontouchend = function (e) {
              e.preventDefault();
              openClientChat(parseInt(this.dataset.cidx));
            };
          }
        }
        if (p == "send") {
          var sel = null;
          var opts = document.querySelectorAll(".recipient-opt");
          for (var i = 0; i < opts.length; i++) {
            opts[i].onclick = opts[i].ontouchend = function (e) {
              e.preventDefault();
              for (var j = 0; j < opts.length; j++)
                opts[j].classList.remove("selected");
              this.classList.add("selected");
              sel = this.dataset.r;
              document.getElementById("send-btn").disabled = false;
            };
          }
          document.getElementById("send-btn").onclick = document.getElementById(
            "send-btn"
          ).ontouchend = function (e) {
            e.preventDefault();
            if (sel) {
              var idx = parseInt(document.getElementById("case-sel").value);
              finishCase(idx, sel);
            }
          };
          var mb = document.getElementById("mediator-btn");
          if (mb) {
            mb.onclick = mb.ontouchend = function (e) {
              e.preventDefault();
              openMediatorChat();
            };
          }
        }
        if (p == "inbox") {
          var items = document.querySelectorAll(".mail-item");
          for (var i = 0; i < items.length; i++) {
            items[i].onclick = items[i].ontouchend = function (e) {
              e.preventDefault();
              var m = G.inbox[this.dataset.idx];
              m.read = true;
              saveGame();
              alert(m.from + "\n\n" + m.body);
              renderPanel("inbox");
            };
          }
        }
        if (p == "shop") {
          var btns = document.querySelectorAll(".shop-btn");
          for (var i = 0; i < btns.length; i++) {
            btns[i].onclick = btns[i].ontouchend = function (e) {
              e.preventDefault();
              var t = this.dataset.tool;
              if (!G.tools[t] && G.credits >= TOOLS[t].p) {
                G.credits -= TOOLS[t].p;
                G.tools[t] = true;
                updateHUD();
                saveGame();
                renderPanel("shop");
                notify(
                  "Kupiono!",
                  TOOLS[t].n + " (-" + TOOLS[t].tax + "% z wyp≈Çat)"
                );
              }
            };
          }
          var sellBtns = document.querySelectorAll(".sell-btn");
          for (var i = 0; i < sellBtns.length; i++) {
            sellBtns[i].onclick = sellBtns[i].ontouchend = function (e) {
              e.preventDefault();
              var t = this.dataset.tool;
              if (G.tools[t]) {
                sellTool(t);
                renderPanel("shop");
              }
            };
          }
          var rb = document.getElementById("reset-btn");
          if (rb)
            rb.onclick = function () {
              if (confirm("Reset?")) {
                localStorage.clear();
                location.reload();
              }
            };
        }
      }
      var curEv = null,
        curCase = null;
      function openAnalysis(eid) {
        if (G.selectedCase === null) return;
        curCase = G.activeCases[G.selectedCase];
        curEv = null;
        for (var i = 0; i < curCase.evidence.length; i++) {
          if (curCase.evidence[i].id == eid) curEv = curCase.evidence[i];
        }
        if (!curEv) return;
        document.getElementById("analysis-img").src = curEv.img;
        document.getElementById("analysis").style.display = "flex";
        if (!G.results[curCase.id]) G.results[curCase.id] = {};
        if (!G.results[curCase.id][eid]) G.results[curCase.id][eid] = {};
        saveGame();
        renderTools();
      }
      document.getElementById("close-analysis").onclick = function () {
        document.getElementById("analysis").style.display = "none";
      };
      function renderTools() {
        var res = G.results[curCase.id][curEv.id] || {};
        var h =
          '<div style="padding:5px"><h4 style="color:#0ff;margin-bottom:8px">NARZƒòDZIA</h4>';
        for (var k in TOOLS) {
          var t = TOOLS[k],
            have = G.tools[k],
            used = res[k];
          h +=
            '<button class="tool-btn' +
            (have ? "" : " locked") +
            (used ? " active" : "") +
            '" data-t="' +
            k +
            '">' +
            t.n +
            " " +
            (have ? (used ? "‚úì" : "") : t.p + "üí∞") +
            "</button>";
        }
        h += '</div><div id="results-box"><h5 style="color:#0ff">üìä</h5>';
        for (var k in res) {
          if (!res[k]) continue;
          h +=
            '<div class="result-row"><span>' +
            TOOLS[k].n +
            '</span><span class="result-val ' +
            (res[k].s ? "sus" : "ok") +
            '">' +
            (res[k].s ? "‚ö†Ô∏è" : "‚úì") +
            '</span></div><p style="color:#888;font-size:10px">' +
            res[k].i +
            "</p>";
        }
        h +=
          '</div><div id="verdict-btns"><button class="verdict-btn v-ok" id="v-ok">‚úì OK</button><button class="verdict-btn v-fake" id="v-fake">‚úó FA≈ÅSZ</button></div>';
        document.getElementById("tools-panel").innerHTML = h;
        var btns = document.querySelectorAll(".tool-btn");
        for (var i = 0; i < btns.length; i++) {
          btns[i].onclick = btns[i].ontouchend = function (e) {
            e.preventDefault();
            var t = this.dataset.t;
            if (!G.tools[t]) {
              notify("Brak!", "Kup w sklepie");
              return;
            }
            if (t == "zoom") {
              var img = document.getElementById("analysis-img");
              if (!img.dataset.zoomed || img.dataset.zoomed == "false") {
                img.style.transform = "scale(2.5)";
                img.style.cursor = "zoom-out";
                img.dataset.zoomed = "true";
                notify("üîç Lupa", "Powiƒôkszono 2.5x");
                G.results[curCase.id][curEv.id]["zoom"] = {
                  s: 0,
                  i: "Powiƒôkszenie aktywne",
                };
              } else {
                img.style.transform = "scale(1)";
                img.style.cursor = "zoom-in";
                img.dataset.zoomed = "false";
                notify("üîç Lupa", "Normalny rozmiar");
              }
              renderTools();
              return;
            }
            if (!curEv.ind || !curEv.ind[t]) return;
            if (G.results[curCase.id][curEv.id][t]) return;
            G.results[curCase.id][curEv.id][t] = curEv.ind[t];
            renderTools();
            saveGame();
            notify(TOOLS[t].n, curEv.ind[t].s ? "‚ö†Ô∏è PODEJRZANE!" : "‚úì OK");
          };
        }
        document.getElementById("v-ok").onclick = document.getElementById(
          "v-ok"
        ).ontouchend = function (e) {
          e.preventDefault();
          verdict(false);
        };
        document.getElementById("v-fake").onclick = document.getElementById(
          "v-fake"
        ).ontouchend = function (e) {
          e.preventDefault();
          verdict(true);
        };
      }
      function verdict(isFake) {
        curEv.verified = true;
        curEv.verdict = isFake;
        document.getElementById("analysis").style.display = "none";
        saveGame();
        renderPanel("case");
        if (curCase.evidence[0].verified) {
          notify("Gotowe!", "Wy≈õlij");
          document.querySelector('[data-panel="send"]').classList.add("notify");
        }
      }
      var chatCaseIdx = null;
      function openClientChat(idx) {
        chatCaseIdx = idx;
        var c = G.activeCases[idx];
        if (!c.chatHistory) c.chatHistory = [];
        document.getElementById("chat-client-name").textContent =
          "üí¨ " + c.avatar + " " + c.name;
        renderChatMessages(c);
        document.getElementById("client-chat").style.display = "flex";
      }
      function renderChatMessages(c) {
        var h =
          '<div class="chat-msg client">' +
          c.avatar +
          ": Cze≈õƒá! Dziƒôkujƒô ≈ºe Pan/Pani zajmuje siƒô mojƒÖ sprawƒÖ. Je≈õli ma Pan pytania - proszƒô pisaƒá!</div>";
        if (c.chatHistory) {
          for (var i = 0; i < c.chatHistory.length; i++) {
            var m = c.chatHistory[i];
            h +=
              '<div class="chat-msg ' +
              m.from +
              '">' +
              (m.from == "you" ? "Ty: " : c.avatar + ": ") +
              m.text +
              "</div>";
          }
        }
        document.getElementById("chat-messages").innerHTML = h;
        var msgs = document.getElementById("chat-messages");
        msgs.scrollTop = msgs.scrollHeight;
      }
      function getClientResponse(c, msg) {
        var m = msg.toLowerCase();
        if (m.indexOf("policj") >= 0 || m.indexOf("zg≈Çosi") >= 0)
          return "Czy to znaczy ≈ºe sprawa idzie do policji? Proszƒô mi powiedzieƒá co mam robiƒá!";
        if (m.indexOf("sƒÖd") >= 0 || m.indexOf("rozprawa") >= 0)
          return "SƒÖd? Bƒôdƒô musia≈Ç(a) zeznawaƒá? Trochƒô siƒô bojƒô ale zrobiƒô co trzeba.";
        if (
          m.indexOf("fa≈Çsz") >= 0 ||
          m.indexOf("fake") >= 0 ||
          m.indexOf("sfabrykowan") >= 0
        )
          return "Wiedzia≈Çem(am)! To by≈Ço podrobione! Czy to znaczy ≈ºe mogƒô wygraƒá sprawƒô?";
        if (m.indexOf("prawdzi") >= 0 || m.indexOf("autentyczn") >= 0)
          return "Czyli te dowody sƒÖ prawdziwe? To dobrze czy ≈∫le dla mojej sprawy?";
        if (
          m.indexOf("dowod") >= 0 ||
          m.indexOf("screen") >= 0 ||
          m.indexOf("wiƒôcej") >= 0
        )
          return "Mam jeszcze trochƒô screen√≥w i zapisanych wiadomo≈õci. Czy potrzebuje Pan/Pani wiƒôcej materia≈Ç√≥w?";
        if (m.indexOf("spokojnie") >= 0 || m.indexOf("nie martw") >= 0)
          return "Dziƒôkujƒô bardzo. Staram siƒô nie panikowaƒá ale to naprawdƒô stresujƒÖca sytuacja...";
        if (m.indexOf("aresztow") >= 0 || m.indexOf("zatrzym") >= 0)
          return "Naprawdƒô go aresztujƒÖ?! Nie wierzƒô! Dziƒôkujƒô za pomoc!!!";
        if (m.indexOf("nic") >= 0 && m.indexOf("zrobiƒá") >= 0)
          return "Jak to nic? Czyli nie ma ≈ºadnej nadziei? Proszƒô, musi byƒá jaki≈õ spos√≥b...";
        if (m.indexOf("czekaj") >= 0 || m.indexOf("cierpliw") >= 0)
          return "Rozumiem, postaram siƒô czekaƒá. Ile to mo≈ºe potrwaƒá?";
        if (m.indexOf("pytanie") >= 0 || m.indexOf("?") >= 0)
          return "Tak, s≈Çucham? O co chodzi?";
        if (m.indexOf("dziƒôk") >= 0 || m.indexOf("super") >= 0)
          return "To ja dziƒôkujƒô! Bardzo siƒô cieszƒô ≈ºe kto≈õ mi pomaga!";
        if (m.indexOf("podejrzew") >= 0 || m.indexOf("kto to") >= 0)
          return "Mam pewne podejrzenia kto za tym stoi, ale nie mam 100% pewno≈õci. Wolƒô nie rzucaƒá oskar≈ºe≈Ñ bez dowod√≥w.";
        if (m.indexOf("bezpiecz") >= 0 || m.indexOf("ochrona") >= 0)
          return "Czy mogƒô liczyƒá na jakƒÖ≈õ ochronƒô? Trochƒô siƒô bojƒô co bƒôdzie dalej...";
        return "Rozumiem. Proszƒô daƒá mi znaƒá jak tylko bƒôdzie co≈õ nowego w sprawie. Czekam na informacje!";
      }
      document.getElementById("chat-close").onclick = function () {
        document.getElementById("client-chat").style.display = "none";
        chatCaseIdx = null;
      };
      document.getElementById("chat-send").onclick = document.getElementById(
        "chat-send"
      ).ontouchend = function (e) {
        e.preventDefault();
        var txt = document.getElementById("chat-textarea").value.trim();
        if (!txt || chatCaseIdx === null) return;
        var c = G.activeCases[chatCaseIdx];
        if (!c.chatHistory) c.chatHistory = [];
        c.chatHistory.push({ from: "you", text: txt });
        document.getElementById("chat-textarea").value = "";
        renderChatMessages(c);
        setTimeout(function () {
          var resp = getClientResponse(c, txt);
          c.chatHistory.push({ from: "client", text: resp });
          renderChatMessages(c);
          saveGame();
        }, 1000 + Math.random() * 1000);
      };
      var currentVisitor = null;
      function spawnVisitor() {
        var avail = CASES.filter(function (c) {
          return (
            !G.completed.find(function (x) {
              return x.id == c.id;
            }) &&
            !G.activeCases.find(function (x) {
              return x.id == c.id;
            })
          );
        });
        if (!avail.length) {
          notify("Brak", "Wszystkie sprawy!");
          return;
        }
        currentVisitor = avail[Math.floor(Math.random() * avail.length)];
        var c = currentVisitor;
        document.getElementById("v-avatar").textContent = c.avatar;
        document.getElementById("v-name").textContent = c.name;
        document.getElementById("v-fee").textContent = c.fee;
        document.getElementById("visitor-complaint").innerHTML =
          "<strong>" +
          c.type +
          "</strong><br><br>" +
          c.fullStory +
          '<br><br><em style="color:#0ff">Dow√≥d: ' +
          c.evidence[0].tp +
          ' - "' +
          c.evidence[0].txt +
          '"</em>';
        document.getElementById("v-deadline").textContent = c.days;
        document.getElementById("v-penalty").textContent = c.pen;
        document.getElementById("visitor").style.display = "flex";
      }
      document.getElementById("btn-accept").onclick = function () {
        if (!currentVisitor) return;
        var c = currentVisitor;
        G.credits += c.fee;
        var nc = JSON.parse(JSON.stringify(c));
        nc.startDay = G.day;
        nc.evidence[0].verified = false;
        nc.evidence[0].verdict = null;
        nc.evidence[0].img = genImg(nc.evidence[0]);
        G.results[nc.id] = {};
        G.activeCases.push(nc);
        G.selectedCase = G.activeCases.length - 1;
        currentVisitor = null;
        document.getElementById("visitor").style.display = "none";
        updateHUD();
        saveGame();
        notify("Przyjƒôto!", "+" + c.fee + "üí∞");
      };
      document.getElementById("btn-reject").onclick = function () {
        currentVisitor = null;
        document.getElementById("visitor").style.display = "none";
      };
      function finishCase(idx, to) {
        var c = JSON.parse(JSON.stringify(G.activeCases[idx]));
        var correct = c.evidence[0].verdict == c.evidence[0].fake;
        G.activeCases.splice(idx, 1);
        delete G.results[c.id];
        G.selectedCase = G.activeCases.length ? 0 : null;
        saveGame();
        if (to == "SƒÖd" || to == "Policja") {
          exitPC();
          startScene(to, c, correct);
          return;
        }
      }
      function showResult(correct, rew, to) {
        document.getElementById("result-icon").textContent = correct
          ? "‚úì"
          : "‚úó";
        document.getElementById("result-icon").style.color = correct
          ? "#0f8"
          : "#f36";
        document.getElementById("result-title").textContent = correct
          ? "SUKCES!"
          : "B≈ÅƒÑD!";
        document.getElementById("result-title").style.color = correct
          ? "#0f8"
          : "#f36";
        document.getElementById("result-msg").textContent = "‚Üí " + to;
        document.getElementById("result-reward").textContent =
          (rew >= 0 ? "+" : "") + rew + "üí∞";
        document.getElementById("result-reward").style.color =
          rew >= 0 ? "#fc0" : "#f36";
        document.getElementById("result").style.display = "flex";
      }
      document.getElementById("continue-btn").onclick = function () {
        document.getElementById("result").style.display = "none";
        G.day++;
        updateHUD();
        saveGame();
        renderPanel("case");
      };
      function initScene3D(type) {
        var canvas = document.getElementById("scene-canvas");
        sceneScene = new THREE.Scene();
        sceneScene.background = new THREE.Color(
          type == "SƒÖd" ? 0x1a1208 : 0x0a1020
        );
        sceneCamera = new THREE.PerspectiveCamera(
          60,
          innerWidth / (innerHeight * 0.4),
          0.1,
          100
        );
        sceneCamera.position.set(0, 1.6, 3);
        sceneRenderer = new THREE.WebGLRenderer({
          canvas: canvas,
          antialias: true,
        });
        sceneRenderer.setSize(innerWidth, innerHeight * 0.4);
        sceneScene.add(
          new THREE.AmbientLight(type == "SƒÖd" ? 0xffd090 : 0x4060ff, 0.5)
        );
        var light = new THREE.PointLight(
          type == "SƒÖd" ? 0xffcc66 : 0x3366ff,
          1,
          20
        );
        light.position.set(0, 4, 0);
        sceneScene.add(light);
        var floor = new THREE.Mesh(
          new THREE.PlaneGeometry(20, 20),
          new THREE.MeshBasicMaterial({
            color: type == "SƒÖd" ? 0x2a1a0a : 0x1a1a2a,
          })
        );
        floor.rotation.x = -Math.PI / 2;
        sceneScene.add(floor);
        if (type == "SƒÖd") {
          var bench = new THREE.Mesh(
            new THREE.BoxGeometry(4, 1.5, 1),
            new THREE.MeshBasicMaterial({ color: 0x4a2a10 })
          );
          bench.position.set(0, 0.75, -4);
          sceneScene.add(bench);
          var emblem = new THREE.Mesh(
            new THREE.CircleGeometry(0.5, 32),
            new THREE.MeshBasicMaterial({ color: 0xffd700 })
          );
          emblem.position.set(0, 2.5, -4.5);
          sceneScene.add(emblem);
        } else {
          var desk = new THREE.Mesh(
            new THREE.BoxGeometry(3, 1, 1.5),
            new THREE.MeshBasicMaterial({ color: 0x2a2a4a })
          );
          desk.position.set(0, 0.5, -3);
          sceneScene.add(desk);
          var lamp = new THREE.Mesh(
            new THREE.CylinderGeometry(0.1, 0.3, 0.4),
            new THREE.MeshBasicMaterial({ color: 0x4080ff })
          );
          lamp.position.set(1, 1.2, -3);
          sceneScene.add(lamp);
        }
        var stx = 0,
          sty = 0;
        canvas.ontouchstart = function (e) {
          stx = e.touches[0].clientX;
          sty = e.touches[0].clientY;
        };
        canvas.ontouchmove = function (e) {
          sceneRotY -= (e.touches[0].clientX - stx) * 0.005;
          sceneRotX = Math.max(
            -0.5,
            Math.min(0.5, sceneRotX - (e.touches[0].clientY - sty) * 0.005)
          );
          stx = e.touches[0].clientX;
          sty = e.touches[0].clientY;
        };
        canvas.onmousemove = function (e) {
          if (e.buttons) {
            sceneRotY -= e.movementX * 0.003;
            sceneRotX = Math.max(
              -0.5,
              Math.min(0.5, sceneRotX - e.movementY * 0.003)
            );
          }
        };
        animateScene();
      }
      function animateScene() {
        if (document.getElementById("scene-overlay").style.display != "flex")
          return;
        requestAnimationFrame(animateScene);
        sceneCamera.rotation.order = "YXZ";
        sceneCamera.rotation.y = sceneRotY;
        sceneCamera.rotation.x = sceneRotX;
        sceneRenderer.render(sceneScene, sceneCamera);
      }
      function startScene(type, caseData, correct) {
        sceneData = {
          type: type,
          caseData: caseData,
          correct: correct,
          phase: 0,
          allTexts: "",
        };
        sceneRotY = 0;
        sceneRotX = 0;
        document.getElementById("scene-overlay").style.display = "flex";
        document.getElementById("scene-result").style.display = "none";
        document.getElementById("scene-dialogue").style.display = "block";
        initScene3D(type);
        animateScene();
        runScenePhase();
      }
      function analyzePlayerText(txt) {
        var score = 0;
        var result = {};
        var kw = {
          evidence: [
            "dowod",
            "screen",
            "zrzut",
            "nagranie",
            "mail",
            "wiadomo",
            "sms",
            "foto",
            "zdjƒôci",
            "plik",
            "dokument",
            "wyciƒÖg",
            "log",
            "historia",
            "backup",
          ],
          technical: [
            "metadan",
            "analiz",
            "exif",
            "ip",
            "adres",
            "lokalizacj",
            "timestamp",
            "hash",
            "sygnatur",
            "photoshop",
            "edycj",
            "manipulacj",
            "fa≈Çsz",
          ],
          professional: [
            "wysoki sƒÖdzie",
            "panie oficerze",
            "pani oficer",
            "przedstawiam",
            "wnoszƒô",
            "o≈õwiadczam",
            "zeznaj",
            "potwierdzam",
          ],
          uncertain: [
            "nie wiem",
            "mo≈ºe",
            "chyba",
            "wydaje mi siƒô",
            "nie jestem pewien",
            "trudno powiedzieƒá",
            "mo≈ºliwe",
            "prawdopodobnie",
            "nie pamiƒôtam",
          ],
          aggressive: [
            "k≈Çam",
            "oszust",
            "przestƒôpc",
            "bandyt",
            "z≈Çodziej",
            "≈õwinia",
            "idiota",
            "g≈Çupi",
          ],
          urgent: [
            "pilne",
            "szybko",
            "natychmiast",
            "teraz",
            "zaraz",
            "niebezpiecz",
            "grozi",
            "≈ºyci",
            "zdrowi",
            "przemoc",
          ],
          suspect: [
            "znam",
            "wiem kto",
            "to jest",
            "nazwisko",
            "adres",
            "mieszka",
            "pracuje",
            "numer",
            "telefon",
            "profil",
          ],
          victim: [
            "ofiara",
            "pokrzywdzon",
            "bezpiecz",
            "strach",
            "boi siƒô",
            "ukrywa",
            "chroni",
            "pomoc",
          ],
          weak: [
            "tylko",
            "trochƒô",
            "niewiele",
            "ma≈Ço",
            "sam",
            "jeden",
            "mo≈ºe byƒá",
          ],
          strong: [
            "pewny",
            "na pewno",
            "jednoznaczn",
            "bezsprzeczn",
            "niezbity",
            "oczywist",
            "ewidentn",
          ],
          legal: [
            "paragraf",
            "artyku≈Ç",
            "kodeks",
            "ustawa",
            "prawo",
            "przepis",
            "sankcj",
          ],
          emotional: [
            "proszƒô",
            "b≈Çagam",
            "pom√≥≈º",
            "ratuj",
            "straszn",
            "okropn",
            "koszmar",
          ],
        };
        for (var cat in kw) {
          result[cat] = 0;
          for (var i = 0; i < kw[cat].length; i++) {
            if (txt.indexOf(kw[cat][i]) >= 0) {
              result[cat]++;
              score +=
                cat == "uncertain" || cat == "weak" || cat == "aggressive"
                  ? -2
                  : 2;
            }
          }
        }
        result.score = score;
        result.hasEvidence = result.evidence > 0 || result.technical > 0;
        result.isPro = result.professional > 0;
        result.isUnsure = result.uncertain > 0 || result.weak > 1;
        result.isAggressive = result.aggressive > 0;
        result.isUrgent = result.urgent > 0;
        result.knowsSuspect = result.suspect > 0;
        result.victimDanger = result.urgent > 0 && result.victim > 0;
        result.isStrong = result.strong > 0 && result.evidence > 1;
        result.isEmotional = result.emotional > 0;
        result.isLegal = result.legal > 0;
        result.length = txt.length;
        return result;
      }

      function getDefResp(a, txt) {
        if (a.isUnsure && a.length < 50)
          return "Wysoki SƒÖdzie! To jest ≈ºart? Oskar≈ºyciel sam przyznaje ≈ºe nie jest pewien i nie potrafi nawet sensownie opisaƒá sprawy! ≈ªƒÖdam natychmiastowego uniewinnienia!";
        if (a.isUnsure)
          return 'Wysoki SƒÖdzie! S≈Çyszeli≈õcie te wahania? "Mo≈ºe", "chyba"... To nie sƒÖ s≈Çowa kogo≈õ kto ma twarde dowody!';
        if (a.isAggressive)
          return "Sprzeciw! Oskar≈ºyciel zamiast fakt√≥w rzuca obelgi! To ≈õwiadczy o braku argument√≥w! Proszƒô o upomnienie!";
        if (a.isEmotional && !a.hasEvidence)
          return "Wysoki SƒÖdzie, widzƒô tu du≈ºo emocji, ale zero konkretnych dowod√≥w. Emocje to nie dowody!";
        if (txt.indexOf("photoshop") >= 0 || txt.indexOf("edyt") >= 0)
          return 'Oskar≈ºyciel twierdzi ≈ºe wykry≈Ç edycjƒô? A mo≈ºe to ON sfabrykowa≈Ç te tak zwane "dowody"? Ka≈ºdy mo≈ºe co≈õ napisaƒá!';
        if (txt.indexOf("metadan") >= 0)
          return "Metadane? Wysoki SƒÖdzie, ka≈ºdy nastolatek umie zmieniƒá metadane pliku! To ≈ºaden dow√≥d!";
        if (a.technical > 2 && a.evidence > 1)
          return "Te... te techniczne bzdury... Wysoki SƒÖdzie, wnoszƒô o powo≈Çanie NIEZALE≈ªNEGO bieg≈Çego! Nie mo≈ºemy ufaƒá analizom oskar≈ºyciela!";
        if (a.isStrong)
          return "Mimo pewno≈õci siebie oskar≈ºyciela, wciƒÖ≈º nie widzƒô NIEBITYCH dowod√≥w! M√≥j klient jest niewinny!";
        if (a.hasEvidence)
          return 'Te tak zwane "dowody" mog≈Çy zostaƒá sfabrykowane! W dobie AI wszystko mo≈ºna podrobiƒá! To nic nie dowodzi!';
        if (a.isLegal)
          return "Oskar≈ºyciel cytuje paragrafy, ale czy naprawdƒô rozumie prawo? Interpretacja jest wysoce wƒÖtpliwa!";
        if (a.length < 30)
          return "To wszystko? TAK KR√ìTKA wypowied≈∫ ma byƒá oskar≈ºeniem? ≈ömieszne! ≈ªƒÖdam uniewinnienia!";
        return "Wysoki SƒÖdzie, oskar≈ºyciel nie przedstawi≈Ç ≈ºadnych konkretnych, niepodwa≈ºalnych dowod√≥w! ≈ªƒÖdam uniewinnienia mojego klienta!";
      }

      function getJudgeResp(a, txt) {
        if (a.isAggressive)
          return "Proszƒô o spok√≥j i powagƒô! To jest sala sƒÖdowa. Nastƒôpne takie zachowanie sko≈Ñczy siƒô karƒÖ porzƒÖdkowƒÖ. Proszƒô trzymaƒá siƒô fakt√≥w.";
        if (a.isUnsure && a.length < 50)
          return "Panie oskar≈ºycielu, Pana wypowied≈∫ jest bardzo niepewna i kr√≥tka. Czy jest Pan przygotowany do tej rozprawy?";
        if (a.isUnsure)
          return "S≈Çyszƒô w Pana s≈Çowach niepewno≈õƒá. SƒÖd potrzebuje PEWNO≈öCI, nie domys≈Ç√≥w. Czy ma Pan twarde dowody?";
        if (a.isEmotional && !a.hasEvidence)
          return "Rozumiem emocje, ale sƒÖd opiera siƒô na faktach i dowodach, nie na uczuciach. Proszƒô o konkrety.";
        if (a.isPro && a.isStrong)
          return "Dziƒôkujƒô za profesjonalne i pewne przedstawienie sprawy. SƒÖd we≈∫mie pod uwagƒô przedstawione argumenty.";
        if (a.isPro && a.hasEvidence)
          return "Dziƒôkujƒô. Widzƒô ≈ºe jest Pan przygotowany. Proszƒô kontynuowaƒá.";
        if (a.technical > 2)
          return "Rozumiem ≈ºe sprawa ma aspekt techniczny. Czy te analizy by≈Çy przeprowadzone zgodnie ze standardami?";
        if (a.hasEvidence && !a.isUnsure)
          return "Dobrze, mamy wiƒôc jakie≈õ dowody. SƒÖd je rozpatrzy.";
        if (a.isLegal)
          return "Widzƒô ≈ºe zna Pan przepisy. Proszƒô jednak pamiƒôtaƒá ≈ºe interpretacja prawa nale≈ºy do sƒÖdu.";
        if (a.length > 200 && a.hasEvidence)
          return "Dziƒôkujƒô za szczeg√≥≈Çowe wyja≈õnienie. SƒÖd ma teraz pe≈Çniejszy obraz sprawy.";
        if (a.length < 30)
          return "To bardzo kr√≥tka wypowied≈∫. Czy nie ma Pan nic wiƒôcej do dodania?";
        return "Rozumiem. Proszƒô kontynuowaƒá i przedstawiƒá wiƒôcej szczeg√≥≈Ç√≥w.";
      }

      function getPolResp(a, txt) {
        if (a.isAggressive)
          return "Proszƒô siƒô uspokoiƒá. Rozumiem ≈ºe jest Pan zdenerwowany, ale potrzebujƒô konkretnych informacji, nie emocji.";
        if (a.isUnsure && a.length < 50)
          return "Hmm, nie brzmi to przekonujƒÖco. Potrzebujƒô konkret√≥w ≈ºeby podjƒÖƒá dzia≈Çania. Kto, co, kiedy, gdzie?";
        if (a.isUnsure)
          return 'S≈Çyszƒô du≈ºo niepewno≈õci. Trudno mi dzia≈Çaƒá na podstawie "mo≈ºe" i "chyba". Ma Pan co≈õ konkretnego?';
        if (a.isUrgent && a.victimDanger)
          return "Rozumiem ≈ºe sytuacja jest powa≈ºna. Natychmiast wy≈õlƒô patrol do ofiary. Proszƒô kontynuowaƒá zg≈Çoszenie.";
        if (a.isUrgent)
          return "OK, widzƒô ≈ºe sprawa jest pilna. Proszƒô szybko podaƒá najwa≈ºniejsze fakty.";
        if (a.isPro && a.hasEvidence)
          return "Dobrze, widzƒô ≈ºe jest Pan przygotowany i ma dowody. To u≈Çatwi sprawƒô.";
        if (a.hasEvidence && a.technical > 1)
          return "O, ma Pan analizy techniczne? To mo≈ºe byƒá kluczowe. Zabezpieczymy te materia≈Çy.";
        if (a.hasEvidence)
          return "Dobrze, mamy jakie≈õ dowody. Screeny, nagrania - to podstawa do dzia≈Çania.";
        if (a.knowsSuspect)
          return "Zna Pan podejrzanego? To bardzo wa≈ºne. Proszƒô podaƒá wszystkie szczeg√≥≈Çy.";
        if (a.isEmotional)
          return "Rozumiem ≈ºe to trudna sytuacja. Proszƒô siƒô uspokoiƒá i podaƒá mi fakty po kolei.";
        if (a.length > 200)
          return "OK, mam sporo informacji. Zaczynam rozumieƒá sytuacjƒô.";
        if (a.length < 30)
          return "To trochƒô ma≈Ço. Potrzebujƒô wiƒôcej szczeg√≥≈Ç√≥w ≈ºeby podjƒÖƒá dzia≈Çania.";
        return "Rozumiem. Proszƒô kontynuowaƒá - potrzebujƒô pe≈Çnego obrazu sytuacji.";
      }

      function getSceneOutcome(d) {
        var txt = d.allTexts ? d.allTexts.toLowerCase() : "";
        var c = d.caseData;
        var keywordsFound = 0;
        if (c.keywords) {
          for (var i = 0; i < c.keywords.length; i++) {
            if (txt.indexOf(c.keywords[i]) >= 0) keywordsFound++;
          }
        }
        var keywordScore =
          keywordsFound / Math.max(1, c.keywords ? c.keywords.length : 1);
        var isEmpty = txt.length < 30;
        var mentionedEvidence =
          txt.indexOf("dowod") >= 0 ||
          txt.indexOf("screen") >= 0 ||
          txt.indexOf("analiz") >= 0 ||
          txt.indexOf("metadan") >= 0;

        var playerVerdict = c.evidence[0].verdict;
        var realFake = c.evidence[0].fake;
        var wasCorrect = playerVerdict == realFake;

        var saidFake =
          txt.indexOf("fa≈Çsz") >= 0 ||
          txt.indexOf("fake") >= 0 ||
          txt.indexOf("podrobion") >= 0 ||
          txt.indexOf("sfa≈Çsz") >= 0 ||
          txt.indexOf("zmodyf") >= 0 ||
          txt.indexOf("edytow") >= 0;
        var saidReal =
          txt.indexOf("prawdzi") >= 0 ||
          txt.indexOf("autentycz") >= 0 ||
          txt.indexOf("oryginal") >= 0 ||
          txt.indexOf("prawda") >= 0;

        var speechMatchesVerdict =
          (playerVerdict && saidFake) || (!playerVerdict && saidReal);
        var speechContradicts =
          (playerVerdict && saidReal) || (!playerVerdict && saidFake);

        var accusedClient =
          txt.indexOf("klient") >= 0 &&
          (txt.indexOf("k≈Çam") >= 0 ||
            txt.indexOf("sfa≈Çsz") >= 0 ||
            txt.indexOf("oszuk") >= 0 ||
            txt.indexOf("winn") >= 0);
        accusedClient =
          accusedClient ||
          (txt.indexOf(c.name.split(" ")[0].toLowerCase()) >= 0 &&
            (txt.indexOf("k≈Çam") >= 0 ||
              txt.indexOf("sfa≈Çsz") >= 0 ||
              txt.indexOf("winn") >= 0));

        if (isEmpty)
          return {
            type: "dismissed",
            msg: "Nie przedstawiono ≈ºadnych argument√≥w.",
            rew: 0,
          };

        if (speechContradicts) {
          return {
            type: "contradiction",
            msg:
              "SPRZECZNO≈öƒÜ! Zaznaczy≈Çe≈õ ≈ºe dow√≥d jest " +
              (playerVerdict ? "FA≈ÅSZYWY" : "PRAWDZIWY") +
              " ale m√≥wisz ≈ºe jest " +
              (saidFake ? "fa≈Çszywy" : "prawdziwy") +
              "!",
            rew: -Math.floor(c.fine * 0.5),
          };
        }

        if (c.clientLies) {
          if (accusedClient && realFake) {
            return {
              type: "client_guilty",
              msg:
                "BRAWO! Wykry≈Çe≈õ ≈ºe to KLIENT sfa≈Çszowa≈Ç dowody! " +
                c.name +
                " pr√≥bowa≈Ç wrobiƒá niewinnƒÖ osobƒô!",
              rew: Math.floor(c.rew * 2),
            };
          }
          if (!accusedClient && wasCorrect) {
            return {
              type: "partial",
              msg: "Dow√≥d jest fa≈Çszywy, ale nie wskaza≈Çe≈õ prawdziwego winnego - KLIENTA!",
              rew: Math.floor(c.rew * 0.3),
            };
          }
          if (!wasCorrect) {
            return {
              type: "wrong",
              msg: "B≈Çƒôdna analiza. Dow√≥d by≈Ç sfa≈Çszowany przez klienta!",
              rew: -c.fine,
            };
          }
        }

        if (accusedClient && !c.clientLies) {
          return {
            type: "wrong_accusation",
            msg: "Oskar≈ºy≈Çe≈õ klienta kt√≥ry m√≥wi≈Ç prawdƒô! To pomy≈Çka!",
            rew: -c.fine,
          };
        }

        var wrongAccusation =
          !wasCorrect &&
          !c.clientLies &&
          (txt.indexOf("winn") >= 0 ||
            txt.indexOf("skazaƒá") >= 0 ||
            txt.indexOf("aresztowaƒá") >= 0);
        if (wrongAccusation)
          return {
            type: "suspend",
            msg: "Fa≈Çszywe oskar≈ºenie niewinnej osoby!",
            rew: 0,
          };

        if (wasCorrect) {
          if (speechMatchesVerdict && keywordScore > 0.4 && mentionedEvidence)
            return {
              type: "full_win",
              msg: "Doskona≈Çe! Analiza poprawna, zeznania sp√≥jne, argumenty mocne!",
              rew: Math.floor(c.rew * 1.5),
            };
          if (speechMatchesVerdict && keywordScore > 0.25)
            return {
              type: "win",
              msg: "Sprawa udowodniona. Zeznania zgodne z analizƒÖ.",
              rew: c.rew,
            };
          if (keywordScore > 0.2)
            return {
              type: "partial",
              msg: "Analiza poprawna ale s≈Çabe argumenty w zeznaniach.",
              rew: Math.floor(c.rew * 0.5),
            };
          if (mentionedEvidence)
            return {
              type: "weak_win",
              msg: "Tylko dowody uratowa≈Çy sprawƒô.",
              rew: Math.floor(c.rew * 0.3),
            };
          return {
            type: "dismissed",
            msg: "Brak konkret√≥w mimo poprawnej analizy.",
            rew: 0,
          };
        } else {
          if (keywordScore > 0.3)
            return {
              type: "fine",
              msg: "Zna≈Çe≈õ fakty ale ≈∫le oceni≈Çe≈õ dowody!",
              rew: -c.fine,
            };
          return {
            type: "lose",
            msg: "B≈Çƒôdna analiza dowod√≥w.",
            rew: -Math.floor(c.fine * 0.5),
          };
        }
      }
      function runScenePhase() {
        var d = sceneData,
          sp = document.getElementById("scene-speaker"),
          tx = document.getElementById("scene-text"),
          inp = document.getElementById("scene-input"),
          opts = document.getElementById("scene-options");
        inp.style.display = "none";
        opts.style.display = "none";
        var c = d.caseData;
        var txt = d.allTexts ? d.allTexts.toLowerCase() : "";
        var found = [];
        if (c.keywords) {
          for (var i = 0; i < c.keywords.length; i++) {
            if (txt.indexOf(c.keywords[i]) >= 0) found.push(c.keywords[i]);
          }
        }
        var mentionedSuspect =
          c.suspect && txt.indexOf(c.suspect.split(" ")[0].toLowerCase()) >= 0;
        var mentionedEvidence =
          txt.indexOf("dowod") >= 0 ||
          txt.indexOf("screen") >= 0 ||
          txt.indexOf("analiz") >= 0;
        var playerVerdict = c.evidence[0].verdict;
        var verdictWord = playerVerdict ? "FA≈ÅSZYWY" : "PRAWDZIWY";

        if (d.type == "SƒÖd") {
          var phases = [
            {
              who: "judge",
              icon: "‚öñÔ∏è SƒòDZIA",
              say:
                "Rozprawa w sprawie " +
                c.name +
                ". Zarzut: " +
                c.type +
                ". Oskar≈ºycielu, proszƒô opisaƒá czego dotyczy ta sprawa.",
            },
            {
              who: "you",
              icon: "üîç TY",
              say: "(Opisz sprawƒô w≈Çasnymi s≈Çowami - co siƒô sta≈Ço?)",
            },
            {
              who: "judge",
              icon: "‚öñÔ∏è SƒòDZIA",
              say: function () {
                if (txt.length < 20)
                  return "Panie oskar≈ºycielu, proszƒô m√≥wiƒá g≈Ço≈õniej. Czego dotyczy sprawa?";
                if (found.length > 3)
                  return "Rozumiem sytuacjƒô. Kto wed≈Çug Pana jest sprawcƒÖ?";
                return "Proszƒô doprecyzowaƒá - jakie sƒÖ szczeg√≥≈Çy tej sprawy?";
              },
            },
            {
              who: "you",
              icon: "üîç TY",
              say: "(Kto jest podejrzany? Opisz sprawcƒô)",
            },
            {
              who: "judge",
              icon: "‚öñÔ∏è SƒòDZIA",
              say: function () {
                if (mentionedSuspect)
                  return (
                    "Dobrze, mamy podejrzanego: " +
                    c.suspect.split("-")[0] +
                    ". Jakie ma Pan dowody?"
                  );
                if (
                  txt.indexOf("nie wiem") >= 0 ||
                  txt.indexOf("nie znam") >= 0
                )
                  return "Nie zna Pan sprawcy? Trudno bƒôdzie prowadziƒá sprawƒô. A dowody?";
                return "Rozumiem. Proszƒô teraz przedstawiƒá dowody.";
              },
            },
            {
              who: "you",
              icon: "üîç TY",
              say: "(Jakie masz dowody? Co wykaza≈Ça analiza?)",
            },
            {
              who: "defense",
              icon: "üëî OBRO≈ÉCA",
              say: function () {
                if (mentionedEvidence && found.length > 4)
                  return 'Wysoki SƒÖdzie! Te tak zwane "dowody" mo≈ºna sfabrykowaƒá! ≈ªƒÖdam ich odrzucenia!';
                if (mentionedEvidence)
                  return "Sprzeciw! SkƒÖd wiemy ≈ºe te dowody sƒÖ prawdziwe?";
                return "Wysoki SƒÖdzie, oskar≈ºyciel nie przedstawi≈Ç ≈ªADNYCH konkretnych dowod√≥w!";
              },
            },
            {
              who: "judge",
              icon: "‚öñÔ∏è SƒòDZIA",
              say:
                "W analizie zaznaczy≈Ç Pan ≈ºe dow√≥d jest " +
                verdictWord +
                ". Czy podtrzymuje Pan tƒô ocenƒô? Proszƒô wyja≈õniƒá.",
            },
            {
              who: "you",
              icon: "üîç TY",
              say: "(Powiedz czy dow√≥d jest fa≈Çszywy czy prawdziwy i DLACZEGO - musi siƒô zgadzaƒá z tym co zaznaczy≈Çe≈õ!)",
            },
            {
              who: "judge",
              icon: "‚öñÔ∏è SƒòDZIA",
              say: function () {
                var saidFake =
                  txt.indexOf("fa≈Çsz") >= 0 || txt.indexOf("sfa≈Çsz") >= 0;
                var saidReal =
                  txt.indexOf("prawdzi") >= 0 || txt.indexOf("autentycz") >= 0;
                if ((playerVerdict && saidReal) || (!playerVerdict && saidFake))
                  return "Chwileczkƒô... Pan m√≥wi co innego ni≈º zaznaczy≈Ç w analizie! To powa≈ºna sprzeczno≈õƒá!";
                if ((playerVerdict && saidFake) || (!playerVerdict && saidReal))
                  return "Dobrze, zeznania zgadzajƒÖ siƒô z analizƒÖ. Ostatnie s≈Çowo.";
                return "Proszƒô jasno powiedzieƒá - dow√≥d FA≈ÅSZYWY czy PRAWDZIWY?";
              },
            },
            {
              who: "you",
              icon: "üîç TY",
              say: "(Podsumuj - kto winny i dlaczego)",
            },
            {
              who: "judge",
              icon: "‚öñÔ∏è SƒòDZIA",
              say: "Dziƒôkujƒô. SƒÖd wyda teraz wyrok...",
              verdict: true,
            },
          ];
        } else {
          var phases = [
            {
              who: "police",
              icon: "üöî OFICER",
              say:
                "Dzie≈Ñ dobry. Przyjmujƒô zg≈Çoszenie. " +
                c.name +
                " - " +
                c.type +
                ". Co siƒô sta≈Ço?",
            },
            {
              who: "you",
              icon: "üîç TY",
              say: "(Opisz sytuacjƒô - co siƒô wydarzy≈Ço?)",
            },
            {
              who: "police",
              icon: "üöî OFICER",
              say: function () {
                if (txt.length < 20)
                  return "Proszƒô m√≥wiƒá wyra≈∫niej. Co dok≈Çadnie siƒô sta≈Ço?";
                if (found.length > 2)
                  return "Rozumiem. Kto jest podejrzany o to przestƒôpstwo?";
                return "Potrzebujƒô wiƒôcej szczeg√≥≈Ç√≥w. Kto jest sprawcƒÖ?";
              },
            },
            {
              who: "you",
              icon: "üîç TY",
              say: "(Kto to zrobi≈Ç? Masz podejrzenia?)",
            },
            {
              who: "police",
              icon: "üöî OFICER",
              say: function () {
                if (mentionedSuspect)
                  return (
                    "Mamy namiar: " +
                    c.suspect.split("-")[0] +
                    ". Jakie masz dowody przeciwko tej osobie?"
                  );
                if (txt.indexOf("nie wiem") >= 0)
                  return "Nie znasz sprawcy? Bƒôdzie trudniej. A dowody jakie≈õ masz?";
                return "OK. Jakie masz dowody?";
              },
            },
            {
              who: "you",
              icon: "üîç TY",
              say: "(Jakie masz dowody? Screeny, maile, nagrania?)",
            },
            {
              who: "police",
              icon: "üöî OFICER",
              say:
                "W analizie zaznaczy≈Çe≈õ ≈ºe dow√≥d jest " +
                verdictWord +
                ". Czy to na pewno? Co dok≈Çadnie wykaza≈Ça analiza?",
            },
            {
              who: "you",
              icon: "üîç TY",
              say: "(Potwierd≈∫ - dow√≥d FA≈ÅSZYWY czy PRAWDZIWY? Musi siƒô zgadzaƒá z zaznaczeniem!)",
            },
            {
              who: "police",
              icon: "üöî OFICER",
              say: function () {
                var saidFake =
                  txt.indexOf("fa≈Çsz") >= 0 || txt.indexOf("sfa≈Çsz") >= 0;
                var saidReal =
                  txt.indexOf("prawdzi") >= 0 || txt.indexOf("autentycz") >= 0;
                if ((playerVerdict && saidReal) || (!playerVerdict && saidFake))
                  return "Zaraz, zaraz... M√≥wisz co innego ni≈º masz w dokumentach! To siƒô nie zgadza!";
                if (c.type == "GRO≈πBY" || c.type == "STALKING")
                  return "OK. Czy ofiara jest bezpieczna?";
                return "Rozumiem. Mam wystarczajƒÖco informacji.";
              },
            },
            { who: "you", icon: "üîç TY", say: "(Ostatnie informacje)" },
            {
              who: "police",
              icon: "üöî OFICER",
              say: "Dobrze, mam pe≈Çny obraz. Podejmujƒô decyzjƒô...",
              verdict: true,
            },
          ];
        }
        var ph = phases[d.phase];
        if (!ph) {
          showSceneVerdict();
          return;
        }
        sp.className = "scene-speaker " + ph.who;
        sp.textContent = ph.icon;
        var sayTxt = typeof ph.say === "function" ? ph.say() : ph.say;
        tx.textContent = sayTxt;
        if (ph.who != "you") speak(sayTxt, ph.who);
        if (ph.input || ph.who == "you") {
          inp.style.display = "block";
          document.getElementById("scene-textarea").value = "";
          document.getElementById("scene-textarea").focus();
        } else if (ph.verdict) {
          setTimeout(showSceneVerdict, 3000);
        } else {
          d.phase++;
          setTimeout(runScenePhase, 3000);
        }
      }
      document.getElementById("scene-submit").onclick = document.getElementById(
        "scene-submit"
      ).ontouchend = function (e) {
        e.preventDefault();
        var txt = document
          .getElementById("scene-textarea")
          .value.toLowerCase()
          .trim();
        document.getElementById("scene-input").style.display = "none";
        if (!sceneData.allTexts) sceneData.allTexts = "";
        sceneData.allTexts += " " + txt;
        document.getElementById("scene-text").textContent =
          txt.length > 0
            ? '"' + txt.substring(0, 80) + (txt.length > 80 ? "..." : "") + '"'
            : '"(milczenie)"';
        sceneData.phase++;
        setTimeout(runScenePhase, 2000);
      };
      function showSceneVerdict() {
        document.getElementById("scene-dialogue").style.display = "none";
        var res = document.getElementById("scene-result");
        res.style.display = "block";
        var title = document.getElementById("scene-verdict-title"),
          text = document.getElementById("scene-verdict-text");
        var outcome = getSceneOutcome(sceneData);
        var rew = outcome.rew;
        var msg = outcome.msg;
        var col = rew > 0 ? "#0f8" : rew == 0 ? "#f90" : "#f36";
        var speak_txt = "";
        if (outcome.type == "suspend") {
          title.textContent = "‚õî ZAWIESZENIE!";
          title.style.color = "#f36";
          text.innerHTML =
            msg +
            '<br><br><span style="color:#f36">Licencja zawieszona na 2 godziny!</span>';
          speak_txt =
            sceneData.type == "SƒÖd"
              ? "Za fa≈Çszywe oskar≈ºenie zawieszam Pana licencjƒô!"
              : "Za fa≈Çszywe zg≈Çoszenie nak≈Çadam zawieszenie!";
          speak(speak_txt, sceneData.type == "SƒÖd" ? "judge" : "police");
          G.completed.push({
            id: sceneData.caseData.id,
            name: sceneData.caseData.name,
            rew: 0,
          });
          G.inbox.unshift({
            from: sceneData.type,
            body: "Licencja zawieszona za fa≈Çszywe oskar≈ºenie.",
            read: false,
          });
          updateHUD();
          saveGame();
          setTimeout(function () {
            suspendPlayer(2);
          }, 3000);
          return;
        }
        if (outcome.type == "full_win")
          speak_txt =
            sceneData.type == "SƒÖd"
              ? "Uznajƒô oskar≈ºonego winnym! Doskona≈Ça praca!"
              : "Aresztujemy podejrzanego! ≈öwietna robota!";
        else if (outcome.type == "win")
          speak_txt =
            sceneData.type == "SƒÖd"
              ? "Uznajƒô oskar≈ºonego winnym."
              : "Wszczynamy postƒôpowanie.";
        else if (outcome.type == "partial")
          speak_txt =
            sceneData.type == "SƒÖd"
              ? "Czƒô≈õciowo uznajƒô winƒô."
              : "Przyjmujemy zg≈Çoszenie.";
        else if (outcome.type == "weak_win")
          speak_txt = "S≈Çabe argumenty, ale akceptujƒô.";
        else if (outcome.type == "dismissed")
          speak_txt = "Sprawa umorzona. Brak dowod√≥w.";
        else if (outcome.type == "fine")
          speak_txt = "Nak≈Çadam grzywnƒô za b≈Çƒôdne oskar≈ºenie!";
        else if (outcome.type == "lose") speak_txt = "Odrzucam to zg≈Çoszenie.";
        else speak_txt = "Sprawa rozpatrzona.";
        speak(speak_txt, sceneData.type == "SƒÖd" ? "judge" : "police");
        title.textContent =
          rew > 0 ? "‚úÖ SUKCES!" : rew == 0 ? "‚ö†Ô∏è UMORZONE" : "‚ùå PORA≈ªKA!";
        title.style.color = col;
        var tax = getTotalTax();
        var taxAmount = rew > 0 ? Math.floor((rew * tax) / 100) : 0;
        var finalRew = rew - taxAmount;
        text.innerHTML =
          msg +
          '<br><br><span style="font-size:20px;color:' +
          col +
          '">' +
          (rew >= 0 ? "+" : "") +
          rew +
          "üí∞</span>" +
          (taxAmount > 0
            ? '<br><span style="font-size:14px;color:#f90">-' +
              taxAmount +
              "üí∞ (" +
              tax +
              '% op≈Çata za narzƒôdzia)</span><br><span style="font-size:16px;color:#0f8">= ' +
              finalRew +
              "üí∞ netto</span>"
            : "");
        G.credits = Math.max(0, G.credits + finalRew);
        G.completed.push({
          id: sceneData.caseData.id,
          name: sceneData.caseData.name,
          rew: rew,
        });
        G.inbox.unshift({ from: sceneData.type, body: msg, read: false });
        updateHUD();
        saveGame();
      }
      document.getElementById("scene-exit").onclick = document.getElementById(
        "scene-exit"
      ).ontouchend = function (e) {
        e.preventDefault();
        document.getElementById("scene-overlay").style.display = "none";
        G.day++;
        updateHUD();
        saveGame();
        renderPanel("case");
      };
      document.getElementById("start-btn").onclick = function () {
        document.getElementById("intro").style.display = "none";
        init3D();
        document.getElementById("touch-btn").onclick = function () {
          if (lookAt && !G.inPC) interact(lookAt);
        };
        setTimeout(function () {
          notify("Witaj!", "Id≈∫ do DRZWI");
        }, 500);
      };
      window.onresize = function () {
        if (camera && renderer) {
          camera.aspect = innerWidth / innerHeight;
          camera.updateProjectionMatrix();
          renderer.setSize(innerWidth, innerHeight);
        }
      };
      var chatClientIdx = null;
      function openClientChat(idx) {
        chatClientIdx = idx;
        var c = G.activeCases[idx];
        if (!c.chatHistory) c.chatHistory = [];
        document.getElementById("chat-client-name").textContent =
          "üí¨ " + c.name;
        renderChatMessages();
        document.getElementById("client-chat").style.display = "flex";
      }
      function renderChatMessages() {
        var c = G.activeCases[chatClientIdx];
        var h = "";
        if (!c.chatHistory.length)
          h =
            '<p style="color:#666;text-align:center;font-style:italic">Rozpocznij rozmowƒô z klientem...</p>';
        for (var i = 0; i < c.chatHistory.length; i++) {
          var m = c.chatHistory[i];
          h +=
            '<div style="margin-bottom:10px;text-align:' +
            (m.from == "ty" ? "right" : "left") +
            '"><div style="display:inline-block;background:' +
            (m.from == "ty" ? "#0ff" : "#2a2a4e") +
            ";color:" +
            (m.from == "ty" ? "#000" : "#fff") +
            ';padding:8px 12px;border-radius:10px;max-width:80%;font-size:13px">' +
            m.txt +
            "</div></div>";
        }
        document.getElementById("chat-messages").innerHTML = h;
        document.getElementById("chat-messages").scrollTop = 9999;
      }
      function getClientResponse(msg, c) {
        var m = msg.toLowerCase();
        if (m.indexOf("jak siƒô czujesz") >= 0 || m.indexOf("jak siƒô masz") >= 0)
          return "Szczerze? Okropnie. Ta sytuacja mnie wyka≈Ñcza. Dziƒôkujƒô ≈ºe pan pyta.";
        if (
          m.indexOf("policja") >= 0 ||
          m.indexOf("zg≈Çosi≈Çem") >= 0 ||
          m.indexOf("zg≈Çosi≈Çam") >= 0
        )
          return "Policja? Mam nadziejƒô ≈ºe pomo≈ºe. Proszƒô mnie informowaƒá o postƒôpach!";
        if (m.indexOf("sƒÖd") >= 0)
          return "SƒÖd brzmi powa≈ºnie... Czy bƒôdƒô musia≈Ç/a zeznawaƒá?";
        if (m.indexOf("dowody") >= 0 || m.indexOf("screeny") >= 0)
          return "Mam wszystko zapisane. Mogƒô przes≈Çaƒá wiƒôcej je≈õli trzeba.";
        if (
          m.indexOf("podejrzany") >= 0 ||
          m.indexOf("sprawca") >= 0 ||
          m.indexOf("kto to") >= 0
        )
          return c.fullStory.indexOf("Podejrzewam") >= 0
            ? "Jak m√≥wi≈Çem/am, mam podejrzenia kto za tym stoi. Ale nie mam 100% pewno≈õci."
            : "Nie wiem dok≈Çadnie kto to. Dlatego proszƒô o pomoc.";
        if (
          m.indexOf("bezpiecz") >= 0 ||
          m.indexOf("boisz") >= 0 ||
          m.indexOf("grozi") >= 0
        )
          return c.type == "GRO≈πBY" || c.type == "STALKING"
            ? "Tak, bojƒô siƒô. Czy mogƒô liczyƒá na jakƒÖ≈õ ochronƒô?"
            : "Na razie jest OK, ale sytuacja jest stresujƒÖca.";
        if (
          m.indexOf("spokojnie") >= 0 ||
          m.indexOf("pomogƒô") >= 0 ||
          m.indexOf("pomo≈ºemy") >= 0
        )
          return "Dziƒôkujƒô bardzo. To du≈ºo dla mnie znaczy.";
        if (
          m.indexOf("pieniƒÖd") >= 0 ||
          m.indexOf("koszt") >= 0 ||
          m.indexOf("zap≈Çac") >= 0
        )
          return "Jestem w stanie zap≈Çaciƒá ile trzeba, ≈ºeby to rozwiƒÖzaƒá.";
        if (
          m.indexOf("deadline") >= 0 ||
          m.indexOf("termin") >= 0 ||
          m.indexOf("czas") >= 0
        )
          return "Proszƒô siƒô nie spieszyƒá, ale... im szybciej tym lepiej. Ta sytuacja mnie dobija.";
        if (
          m.indexOf("wiƒôcej") >= 0 ||
          m.indexOf("szczeg√≥≈Çy") >= 0 ||
          m.indexOf("opowiedz") >= 0
        )
          return c.fullStory;
        if (
          m.indexOf("sukces") >= 0 ||
          m.indexOf("wygra≈Ç") >= 0 ||
          m.indexOf("uda≈Ço") >= 0
        )
          return "To wspania≈Ça wiadomo≈õƒá! Dziƒôkujƒô za pomoc!";
        if (
          m.indexOf("przegra") >= 0 ||
          m.indexOf("nie uda≈Ço") >= 0 ||
          m.indexOf("przepraszam") >= 0
        )
          return "Rozumiem... Dziƒôkujƒô ≈ºe pan pr√≥bowa≈Ç. Mo≈ºe uda siƒô inaczej.";
        if (m.length < 5) return "S≈Çucham?";
        return "Rozumiem. Czy jest co≈õ jeszcze co powinienem/powinnam wiedzieƒá? Proszƒô mnie informowaƒá o sprawie.";
      }
      document.getElementById("close-chat").onclick = function () {
        document.getElementById("client-chat").style.display = "none";
        chatClientIdx = null;
      };
      document.getElementById("chat-send").onclick = document.getElementById(
        "chat-send"
      ).ontouchend = function (e) {
        e.preventDefault();
        var input = document.getElementById("chat-input");
        var txt = input.value.trim();
        if (!txt) return;
        var c = G.activeCases[chatClientIdx];
        if (!c.chatHistory) c.chatHistory = [];
        c.chatHistory.push({ from: "ty", txt: txt });
        var resp = getClientResponse(txt, c);
        setTimeout(function () {
          c.chatHistory.push({ from: "klient", txt: resp });
          renderChatMessages();
          saveGame();
        }, 800);
        input.value = "";
        renderChatMessages();
        saveGame();
      };
      var mediatorHistory = [];
      var mediatorCaseIdx = null;
      function openMediatorChat() {
        mediatorCaseIdx = parseInt(document.getElementById("case-sel").value);
        var c = G.activeCases[mediatorCaseIdx];
        mediatorHistory = [];
        if (c) {
          mediatorHistory.push({
            from: "mediator",
            txt:
              "Witam, jestem po≈õrednikiem prawnym. Widzƒô sprawƒô: " +
              c.name +
              " (" +
              c.type +
              '). Mogƒô doradziƒá gdzie najlepiej jƒÖ skierowaƒá. Napisz "porada" a za 50üí∞ powiem ci dok≈Çadnie gdzie wys≈Çaƒá i dlaczego.',
          });
        } else {
          mediatorHistory.push({
            from: "mediator",
            txt: "Witam. Nie widzƒô wybranej sprawy. Wybierz sprawƒô z listy i wr√≥ƒá do mnie.",
          });
        }
        renderMediatorMessages();
        document.getElementById("mediator-chat").style.display = "flex";
      }
      function renderMediatorMessages() {
        var h = "";
        for (var i = 0; i < mediatorHistory.length; i++) {
          var m = mediatorHistory[i];
          h +=
            '<div style="margin-bottom:10px;text-align:' +
            (m.from == "ty" ? "right" : "left") +
            '"><div style="display:inline-block;background:' +
            (m.from == "ty" ? "#fc0" : "#2a2a4e") +
            ";color:" +
            (m.from == "ty" ? "#000" : "#fff") +
            ';padding:8px 12px;border-radius:10px;max-width:80%;font-size:13px;white-space:pre-wrap">' +
            m.txt +
            "</div></div>";
        }
        document.getElementById("mediator-messages").innerHTML = h;
        document.getElementById("mediator-messages").scrollTop = 9999;
      }
      function getMediatorResponse(msg) {
        var m = msg.toLowerCase();
        var c = G.activeCases[mediatorCaseIdx];
        if (!c)
          return "Nie widzƒô ≈ºadnej wybranej sprawy. Zamknij okno, wybierz sprawƒô z listy i wr√≥ƒá.";
        if (
          m.indexOf("porada") >= 0 ||
          m.indexOf("tak") >= 0 ||
          m.indexOf("chcƒô") >= 0 ||
          m.indexOf("dawaj") >= 0 ||
          m.indexOf("m√≥w") >= 0
        ) {
          if (G.credits < 50)
            return (
              "‚ùå Nie masz wystarczajƒÖcych ≈õrodk√≥w. Potrzebujesz 50üí∞, masz tylko " +
              G.credits +
              "üí∞."
            );
          G.credits -= 50;
          updateHUD();
          saveGame();
          var best = "";
          var reason = "";
          if (c.type == "GRO≈πBY") {
            best = "üöî POLICJA";
            reason =
              "Gro≈∫by to sprawa karna. Policja mo≈ºe natychmiast dzia≈Çaƒá, zabezpieczyƒá dowody i zapewniƒá ochronƒô ofierze. MogƒÖ te≈º namierzyƒá sprawcƒô.";
          } else if (c.type == "STALKING") {
            best = "üöî POLICJA";
            reason =
              "Stalking to przestƒôpstwo ≈õcigane z urzƒôdu. Policja mo≈ºe wydaƒá zakaz zbli≈ºania siƒô i monitorowaƒá sprawcƒô. Ofiara dostanie ochronƒô.";
          } else if (c.type == "ZNIES≈ÅAWIENIE") {
            best = "‚öñÔ∏è SƒÑD";
            reason =
              "Znies≈Çawienie to sprawa cywilna. SƒÖd mo≈ºe nakazaƒá usuniƒôcie fa≈Çszywych tre≈õci, przeprosiny i odszkodowanie finansowe.";
          } else if (c.type == "PODSZYWANIE") {
            best = "‚öñÔ∏è SƒÑD";
            reason =
              "Podszywanie siƒô pod kogo≈õ to naruszenie d√≥br osobistych. SƒÖd mo≈ºe nakazaƒá usuniƒôcie fa≈Çszywego profilu i zasƒÖdziƒá odszkodowanie.";
          } else if (c.type == "OSZUSTWO") {
            best = "üöî POLICJA";
            reason =
              "Oszustwo to przestƒôpstwo. Policja wszczyna ≈õledztwo, mo≈ºe zablokowaƒá konta bankowe sprawcy i odzyskaƒá pieniƒÖdze.";
          } else if (c.type == "HACKING") {
            best = "üöî POLICJA";
            reason =
              "W≈Çamanie na konto to cyberprzestƒôpstwo. Policja ma wydzia≈Ç cyberprzestƒôpczo≈õci kt√≥ry mo≈ºe namierzyƒá hakera.";
          } else if (c.type == "SZANTA≈ª") {
            best = "üöî POLICJA lub üìã PROKURATURA";
            reason =
              "Szanta≈º to powa≈ºne przestƒôpstwo zagro≈ºone wiƒôzieniem. Policja dzia≈Ça szybciej, prokuratura ma wiƒôcej zasob√≥w na trudne sprawy.";
          } else if (c.type == "WY≈ÅUDZENIE") {
            best = "üìã PROKURATURA";
            reason =
              "Wy≈Çudzenia na du≈ºƒÖ skalƒô najlepiej kierowaƒá do prokuratury - prowadzƒÖ kompleksowe ≈õledztwa finansowe.";
          } else {
            best = "üöî POLICJA";
            reason =
              "W razie wƒÖtpliwo≈õci policja to bezpieczny wyb√≥r - przeka≈ºƒÖ sprawƒô dalej je≈õli trzeba.";
          }
          return (
            "‚úÖ PORADA (-50üí∞)\n\n‚û°Ô∏è Wy≈õlij do: " +
            best +
            "\n\nüìù Dlaczego: " +
            reason +
            "\n\nPowodzenia!"
          );
        }
        if (
          m.indexOf("ile") >= 0 ||
          m.indexOf("koszt") >= 0 ||
          m.indexOf("cena") >= 0
        )
          return 'Porada kosztuje 50üí∞. Napisz "porada" ≈ºeby jƒÖ otrzymaƒá.';
        if (m.indexOf("dziƒôki") >= 0 || m.indexOf("dziƒôkujƒô") >= 0)
          return "Nie ma za co! Powodzenia ze sprawƒÖ.";
        if (
          m.indexOf("hej") >= 0 ||
          m.indexOf("cze≈õƒá") >= 0 ||
          m.indexOf("siema") >= 0
        )
          return 'Witam! Napisz "porada" je≈õli chcesz wiedzieƒá gdzie wys≈Çaƒá sprawƒô (50üí∞).';
        return 'Napisz "porada" ≈ºeby otrzymaƒá rekomendacjƒô za 50üí∞, lub "ile" ≈ºeby sprawdziƒá cenƒô.';
      }
      document.getElementById("close-mediator").onclick = function () {
        document.getElementById("mediator-chat").style.display = "none";
      };
      document.getElementById("mediator-send").onclick =
        document.getElementById("mediator-send").ontouchend = function (e) {
          e.preventDefault();
          var input = document.getElementById("mediator-input");
          var txt = input.value.trim();
          if (!txt) return;
          mediatorHistory.push({ from: "ty", txt: txt });
          var resp = getMediatorResponse(txt);
          setTimeout(function () {
            mediatorHistory.push({ from: "mediator", txt: resp });
            renderMediatorMessages();
          }, 500);
          input.value = "";
          renderMediatorMessages();
        };
    </script>
  </body>
</html>
